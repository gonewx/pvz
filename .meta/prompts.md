
- 草坪背景不是通过缩放来适应窗口,而是游戏中只显示中间部分,游戏开始前要有一个从左到右的滑动效果显
示整体场景的动画 . 是从左滑到右，再从右滑动回中间。
- 阳光计数器的背景和金色矩形框也已经在bar5 上绘制好了,只是在正确的位置显示正确的数值即可
- 铲子和铲子槽位画在了卡片槽位上，要移到右方
- 阳光计数值的显示位置 在哪里设置 ?

## story 3.2

- 要参考 @2.2.story.md 中阳光计数器的位置计算 方式，使用相对位置方式确定卡片的位置
- 卡片还有重叠，卡片槽每个卡槽中间是有边距的，查看截图
- 卡片大于卡槽了，需要增加常量用来控制卡片显示的缩放因子。而且卡片上已经有固定的阳光值了，不需要再显示。


### correct-course
- 半透明的植物图像不是跟随鼠标，是显示在将要被种植的位置，跟随鼠标的图像应该是不透明的。
- 我将原图片目录备份到了 assets/imagesold， 现在的资源目录 assets 收集了完整的原版资源，请先根据 assets/properties/resources.xml 结合我们调整后的实际目录，创建我们的资源映射文件（由原来的 xml 改为yaml格式） ，并创新新的资源引用与管理模块，然后将代码原有引用旧资源的逻辑改为使用新的资源管理方式。

- ✅ [FIXED] 教学关卡时，指向植物卡片的箭头不显示了 - 原因：GameScene.Draw() 缺少 UI 粒子渲染调用
- ✅ [FIXED] 僵尸死亡时，头和手臂一起掉落了 - 原因：手臂掉落应在受伤时触发，而不是死亡时。手臂掉落的粒子文件是 assets/effect/particles/ZombieArm.xml 。 头掉落的是：assets/effect/particles/ZombieHead.xml
- ✅ [FIXED] 子弹与僵尸的碰撞检测要优化 - 原因：physics_system.go 碰撞检测遗漏了 BehaviorZombieDying

- 豌豆射手的动画效果之前一直不知道 anim_stem 轨道的作用，通过实际运行后，发现原版效果在攻击时，茎干的摇晃一直没停，只是头部换成了攻击轨道的动画，所以大胆猜想 anim_stem 轨道是定位茎干位移的，请尝试修复攻击时的动画效果。

- 之前对 reanim 动画系统的理解和实现有偏差，请根据最新研究，修正或重构之前相关的文档、模块、测试。
最新研究请参考：@docs/reanim @cmd/render_animation_comparison/main.go

## 5.3

- 还有2个问题，卡片会渲染在植物和僵尸上面。坚果墙一放，帽子僵尸帽子就会消失，是被攻击了吗？

## aniamtion 

/mnt/disk0/project/game/pvz/ck/pvzwine_reverse 这个项目是对原版游戏资源数据的研究与解析， 请结合测试程序，将我们之前实现的基于动画帧的动画系统，改为使用和原版游戏同样的动画系统。 解析后的资源已经放在 assets/reanim， assets/effect/reanim。


- @.meta/reanim/peashootersingle.md 这是定义文件格式的猜想,不一定完全 
正确,请参考并独立思考后,评估我们的实现是否有潜在的问题

@.meta/reanim/reanim.md  为了验证这个文档是否正确，请写一个单独的文件，按这个的说明实现2个动画场景，一个是空闲时，一个是攻击时的全身动画。
注意，是一个独立执行文件，不要基于我们之前实现的reanim模块。 这是动画定义文件 assets/effect/reanim/PeaShooterSingle.reanim.  
需要用到的第三方库要与我们项目的一致。

- 请分析定义文件中所有轨道的可见性,保存到文档中

## 粒子效果

现在要全面支持粒子效果， 例如：僵尸的手臂掉落、头掉落的效果等等，请全面分析粒子系统的配置格式，优雅的实现粒子系统。实现方案要优先使用Ebitengine 引擎，有必要的话先使用 `mcp__deepwiki` 工具的`ask_question`方法，查阅最新的文档，以找到最正确的方法

- `assets/effect/particles`：粒子系统的配置，指定粒子的发射器、轨迹与贴图（引用 `assets/particles` 中的 PNG）
- `assets/particles`：粒子系统用的贴图素材（效果精灵）。如爆炸、烟雾、火花、雨滴、泡泡、星星等（例如 `DoomShroom_Explosion_*`, `PoolSparkly.png`, `SnowPea_*`）

- 僵尸头粒子效果和原版的表现不一样,请参考我的理解,检查实现是否不正确? .meta/particles/ZombieHead.md  
assets/effect/particles/ZombieHead.xml 从实际运行 cmd/particles/main.go 看,僵尸头没有在地面弹跳的效果

-  僵尸头粒子效果和原版的表现不一样, 掉落速度慢,头滚动少,很快就消失了，没看到反弹地面的效果.是不是我们对配置文件的字段含义理解有误?或实现有误? .meta/particles/ZombieHead.md  assets/effect/particles/ZombieHead.xml  cmd/particles/main.go

- assets/effect/particles/SodRoll.xml 中的所有字段都解析并应用到渲染中了吗? 验证粒子系统的实现， 可以使用类似 `go run cmd/particles/main.go --verbose --effect="Planting"  > /tmp/p.log 2>&1` 的命令运行，并查看日志

## 8

- 现在项目的基础功能全部实现，需要根据 @.meta/whitepaper.md 的说明一步步实现关卡， 注意说明文档是大模型生成的，有可能不准确，有和你对游戏理解不一致的地方，明确提出，和我沟通确认。

### menu

- 通过 .meta/screenshot/menu 下的所有图片, 描述主菜单界面的所有信息,以便于接下来实现这个界面和功能

- 实现 .meta/data/data.md 和 docs/main-menu-spec.md 中 主菜单界面和功能。要重点查看 assets/effect/reanim/SelectorScreen.reanim 和  assets/effect/reanim/Zombie_hand.reanim,  以确定哪些是动画定义中就实现了的场景 ,哪些是需要我们二次加工实现的. 
### level1

- @level1/ 中是本关卡中的关键截图，请参考
- 注意截图只是几个关键步骤，并不代表所有的教学文本，请根据 LawnStrings.txt 文本资源确定完整的引导过程的文本
- 计划中要根据完整的资源 @assets ，确定需要用到的背景、图片、音频、动画、粒子等，基于完整的资源分析，列出需要用到的资源清单


- 现在存在的问题：
    - ✅ **已解决** 阳光掉落的位置和间隔都是固定的 → 已添加随机性（间隔8±1秒，位置±50x/±30y像素）
    - ✅ **已解决** 第一波僵尸进入有点慢 → 僵尸生成位置从X=1100-1250调整为1000-1100，减少等待时间
    - ✅ **已解决** 最后一波僵尸的动画效果还没有显示 → 代码已实现FinalWave.reanim动画（1-1关只有1波，不触发是正常的）
    - ✅ **已解决** 去掉之前测试时添加的僵尸波次提示文本和右下角的进度显示 → 已注释掉测试UI
    - ✅ **已解决** 1-1关没有铲子，请去掉 → 教学关卡自动隐藏铲子
    - ✅ **已解决** 右上角需要添加菜单按钮 → 添加了菜单按钮显示（点击功能待实现）

    - 实现右下角正式的进度条显示 → 使用原版FlagMeter资源实现图形化进度条，进度要能反应真实的僵尸波次和进攻进度
    - 菜单按钮点击响应（需要实现暂停菜单系统）
    - 植物发射子弹时需要切换到发射子弹的动画（请在资源路径 assets 查找合适的动画效果）
    - 植物种植时，地面上有土粒飞溅的效果（请在资源路径下 assets 查找合适的动画效果）
    - 每行有效的草坪左边台阶上需要增加除草车，是最后一道防线，可以一次从左到右除草，消灭所在行的所有僵尸。（正确显示除草车，能正确触发除草车动画效果，能消灭所在行所有僵尸）
    - 进度条上的旗帜标记显示（当前只显示背景和进度填充）

- @assets/effect/particles/SodRoll.xml 应该铺草皮时土粒飞溅的效果. 添加最后一波僵尸的提示动画: 
assets/effect/reanim/FinalWave.reanim. 完善进度条显示: 1.位置 
2.正确显示当前进度,僵尸头的位置要匹配进度，僵尸头开始在右边,随着进度条移动,而且进度条要有绿色的进度显示. FlagMeter.png: 背景框和绿色进度填充,一张图有2行, 根据进度百分比从左到右裁剪显示. 绿色进度填充从右到左增长.关卡文字有黑色描边效果. 文字位置要在进度条左面的外侧.  FlagMeterLevelProgress.png（装饰条）：垂直对齐：图片的Y轴中点对齐背景框的下边沿，水平居中在背景框， FlagMeterParts.png  是3部分,1 僵尸头 2: 竖线 3: 旗帜: 
assets/images/FlagMeter.png
assets/images/FlagMeterLevelProgress.png
assets/images/FlagMeterParts.png 
3. 图片前要有当前关卡的文本显示:  关卡 1-1 , 进度条和文本显示要右对齐，可以手工配置距离右边缘的位置.  开始进攻前, 只有文本显示,开始进攻时,显示完整的文本加图片进度条,文字位置要在进度条左面的外侧， 进度条不显示时,不要占位,文本要右对齐.


### level 1-2

- 本关也没有解锁铲子
- 为什么配置了有效植物有向日葵，但是向日葵无法种植

### level 1-4

- 1-4 关卡胜利后，虽然解锁的是铲子，也需要有和前面关卡类似的奖励动画， 只是植物卡包换成铲子图片， 卡包背景的粒子效果换成 assets/effect/particles/AwardPickupArrow.xml。

## bugs

目前存在的问题：

- 向日葵种植后不会自动生产阳光
- 教学关卡，自动生产的阳光的位置和时间不够随机
- 优化僵尸不在有效行时的进攻逻辑，根据邻近的有效行，进攻时，保持X坐标不变，自动调整僵尸的Y坐标到有效行即可，不需要有移动的动画效果。

- 桃炸弹的爆炸范围要考虑在边缘网格时候的情况, 如果种植在最右边网格, 爆炸范围应该包括网格右侧的范围,现在没法炸死右侧的僵尸.

- 