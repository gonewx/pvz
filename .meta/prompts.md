
- 草坪背景不是通过缩放来适应窗口,而是游戏中只显示中间部分,游戏开始前要有一个从左到右的滑动效果显
示整体场景的动画 . 是从左滑到右，再从右滑动回中间。
- 阳光计数器的背景和金色矩形框也已经在bar5 上绘制好了,只是在正确的位置显示正确的数值即可
- 铲子和铲子槽位画在了卡片槽位上，要移到右方
- 阳光计数值的显示位置 在哪里设置 ?

## story 3.2

- 要参考 @2.2.story.md 中阳光计数器的位置计算 方式，使用相对位置方式确定卡片的位置
- 卡片还有重叠，卡片槽每个卡槽中间是有边距的，查看截图
- 卡片大于卡槽了，需要增加常量用来控制卡片显示的缩放因子。而且卡片上已经有固定的阳光值了，不需要再显示。


### correct-course

- [x] 半透明的植物图像不是跟随鼠标，是显示在将要被种植的位置，跟随鼠标的图像应该是不透明的。
- [x] 我将原图片目录备份到了 assets/imagesold， 现在的资源目录 assets 收集了完整的原版资源，请先根据 assets/properties/resources.xml 结合我们调整后的实际目录，创建我们的资源映射文件（由原来的 xml 改为yaml格式） ，并创新新的资源引用与管理模块，然后将代码原有引用旧资源的逻辑改为使用新的资源管理方式。

- [x] 教学关卡时，指向植物卡片的箭头不显示了 - 原因：GameScene.Draw() 缺少 UI 粒子渲染调用
- [x] 僵尸死亡时，头和手臂一起掉落了 - 原因：手臂掉落应在受伤时触发，而不是死亡时。手臂掉落的粒子文件是 data/particles/ZombieArm.xml 。 头掉落的是：data/particles/ZombieHead.xml
- [x] 子弹与僵尸的碰撞检测要优化 - 原因：physics_system.go 碰撞检测遗漏了 BehaviorZombieDying

- [x] 豌豆射手的动画效果之前一直不知道 anim_stem 轨道的作用，通过实际运行后，发现原版效果在攻击时，茎干的摇晃一直没停，只是头部换成了攻击轨道的动画，所以大胆猜想 anim_stem 轨道是定位茎干位移的，请尝试修复攻击时的动画效果。

- [x] 之前对 reanim 动画系统的理解和实现有偏差，请根据最新研究，修正或重构之前相关的文档、模块、测试。
最新研究请参考：@docs/reanim @cmd/render_animation_comparison/main.go

- [x] 现在僵尸的生成是根据预览时的僵尸

- [x] 日间场地 (白天/泳池/屋顶) 有天降阳光, 掉落间隔 = min{已掉落阳光数量 x 10 + 425, 950} + rand(275), 刚开局时掉落较快, 掉落 52 个之后间隔稳定在 950~1224 范围内. 蘑菇类植物需要使用咖啡豆唤醒.

- [x] level 1-4 配置了其他类型僵尸，但是出现的还全是basic类型的
- [x] level 1-1 的教学流程，种下第2个豌豆射手后，要优先显示 `ADVICE_ZOMBIE_ONSLAUGHT` `别让僵尸靠近你的房子`的文本
- [x] 樱桃炸弹的爆炸范围是半径115，是不是爆炸范围内的僵尸的检测算法有错? 是以僵尸的哪个点检测的? 
应该是以僵尸整体来检测吧?

- [x] 奖励动画和奖励面板切换的过程中间有一瞬间会显示出背景

- [x] 奖励动画卡包的粒子效果显示一下就消失了，要持续显示，直到移动动画开启
- [x] 优化进度条的实现逻辑 @.meta/data/progress.md
- [x] 僵尸显示正常了，但是护甲没有受损和掉落的动画效果，直接消失了。 要找到正确的受损相应的图片资源和掉落的动画，修正效果。

- [x] 参考 `cmd/verify_* ` 下的程序， 实现一个统一的验证程序，在植物选择栏要能选择所有植物，然后草坪每一行固定出现一种类型的僵尸，每个僵尸每隔两秒出现一个，以便于我们验证植物和僵尸的各种行为。还需要有快捷键能触发`除草车`、`奖励动画`.实现要完全调用业务模块，不要实现和业务模块重复的功能。

- [x] 开场动画期间，在屏幕下方居中要显示白色字黑色阴影、32号大小 `{username}的房子`

- [x] 开场动画播放后，游戏开始前要显示除草车动画效果，是从屏幕左侧开出来到达初始位置的感觉

- [x] 开场动画期间预览僵尸时，显示的僵尸类型不符合实际配置的，如果配置了特殊类型僵尸，是要显示出来的

- [x] level 1-4配置了conehead ,但预览时和最后一波时,都没有出现.非普通类僵尸预览必须保证种类的显示. 游戏中必须保证数量完全按配置显示 .

 cmd/animation_showcase 中渲染的zombie_flagpole 动画 ,旗子和旗杆位置是正确的, 但游戏中旗帜僵尸使用子动画的方式渲染的。 旗子在旗杆偏左一个旗杆宽度的位置.看起来 就是没有装在旗杆上的感觉 . 日志(文件很大): /tmp/pvz.log 

请在cmd/verify_gameplay 中添加旗帜僵尸,以便快速验证动画效果. 旗帜僵尸是通过 `data/reanim/Zombie.reanim`  `data/reanim/Zombie_FlagPole.reanim` 这2个动画定义,采用轨道合并的方式实现旗帜僵尸的. 

- [x] 请设计用户游戏存档系统，游戏过程中可随时存储当前进度，退出游戏后，重新进入后，可恢复游戏进度，继续游戏。游戏存档数据是否更适合使用二进制数据序列化? 
  暂停菜单不需要改,点击暂停菜单中的主菜单按钮时,就是保存进度.
  加载逻辑也是进入游戏后,点击冒险模式按钮,自动加载存档信息.因为并不能任意切换关卡。 
  再次进入游戏时,如果有存档,默认显示类似于退出对话框一样的对话框: 
  title: 继续游戏?  
  mesasge:  你想继续当前游戏还是重玩此关卡？
  按键区: 第1行两个按钮:继续和重玩关卡，第二行第一按钮: 取消

  -  epic 18 实现后,发现的问题: 对话框是在进入关卡游戏后弹出，而不是在主菜单界面点击冒险模式按钮后弹出. 按钮是两排，所以对话框应该是使用大按钮区域的样式。优先级要高于开场动画,  如果有关卡存档,就不显示开场动画，进入关卡时就要加载并显示完整的数据 .点继续后就直接开始游戏了,而不是点继续后才加载存档数据

    - 继续后, 游戏存档恢复不完整, 除草车恢复后,位置正确,但是在动画状态,应该是静止状态. 草皮没有正确显示. 教学流程没有正确显示. 阳光没有正常生成 . 
    - 继续后, 游戏存档恢复不正确, 进度条直接恢复到存档时的进度，不需要有动画效果. 教学关卡的流程恢复后，感觉恢复点不太对。
    - 在啃食坚果墙的僵尸在恢复存档后看不到了，只能看到脚下的阴影

- [] story 10.9 :

  - 加载界面、主菜单界面、level 1-1 至 level 1-5 关卡的的功能都已经实现，但有很多音效还没有加到游戏环节中，请从音效资源目录(`assets/sounds`) 汇总所有的音效, 以及这些音效要应用在哪些地方, 给出最终的汇总表, 以便接下来查漏补缺将音效添加到游戏环节中.

  - 加载界面、主菜单界面、level 1-1 至 level 1-5 关卡的的功能都已经实现，但有很多音效还没有加到游戏环节中，请查看音效资源目录(`assets/sounds`),并结合 docs/sound-effects-inventory.md, 实现完整的音效播放. 并且实现选项面板中, 滑动条控制音乐和音效音量大小的功能.

  - 加载界面的进度条上四朵小花的出现和僵尸头的出现，也有音效loadingbar_flower.ogg loadingbar_zombie.ogg。 点击开始按钮点击后有音效 ( buttonclick.ogg ) 。 整体背景音乐：mainmusic.mo3
  - 主菜单界面加载时有泥土松动的音效(dirt_rise.ogg)，所有按钮（用户管理按钮、墓碑上的四个按钮、右下角的3个按钮）要有悬停时的音效（bleep.ogg）和点击时的音效 (tap.ogg)
  - 主菜单界面,僵尸手掌动画的音效（evillaugh.ogg）
  - 选项面板中和用户管理面板及子面板中, 普通按钮、 墓碑样式按钮（确定、返回游戏、主菜单、重新开始）和滑块类的点击释放音效(buttonclick.ogg)， 墓碑样式按钮（确定、返回游戏、主菜单、重新开始）点击按下音效（gravebutton.ogg）
  
  - level 1-5 点击铲子的音效（shovel.ogg）， 铲除植物的音效和种植时一样

  - 植物选中的音效（seedlift.ogg）
  - 僵尸进场 siren.ogg 和 awooga.ogg 
  - 开场动画中铺草皮时的音效 gravebusterchomp.ogg， 铺完后是没有音效的
  - 植物吐出子弹时的音效 throw.ogg 和僵尸中弹的音效
  - 奖励动画时，点击卡包有音效 tap2.ogg. 点击后，奖励动画过程中要播放 winmusic.ogg 。奖励面板显示过程中，有 thunder.ogg 音效。点击下一关按钮时 有音效 tap2.ogg。 
  - 僵尸啃食的音效和动作不同步
  - 一大波提示时要播放 hugewave.ogg. 最后一波和一大波僵尸的提示如果是同一波， 只需要播放一次相关的音效即可，不要重复播放 
  - 僵尸到达房子门口时播放一次啃食的音效
  - 有僵尸在网格内时，随机的播放音效 ， 但不要太频繁。 groan.ogg groan2.ogg groan3.ogg groan4.ogg groan5.ogg groan6.ogg

  - 在僵尸进入房子动画时要播放 losemusic.ogg
  - level 1-5 中，dave 对话时都有相应的音效，请找到正确的音效，并修正逻辑。 crazydavecrazy.ogg crazydaveextralong1.ogg crazydaveextralong2.ogg crazydaveextralong3.ogg crazydavelong1.ogg crazydavelong2.ogg crazydavelong3.ogg crazydavescream.ogg crazydavescream2.ogg crazydaveshort1.ogg crazydaveshort2.ogg crazydaveshort3.ogg

- [x] level 1-5 中，在`拿好这个坚果墙`的对话时，dave的手上要显示坚果

- [x] 暂停面板中能通过已经绘制`音乐``音效`调节声音大小，通过`全屏`复选框，指定打开时默认是否全屏。 `3d加速` 默认选中，不可修改。

- [x] 游戏可通过窗口栏上全屏按钮使游戏全屏。按 `F11`键可切换全屏

- [x] 资源使用 golang 的 embed 加载，以便编译后打包成一个可执行程序

  - /BMad:agents:architect *research 要实现资源使用 golang 的 embed 加载，以便编译后打包成一个可执行程序, 请评估 @data @assets
  两个目录的设计是否合理? 有没有需要调整的地方? 

- [x] 编写运维类脚本（包括 github ci/cd 脚本 ），方便发布、编译各平台运行二进制 。支持的平台 Linux\Windows\MacOS\Android\iOS\Web(WASM)。  

- [x] 僵尸和除草车的碰撞检测不合适，看起来僵尸已经走到车上了，才发生攻击

- [] 僵尸炸死后， 上一行僵尸突然消失，然后又从普通僵尸变成了路障僵尸?
- [x] level 1-3 和 1-4 胜利后，程序僵死
- [x] level 1-5 通关后， 主菜单界面 冒险模式按钮（1-6 ）再点击按钮，要弹出对话框：
  标题： 敬请期待
  消息： 后续关卡还未实现，点击确定可以从头开玩
  按钮： `确定` - 将当前关卡设置为 1-1 ， 重新加载当前界面， `取消` - 关闭对话框。

- [x] 植物种植在僵尸所在网格时，有时会造成僵尸后退，请修正
- [x] 增加植物选择快捷键，卡槽内植物以`1`至`9`排序， 铲子使用 `q`
- [x] 弹出框要和选项面板一样， 弹出后，就不能点击遮罩后的元素了
- [x] 同一网格内的僵尸如果位置很接近，僵尸被攻击时，2个僵尸会被交错攻击到，也会有交错显示在上层的问题，而且如果有路障僵尸，攻击音效也会错乱，一会是路障僵尸的音效，一会又是铁桶的音效，一会是普通僵尸的音效。
- [x] 路障僵尸在啃食时，如果此时被攻击帽子被打掉，但是后面又会出现
- [x] level 1-5 ：在传送带环节，点击铲子有时会同时选中铲子和坚果。
- [x] level 1-5 ：dave 对话环节，还能点击铲子，需要改为不能点击其他元素。
- [] level 1-5 ：直接测试这个关卡，背景是正确的，但正常游戏，从level 1-4 完成后，点下一关进入后，背景渲染的就是只有三行草皮的错误的背景，请修正。

- [] 经过调研，我发现：

  1. exp/textinput 在 Android 上不支持软键盘 - 它只是一个伪实现，使用
  ebiten.AppendInputChars，不会弹出系统软键盘
  2. Ebitengine 目前没有内置的 Android 软键盘 API - 根据
  https://github.com/hajimehoshi/ebiten/issues/362 和 
  https://github.com/hajimehoshi/ebiten/issues/1029，需要通过 JNI（Java Native 
  Interface） 自己实现
  
    为了实现在输入框输入文本,我想到一个简化方案,请你评估是否合适和能实现: 
  使用assets/data下的位图字体, 在用户管理需要输入时, 绘制简易的必要的字符, 
  用于在移动设备上输入用户名. 

## 5.3

- 还有2个问题，卡片会渲染在植物和僵尸上面。坚果墙一放，帽子僵尸帽子就会消失，是被攻击了吗？

## aniamtion 

/mnt/disk0/project/game/pvz/ck/pvzwine_reverse 这个项目是对原版游戏资源数据的研究与解析， 请结合测试程序，将我们之前实现的基于动画帧的动画系统，改为使用和原版游戏同样的动画系统。 解析后的资源已经放在 assets/reanim， assets/effect/reanim。


- @.meta/reanim/peashootersingle.md 这是定义文件格式的猜想,不一定完全 
正确,请参考并独立思考后,评估我们的实现是否有潜在的问题

@.meta/reanim/reanim.md  为了验证这个文档是否正确，请写一个单独的文件，按这个的说明实现2个动画场景，一个是空闲时，一个是攻击时的全身动画。
注意，是一个独立执行文件，不要基于我们之前实现的reanim模块。 这是动画定义文件 assets/effect/reanim/PeaShooterSingle.reanim.  
需要用到的第三方库要与我们项目的一致。

- 请分析定义文件中所有轨道的可见性,保存到文档中

- 在完成了这2个故事后，发现植物的动画效果还是不够通用，会不会我们的设计方向不对，比如，豌豆射手攻击时的动画效果，应该是 anim_shooting \ anim_idle \ anim_stem 共同作用的结果。现在播放时，是看不到头部的。

- 那是不是根本不需要配置, 根据动画轨道的帧能自动找到所有其他非动画轨道的相应要显示的帧.只要考虑配置好特殊轨道,比如 anim_stem这种轨道,或者可以配置不显示哪些轨道就行.比如攻击动画,选定要播放 anim_shooting\anim_idle, 播放所有在这2个动画定义的可见帧,如果有配置特殊轨道,就增加特殊轨道的效果,如果配置了不显示哪些轨道,就排除此轨道.

- @cmd/solution_attack_with_sway/main.go 根据这个验证程序的方式 , 实现完整的动画系统的效果展示程序,
  要能同屏展示所有的动画, 动画有100多个, 要考虑合理的布局和交互. 一个动画定义文件为一个展示单元, 默认展示一个动画,
  可配置修改默认展示的动画.点击后可展示这个单元中所有的动画效果, 涉及到多动画组合的,
  要能通过yaml配置文件配置和修改组合方式.
  
- *correct-course  除草车碾压僵尸的死亡动画不是普通的死亡动画,应该在死亡时使用僵尸的图片叠加
  这个动画变形轨道的数据
  data/reanim/LawnMoweredZombie.reanim 实现被压扁的效果.

- *correct-course  僵尸的行走动画需要优化，现在动画和僵尸的位移没有有效结合，
- 僵尸的行走动画是不是已经包含了移动? 我们的实际是不是又叠加了移动? 现在的感觉是僵尸在行走时同时又有一点平移的感觉,请检查.

- *correct-course .meta/reanim/僵尸移动说明.md 根据文档说明, 采用根运动（Root  Motion）法修正僵尸移动动画效果

- 每一关的奖励动画要修正逻辑: 植物或铲子移动到的目标位置应该是根据后续出现的奖励面板中要显示相应图片来确定，这样移动到目标位置后,奖励面板显示,但不再显示植物或铲子, 复用动画中最后显示的植物或铲子. 奖励面板的按钮要添加鼠标悬停时切换为手形以及发亮的效果。

- 参见：.meta/data/plant_hit_effects.md
| **坚果墙 (Wallnut)** | **粒子效果** | `data/particles/WallnutEatLarge.xml`<br>`data/particles/WallnutEatSmall.xml` | `data/particles/WallnutEatSmall.xml` 是在啃食时触发的， `data/particles/WallnutEatLarge.xml` 是在受损时更换图片时触发的。而且现在显示的位置也不对，应该是显示在啃食的接触点 |
| | **外观破损** | `assets/reanim/Wallnut_cracked1.png`<br>`assets/reanim/Wallnut_cracked2.png` | 根据生命值降低，外观会呈现轻微破损和严重破损状态。 |

在啃食时， 坚果墙就切换到 anim_blink_twitch动画，不摇摆了。 而且啃食时颜色要发亮，造成一闪一闪的效果。隔一小会儿就播放一次眨眼动画 anim_blink_twice 或anim_blink_thrice  随机选择

- `一大波僵尸正在接近!`的动画效果和`最后一波`的虽然效果一样，但实现完全 不同， 前者是通过下面2个资源文件，找到相应的文字 ，并为文字应用红色后实现类似于后者的动画效果。动画定义文件应该是复用的，只是替换轨道图片。
  - assets/data/HouseofTerror28.txt
  - assets/data/HouseofTerror28.png

## 粒子效果

现在要全面支持粒子效果， 例如：僵尸的手臂掉落、头掉落的效果等等，请全面分析粒子系统的配置格式，优雅的实现粒子系统。实现方案要优先使用Ebitengine 引擎，有必要的话先使用 `mcp__deepwiki` 工具的`ask_question`方法，查阅最新的文档，以找到最正确的方法

- `data/particles`：粒子系统的配置，指定粒子的发射器、轨迹与贴图（引用 `assets/particles` 中的 PNG）
- `assets/particles`：粒子系统用的贴图素材（效果精灵）。如爆炸、烟雾、火花、雨滴、泡泡、星星等（例如 `DoomShroom_Explosion_*`, `PoolSparkly.png`, `SnowPea_*`）

- 僵尸头粒子效果和原版的表现不一样,请参考我的理解,检查实现是否不正确? .meta/particles/ZombieHead.md  
data/particles/ZombieHead.xml 从实际运行 cmd/particles/main.go 看,僵尸头没有在地面弹跳的效果

-  僵尸头粒子效果和原版的表现不一样, 掉落速度慢,头滚动少,很快就消失了，没看到反弹地面的效果.是不是我们对配置文件的字段含义理解有误?或实现有误? .meta/particles/ZombieHead.md  data/particles/ZombieHead.xml  cmd/particles/main.go

- data/particles/SodRoll.xml 中的所有字段都解析并应用到渲染中了吗? 验证粒子系统的实现， 可以使用类似 `go run cmd/particles/main.go --verbose --effect="Planting"  > /tmp/p.log 2>&1` 的命令运行，并查看日志

## 8

- 现在项目的基础功能全部实现，需要根据 @.meta/whitepaper.md 的说明一步步实现关卡， 注意说明文档是大模型生成的，有可能不准确，有和你对游戏理解不一致的地方，明确提出，和我沟通确认。

### menu

- 通过 .meta/screenshot/menu 下的所有图片, 描述主菜单界面的所有信息,以便于接下来实现这个界面和功能

- 实现 .meta/data/data.md 和 docs/main-menu-spec.md 中 主菜单界面和功能。要重点查看 assets/effect/reanim/SelectorScreen.reanim 和  assets/effect/reanim/Zombie_hand.reanim,  以确定哪些是动画定义中就实现了的场景 ,哪些是需要我们二次加工实现的. 
### level1

- @level1/ 中是本关卡中的关键截图，请参考
- 注意截图只是几个关键步骤，并不代表所有的教学文本，请根据 LawnStrings.txt 文本资源确定完整的引导过程的文本
- 计划中要根据完整的资源 @assets ，确定需要用到的背景、图片、音频、动画、粒子等，基于完整的资源分析，列出需要用到的资源清单


- 现在存在的问题：
    - ✅ **已解决** 阳光掉落的位置和间隔都是固定的 → 已添加随机性（间隔8±1秒，位置±50x/±30y像素）
    - ✅ **已解决** 第一波僵尸进入有点慢 → 僵尸生成位置从X=1100-1250调整为1000-1100，减少等待时间
    - ✅ **已解决** 最后一波僵尸的动画效果还没有显示 → 代码已实现FinalWave.reanim动画（1-1关只有1波，不触发是正常的）
    - ✅ **已解决** 去掉之前测试时添加的僵尸波次提示文本和右下角的进度显示 → 已注释掉测试UI
    - ✅ **已解决** 1-1关没有铲子，请去掉 → 教学关卡自动隐藏铲子
    - ✅ **已解决** 右上角需要添加菜单按钮 → 添加了菜单按钮显示（点击功能待实现）

    - 实现右下角正式的进度条显示 → 使用原版FlagMeter资源实现图形化进度条，进度要能反应真实的僵尸波次和进攻进度
    - 菜单按钮点击响应（需要实现暂停菜单系统）
    - 植物发射子弹时需要切换到发射子弹的动画（请在资源路径 assets 查找合适的动画效果）
    - 植物种植时，地面上有土粒飞溅的效果（请在资源路径下 assets 查找合适的动画效果）
    - 每行有效的草坪左边台阶上需要增加除草车，是最后一道防线，可以一次从左到右除草，消灭所在行的所有僵尸。（正确显示除草车，能正确触发除草车动画效果，能消灭所在行所有僵尸）
    - 进度条上的旗帜标记显示（当前只显示背景和进度填充）

- @data/particles/SodRoll.xml 应该铺草皮时土粒飞溅的效果. 添加最后一波僵尸的提示动画: 
assets/effect/reanim/FinalWave.reanim. 完善进度条显示: 1.位置 
2.正确显示当前进度,僵尸头的位置要匹配进度，僵尸头开始在右边,随着进度条移动,而且进度条要有绿色的进度显示. FlagMeter.png: 背景框和绿色进度填充,一张图有2行, 根据进度百分比从左到右裁剪显示. 绿色进度填充从右到左增长.关卡文字有黑色描边效果. 文字位置要在进度条左面的外侧.  FlagMeterLevelProgress.png（装饰条）：垂直对齐：图片的Y轴中点对齐背景框的下边沿，水平居中在背景框， FlagMeterParts.png  是3部分,1 僵尸头 2: 竖线 3: 旗帜: 
assets/images/FlagMeter.png
assets/images/FlagMeterLevelProgress.png
assets/images/FlagMeterParts.png 
3. 图片前要有当前关卡的文本显示:  关卡 1-1 , 进度条和文本显示要右对齐，可以手工配置距离右边缘的位置.  开始进攻前, 只有文本显示,开始进攻时,显示完整的文本加图片进度条,文字位置要在进度条左面的外侧， 进度条不显示时,不要占位,文本要右对齐.


### level 1-2

- 本关也没有解锁铲子
- 为什么配置了有效植物有向日葵，但是向日葵无法种植

### level 1-4

- 1-4 关卡胜利后，虽然解锁的是铲子，也需要有和前面关卡类似的奖励动画， 只是植物卡包换成铲子图片， 卡包背景的粒子效果换成 data/particles/AwardPickupArrow.xml。

### level 1-6

预览就是要用anim_glow, 确认无疑. 要检查的问题是: 种植后, 是使用其他动画实现  开始时一部分在地下(anim_idle) , 一定时间后从土里长出来(anim_rise  隐藏 PotatoMine_stem轨道) 的动画效果.
  这时候才用anim_armed（隐藏anim_glow灯不亮， 不隐藏anim_glow灯亮展示头顶一闪一闪的效果）,当僵尸接近时,闪烁频率逐渐加快,直到爆炸 ( 爆炸粒子效果 PotatoMine )
  anim_glow (头顶灯常 亮). 同时要检查 为什么 2个动画的大小是不同的.

## bugs

目前存在的问题：

- [x] 向日葵种植后不会自动生产阳光
- [x] 教学关卡，自动生产的阳光的位置和时间不够随机
- [x] 优化僵尸不在有效行时的进攻逻辑，根据邻近的有效行，进攻时，保持X坐标不变，自动调整僵尸的Y坐标到有效行即可，不需要有移动的动画效果。

- [x] 樱桃炸弹的爆炸范围要考虑在边缘网格时候的情况, 如果种植在最右边网格, 爆炸范围应该包括网格右侧的范围,现在没法炸死右侧的僵尸.
- [x] 最后一波僵尸动画显示完一遍后，又会显示一次动画的开头几帧
- [x] 植物由空闲状态转为攻击状态时，有一点点抖动的感觉
- [x] 奖励面板的植物描述文本不需要阴影效果
- [x] 僵尸胜利后要显示胜利的动画
- [x] 攻击时，子弹一次正常，一次表现为2颗重叠在一起但又有一点点偏差发射的， 应该一次只发射一颗子弹。
- [x] 阳光收集的过程动画中，阳光飞向左上角的过程不是匀速的，开始要快速，快到目标位置时要减速，到目标位置时要有缩小以达到收集到阳光池的感觉
- [x] 植物和僵尸正下方要有阴影的效果
- [x] 植物卡片选择时，鼠标点击时，如果当前卡片的阳光值不足，当前总阳光值需要有交互表现：阳光数字要红/黑闪烁
- [x] 在教学关卡，提示选择植物卡片上要有闪烁效果，而且下方的闪烁的箭头要一直显示，直到选择，鼠标悬停时要切换为手形
- [x] 教学关卡，提示种植植物时，草皮闪烁的效果是应用在渲染的整个草皮上，而不是网格
- [x] 爆炸死亡的僵尸，死亡动画要使用专用的烧焦黑化的动画
- [x] 掉落的阳光要保证不能全部或部分显示在屏幕外
- [x] 向日葵在生产阳光时，脸部会发出渐变的金色的亮光
- [x] 很多植物在被攻击时，有动画或粒子效果，请根据 reanim 和 particles 资源， 推断全部的效果并汇总

- 我们之前重构动画系统时, 由中心锚点改为了左上角锚点,现在的问题和这个改动有关系吗?

- [x] epic 19 实现后，还有以下问题:
  - [x] 打开后，显示了植物选择栏 。 
  - [x] 没有显示dave的动画
  - [x] 整个关卡没有生成阳光的逻辑
  - [x] dave 对话环节，不使用手形光标,使用默认光标
  - [x] 鼠标悬停在卡槽上时要切换为手形，指向铲子卡槽的箭头要改为指向铲子本身
  - [x] 除草车和僵尸是铲子教学后，传送带环节才出现的
  - [x] 铲子卡槽位置不正确， 应该是相对于右上角菜单按钮的相对偏左x px

  - [x] 点击铲子后，鼠标光标没显示成铲子，也看不到光标。 铲子被 选中后,卡槽中就不显示铲子了
  - [x] 铲子悬停在植物上时，植物没变亮
  - [x] 没有显示下方的教学文本
  - [x] 铲除植物的任务完成后，进入下一流程前要自动恢复鼠标和铲子卡槽的状态
  - [x] 第二阶段的dave对话框的文本显示的是key，没有显示对应的文本内容，而且点击继续的颜色不是黑色，位置也偏下

  - [x] 教学文本提示半透明背景高度要小一点， 位置再偏下一点，显示的文字要调大到28号
  - [x] 传送带的履带是显示在传送带的下边，不是上边
  - [x] 传送带的履带和传送带为什么长度不一致？
  - [x] 坚果和种植预览是要显示植物卡包的形式（不显示阳光值），现在显示成方框了。选中后，要有禁用状态效果
  - [x] 坚果卡包的大小要以比例来配置，等比例缩小，要在config配块中配置，不要放在 level 配置文件中.显示在传送带时，要垂直居中。
  - [x] 坚果卡包进入时要从传送带右边外侧进入，不要直接在传送带中生成，进入前是不可见，进入时要支持部分可见
  - [x] 传送带中卡包传送速度太快，要可配置，而且传送带要有左侧内边距的配置
  - [x] 如果弹射后没碰到僵尸要直到最边缘的网格边界时才反弹，不要在中间的网格就反弹了
  - [x] 传送带履带的速度要和卡包的速度保持一致。请系统性设计简洁的方案达到传送带和卡片的移动相对是静止的。卡片移动过程保持等 距（后期加大距离 ）。卡片顶到最左时停止（卡槽最左或前边已经停止的卡片）
  - [x] 补充了转场期间部分流程的说明，请实现
  - [x] 种植在红线右侧时要在教学文字区显示提示不能种植的文字，而且网格中的预览图像不显示，但鼠标光标的预览图像要显示，也不取消选中状态
  - [x] 结束后要触发 1. 奖励动画和奖励面板 或 2.僵尸胜利动画
  - [x] 卡包悬停时鼠标要切换为手形，而且传送过程中也要可点击选择

- [x] 僵尸走入房子后，脚下阴影的渲染层级处理要和僵尸保持一致，现在渲染到门框上面了
- [x] 进入主菜单界面后，有用户 ，但是用户显示用户 名是空的，下面用户管理的按钮也无法点击
- [x] 全屏后分辨率会下降，就算恢复原来大小分辨率也有下降，而且左右两边有黑边，感觉没有恢复原来的大小或比例
- [x] 选项面板中的滑块和复选框按钮悬停时鼠标要切换为手形

- [x] 樱桃炸弹的爆炸粒子效果要和爆炸坚果一样

  日志(文件很大): /tmp/pvz.log 
## 架构

- reanim 模块的设计和使用是否有不符合架构设计的地方？
- *correct-course 请找出 pkg/systems 下的巨婴文件, 给出优化方案, 精简不必要或过期的注释.

### 原始版本

动画锚点我们开始实现时采用中心锚点， 在某些场景会有繁琐的问题，后来重构改为左上角，发现又引起了另一些问题（不是十分确定由锚点的改变引起），总之是动画效果受到了影响，经常需要更改锚点的计算或采取额外的计算才能正常。请系统性全面的分析动画渲染的场景和问题，确定渲染锚点选择的最佳方案。

### 优化版本

**背景**
本项目的 Reanim 动画渲染系统经历了两次锚点方案调整：
- **初始方案**：采用中心锚点（center anchor）进行渲染
- **重构方案**：改为左上角锚点（top-left anchor）

**问题描述**
1. **中心锚点阶段**：在某些渲染场景下需要进行繁琐的坐标转换计算
2. **左上角锚点阶段**：重构后疑似引入新问题，动画效果异常，需要频繁调整锚点计算或添加额外的补偿逻辑才能正常显示

**不确定性**
目前不完全确定动画异常是否完全由锚点变更导致，可能存在其他潜在因素。

**需求目标**
请系统性地进行以下分析：

1. **场景梳理**：全面识别项目中所有涉及 Reanim 动画渲染的场景（植物、僵尸、粒子、UI 等）
2. **问题诊断**：分析当前左上角锚点方案在各场景下的问题根因
3. **方案对比**：评估中心锚点 vs 左上角锚点在各场景下的优劣势
4. **最佳实践**：基于 Reanim 文件格式规范和本项目架构，确定推荐的锚点方案
5. **迁移影响**：如需调整方案，评估影响范围和迁移成本

**期望输出**
- 明确的锚点选择建议（中心/左上角/混合方案）
- 每种场景下的坐标计算公式
- 需要修改的代码位置清单