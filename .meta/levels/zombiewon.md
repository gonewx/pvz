# **功能需求文档：游戏结束（僵尸获胜）流程**

## **1. 概述**
**目标**：完美复刻原版《植物大战僵尸》中玩家失败时的经典“惨叫”与“脑子被吃”的过场效果。
**核心体验**：惊悚中带有黑色幽默，通过突然的音效和夸张的文字给玩家留下深刻印象。

---

## **2. 触发条件 (Trigger)**
*   **判定逻辑**：当任意一只僵尸的**判定框（Hitbox）**完全越过最左侧的“底线”（通常是房屋的门槛X轴坐标）。
*   **互斥性**：只要有一只僵尸触发此条件，游戏立即锁定，忽略后续其他僵尸的移动或植物的攻击判定（即：只触发一次，防止重复判定）。

---

## **3. 详细交互流程 (Flow & Interaction)**

整个过程分为三个阶段，总时长约为 4~5 秒，随后进入UI交互界面。

### **第一阶段：入侵与锁定 (The Breach) - Phase 1**
*   **时机**：触发判定后的 0.0秒 - 1.5秒（约）。
*   **画面表现**：
    1.  **镜头锁定**：如果当前地图可以卷动（如生存模式），镜头强制移动并锁定在僵尸入侵的那一行/区域。
    2.  **全场冻结（软停止）**：
        *   植物选择栏、菜单按钮、关卡进度条消失
        *   所有植物停止攻击动画（保持最后一帧）。
        *   所有子弹/投掷物悬停或消失。
        *   **例外**：触发失败的那只僵尸在 Phase 1 期间也被冻结（等待 Phase 2）。
    3.  **背景音乐**：瞬间停止（Fade out 时间极短，几乎是截断）。

### **第二阶段：僵尸入侵 (Zombie Entry) - Phase 2 (新增 2025-11-21)**
*   **时机**：Phase 1 结束后（1.5秒后）。
*   **两步同时执行**：
    1.  **Step 1 - 摄像机移动**：
        *   摄像机从当前位置平滑左移到世界坐标 0（展示房子完整场景）
        *   移动速度：200 像素/秒
    2.  **Step 2 - 僵尸行走到房子**：
        *   本部分是独立动画，不受接下来其他动画的影响
        *   摄像机移动时，僵尸也同时开始移动
        *   僵尸播放行走动画（anim_walk）
        *   僵尸移动速度：VX=-150.0（向左），VY 根据目标位置自动调整
        *   第1个目标位置：房子门口，以 background1_gameover_mask.png 相对位置来配置
        *   第2个目标位置: 僵尸到达第1个目标位置后，只在X轴前进，到达这个位置后触发 phrase 3, 但僵尸并不消失，继续走
*   **进入 Phase 3条件**：
        *   摄像机到达目标 且 僵尸到达第2个目标位置（即马上要进入房子，以第1个目标位置的X相对偏移来配置） 


### **第三阶段：惨叫与图文展示 (The Scream) - Phase 3**
*   **时机**：僵尸到达房子门口后
*   **音频**：
    *   播放音效 `scream.ogg`（那声经典的"NOOOO!"惨叫）。
    *   紧接着播放音效 `chomp.ogg`（夸张的咀嚼声、碎裂声）。
*   **画面表现**：
    **动画**：
        屏幕中央弹出经典的"僵尸吃脑子"动画（data/reanim/ZombiesWon.reanim）。
        本身动画渲染时动画自身还需要有一个轻微的**抖动特效**，模拟惊悚感。

        assets/reanim/ZombiesWon.jpg assets/reanim/ZombiesWon_.png 对应的是这2个资源, 图片和对应的蒙板, 需要 合成 RGB 和 Alpha 通道. 
---

### **第四阶段：UI交互与后续 (UI Logic) - Phase 4**

*   **时机**：Phase 3 动画播放完成后立即显示
*   **弹出对话框**：
    *   显示标准的“游戏结束”对话框。
    *   **标题**: `游戏结束`
    *   **描述**: 无
    *   **按钮选项**：**再次尝试**：重新加载当前关卡，重置所有数据。

---

## **5. 资源需求清单 (Assets)**

请开发确认是否已准备好以下资源：

1.  **音效**：
    *   `scream.ogg` (男声惨叫)
    *   `chomp_soft.ogg` (咀嚼声)
    *   `music_stop` (音乐停止的指令或短音效)
2.  **图片**：
    *   `ZombiesWon.png` (吃脑子的插画，需带透明通道或纯黑背景)
3.  **字体**：
    *   `PvZUIGameOver.ttf` (或原版使用的HouseOfTerror字体)

---

## **6. 开发注意事项 (Q&A)**

*   **Q: 如果有割草机（Lawn Mower）怎么办？**
    *   **A:** 割草机是最后一道防线。僵尸必须先触发割草机，割草机开走并消失后，僵尸再次走到该位置，才算触发上述的“游戏结束”流程。
*   **Q: 巨人僵尸扔出的小鬼（Imp）直接飞进最左侧怎么办？**
    *   **A:** 逻辑同上。只要小鬼落地的X坐标超过判定线，不需要播放“走进房子”的动画，直接进入**第二阶段（黑屏+惨叫）**。
*   **Q: 文本是否需要汉化？**
    *   **A:** 是的。中文版文案为：“**僵尸吃掉了你的脑子！**”，保持原版字体的抖动效果。

