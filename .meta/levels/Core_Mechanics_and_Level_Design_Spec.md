# 植物大战僵尸核心机制与关卡设计规范

## 开场镜头（Level Preview / Pan-to-Right）中僵尸数据的详细解构

### 1. 核心结论

*   **僵尸种类 (Types)**：**强关联**。展示的僵尸必须且只能是本关卡配置表（Level Config）中允许出现的僵尸。
*   **僵尸数量 (Quantity)**：**弱关联**。展示的数量通常与关卡的总体难度系数挂钩，但并不等于关卡实际僵尸总数。
*   **站位 (Position)**：**完全随机**。只是为了视觉上的错落有致，没有战术意义。
*   **与真实进攻的关系**：**没有实体对应关系**。镜头移回左边后，右边展示的这些僵尸实际上被“销毁”了，并不会直接变成第一波进攻的怪。

---

### 2. 详细规则拆解

#### A. 僵尸种类：严格的“剧透”机制
这是开场镜头最重要的功能——**情报侦察**。
在选卡界面（Seed Selection）之前，镜头右移是为了告诉玩家：“这关有铁桶，记得带磁力菇；有气球，记得带仙人掌。”

*   **规则**：程序读取本关卡的 `Zombie_Pool`（可用僵尸列表）。
*   **实现**：
    *   展示的僵尸必须从 `Zombie_Pool` 中随机抽取。
    *   **特例**：某些特殊僵尸（如雪人僵尸）如果本关脚本强制出现，可能高概率出现在展示画面中。
    *   **Bug/Feature**：如果关卡里只有普通僵尸，展示画面里就全是普通僵尸。

#### B. 僵尸数量与密度：氛围组
展示的僵尸数量不是本关实际要打的僵尸总数（那屏幕放不下），而是一个**“难度可视化”**的参数。

*   **规则**：通常基于关卡的 `Difficulty_Index`（难度指数）或一个预设的 `Preview_Count`（展示数量）。
    *   **Level 1-1**：展示画面可能只有 3-4 只普通僵尸。
    *   **Level 5-9**：展示画面会密密麻麻站满屏幕，体现“尸潮”的压迫感。
*   **实现**：
    *   程序设定一个区间，比如 `min=5`, `max=15`。
    *   根据僵尸类型权重（Weight）填充。比如巨人僵尸占地大，权重大；普通僵尸权重小。

#### C. 站位与状态：纯视觉随机
*   **站位**：在右侧屏幕的有效区域内（草坪上）随机生成 X,Y 坐标。为了防止穿模太严重，通常会简单的按照 Y 轴（行）进行排序渲染（Z-Order），保证下方的遮挡上方的。
*   **动作**：它们处于 `Idle`（待机）或 `Menu_Idle` 状态，可能会有一些特殊的展示动作（比如偶尔扭头），但不会前进。

#### D. 镜头切回后的“销毁”
这是最容易产生误解的地方。

*   **现象**：镜头看右边 -> 有个路障僵尸在第3行 -> 镜头切回左边 -> 选卡 -> 游戏开始。
*   **真实情况**：
    *   **第一波进攻并不是那个路障僵尸**。第一波通常是脚本写死的（如之前讨论的Level 1-2，前30秒极可能是普通僵尸）。
    *   **那个路障僵尸去哪了？** 程序上，当镜头切回左侧，或者玩家点击“Let's Rock!”之后，右侧展示用的僵尸实例（Instance）会被直接**清除/卸载**。
    *   真正的进攻僵尸是由我们在上一条回答中设计的**波次管理器**重新生成的。

---

### 3. 产品需求描述 (PRD) - 供开发参考

为了实现原版的效果，请按以下逻辑编写开场代码：

#### **功能模块：关卡预览 (Level Preview)**

1.  **数据源获取**：
    *   读取 `Level_Config.zombie_pool`（本关允许出现的僵尸列表）。

2.  **生成展示队列 (Preview Generation)**：
    *   设定展示总权重值 `Total_Preview_Weight`（基于关卡难度）。
    *   从 Pool 中随机抽取僵尸，直到填满权重值。
    *   *逻辑修正*：确保高威胁僵尸（如橄榄球、巨人）如果存在于 Pool 中，有较高优先级被展示，以起到提示玩家的作用。

3.  **渲染 (Rendering)**：
    *   在场景坐标 `X > 800` (屏幕右侧外) 的区域随机分布这些僵尸。
    *   **播放状态**：循环播放 `Anim_Idle`。

4.  **清理 (Cleanup)**：
    *   **触发点**：当镜头完全移回左侧，且进入“选卡阶段”或“游戏主循环”时。
    *   **动作**：`Preview_Zombies.Clear()`。销毁所有预览对象，释放内存。

5.  **实际游戏循环 (Game Loop)**：
    *   从零开始计时，严格按照关卡脚本（Level Script）生成全新的僵尸实例。

