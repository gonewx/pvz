# **PvZ 关卡 1-5 设计与实现规范 (Level 1-5 Spec)**

作为获取了铲子（1-4 奖励）后的第一个关卡，1-5 在正式开始“保龄球”之前，有一个**强制性的铲子教学环节**。

如果不加这个环节，玩家拿到了铲子却不知道怎么用，到了 1-6 就会很困惑。而且从叙事上，戴夫需要一个理由把所有的植物清空来为“保龄球”腾出场地。

这是 **Level 1-5 铲子教学阶段** 的产品需求说明：

---

## Level 1-5 阶段1 - 铲子教学 : Shovel Tutorial**

### **1. 概述**
在关卡加载完成后，**不能**直接显示传送带和僵尸。必须先进入“铲子教学模式”。

### **2. 初始场景配置 (Initial Setup)**
*   **植物预设**:
    *   在草地上预先生成 **3株 豌豆射手 (Peashooters)**。
    *   **位置**: 建议固定在散乱的位置，例如 `(行2, 列6)`, `(行3, 列8)`, `(行4, 列7)`，以模拟“上一关残留”或“乱种”的感觉。
*   **UI状态**:
    *   **传送带**: **隐藏 (Hidden)**。
    *   **铲子槽**: **显示 (Visible)**。
    *   **植物卡槽**: 无。

### **3. 戴夫的脚本流程 (Crazy Dave Script)**

此阶段完全由疯狂戴夫（Crazy Dave）的对话驱动：

对话框显示在屏幕上方居中偏右一点的位置, 要使用相对于dave 动画显示位置的相对偏移来确定位置. 背景使用这个图片资源: Store_SpeechBubble2.png, 文字使用18号字段黑色,垂直和水平居中显示. 最下面一行固定显示`点击继续`. 

Dave 从屏幕左侧滑入和滑出

文本不需要逐字显示. 表情是指示dave 动画,  推进对话时，根据表情切换动画,不是要加在文本对话框中.

1.  **开场白**:
    通过文本key加载
    *   Dave: *CRAZY_DAVE_2400* （你好，我的邻居！）
    *   Dave: *CRAZY_DAVE_2401* （我的名字叫疯狂的戴夫。）
    *   Dave: *CRAZY_DAVE_2402* （ 但你叫我疯狂的戴夫就行了。 ）
    *   Dave: *CRAZY_DAVE_2403* （ 听好，我有个惊喜要给你。 ）
    *   Dave: *CRAZY_DAVE_2404* （ 但是首先，我需要你清理一下草坪。 ）

2.  **强制引导 (The Lock)**:
    *   Dave: *CRAZY_DAVE_2405* （ 用你的铲子挖出那些植物！ ）
    *   Dave: *CRAZY_DAVE_2406* （ 开始挖吧！{MOUTH_SMALL_OH} {SCREAM} ）
    *   **操作限制**: 此时游戏进入**强引导模式**。
        *   玩家**无法**进行除“点击铲子”和“点击植物”以外的任何操作。
        *   如果玩家长时间（如 5秒）不操作，出现浮动手指动画：指向右上角铲子 -> 拖动/点击 -> 指向豌豆射手。

3.  **完成条件**:
    *   系统实时检测场上植物数量。
    *   当 **Plant_Count == 0** 时，触发下一步。

4.  **转场 (Transition)**:
    *   Dave: *"Ok goody, now for the surprise..."* (好极了，现在是惊喜时间……)
    *   Dave: *"We're going BOWLING!"* (我们要去打保龄球了！)
    *   **动作**:
        1.  Dave 消失。
        2.  **铲子槽保持显示**（保龄球模式下仍可使用铲子）。
        3.  **传送带 UI 滑入**。
        4.  屏幕显示 *"Wall-nut Bowling"* 大字。
        5.  开始正式的关卡逻辑（生成第一颗坚果）。

---

### **4. 给开发的实现备注 (Dev Notes)**

*   **铲子手感**: 这一步也是测试铲子交互逻辑的时候。点击铲子后，鼠标光标应变为铲子图标；点击植物时，应播放土块飞溅的特效和音效 (`plant_dig.wav`)，植物瞬间消失，**不返还阳光**。
*   **状态互斥**: 务必确保在结束前，传送带逻辑是**暂停 (Paused)** 的，绝对不能在玩家还在挖植物的时候就刷出坚果或僵尸。

**这是一个“特殊机制关卡”（Mini-game Level）**。它彻底改变了之前的核心玩法（不再产阳光、不再自由种植），而是采用了**“传送带 + 坚果保龄球”**的机制。开发重点在于**物理碰撞逻辑**和**传送带算法**。

## **1. 关卡概况 (Overview)**

*   **关卡 ID**: `Level_1_5`
*   **关卡名称**: 坚果保龄球 (Wall-nut Bowling)
*   **场景**: 白天 - 前院 (Day - Front Yard)
*   **核心玩法**: 玩家不能选择植物卡片。植物（坚果）通过屏幕上方的传送带送达。玩家将坚果种在底线（A列），坚果会像保龄球一样沿直线滚动攻击僵尸。
*   **通关奖励**: 土豆地雷 (Potato Mine)。

## **2. 核心机制：传送带系统 (Conveyor Belt System)**

本关没有阳光（Sun）概念，UI 左上角的阳光槽被移除，替换为传送带。

### **2.1. 传送带逻辑**
*   **位置**: 屏幕左上方。
*   **容量**: 最多容纳 **10张** 卡片。
*   **填充规则**:
    *   当传送带未满时，根据**时间间隔**和**权重**生成新的卡片。
    *   卡片从右侧滑入，向左侧堆积。
*   **卡片池 (Card Pool) & 权重**:
    *   **普通坚果 (Wall-nut)**: 权重 **85%**。
    *   **爆炸坚果 (Explode-o-nut)**: 权重 **15%** (红色的坚果)。
    *   *注意：随着关卡进度推进，爆炸坚果的生成概率可以微调提升，特别是在大波次前。*

### **2.2. 操作交互**
*   **放置限制**: 玩家只能将卡片拖放到**红线（Red Line）以左**的区域（即最左侧的 A、B 列）。
*   **自动发射**: 一旦放置在某一行，坚果立即进入“滚动状态”。
*   **选中坚果**: 选中后，和前面关卡选中植物效果一样，鼠标光标处和草坪相应网格中出现预览效果。卡槽中坚果变为禁用（ 半透明遮罩 ）

---

## **3. 核心机制：保龄球物理系统 (Bowling Physics)**

这是本关开发的最大难点，需要独立的碰撞逻辑。

### **3.1. 滚动与伤害判定**
*   **弹药 A：普通坚果 (Wall-nut)**
    *   **轨迹**: 沿当前行直线滚动。
    *   **初次命中**: 当接触到第一个僵尸时：
        1.  造成 **大量伤害**（一般设定为秒杀普通僵尸，打掉路障的帽子）。
        2.  触发 **“弹射 (Ricochet)”** 逻辑。
    *   **弹射逻辑 (关键)**:
        *   坚果向**相邻的行**（上或下）弹开，角度约为 45度。
        *   *优先级规则*: 优先弹向“X轴距离最近”的邻行僵尸。如果邻行没有僵尸，则碰墙反弹（边缘行）。
    *   **二次/多次命中**: 弹射后的坚果若再次击中僵尸，继续造成伤害并尝试再次弹射。
    *   **销毁**: 滚出屏幕右边缘，或达到最大弹射次数（通常无限制，直到滚出屏幕）。

*   **弹药 B：爆炸坚果 (Explode-o-nut)**
    *   **外观**: 红色的坚果。
    *   **轨迹**: 沿当前行直线滚动。
    *   **命中效果**:
        *   接触第一个僵尸时，**立即爆炸**。
        *   **效果**: 应用粒子效果 `Powie.xml`。对 3x3 范围内的所有僵尸造成**巨量伤害**（1800伤害，秒杀范围内一切）。有爆炸的动画效果。
        *   **不弹射**: 爆炸后直接销毁。

### **3.2. 僵尸受击反馈**
*   **击退效果**: 无（坚果保龄球通常不击退，是直接造成伤害）。
*   **音效**: 必须有清脆的保龄球撞击声 (`bowling_impact.wav`) 和观众欢呼声（当一次击中多个僵尸时）。

---

## **4. 僵尸配置 (Zombie Configuration)**

本关是“Boss关”性质，怪量极大，节奏极快。

*   **僵尸池**:
    *   `Zombie_Normal` (普通僵尸)
    *   `Zombie_Conehead` (路障僵尸) - *主要承受者*

---

## **5. 关卡脚本与波次 (Level Script)**

本关没有“旗帜”概念上的休息时间，是连续的高压进攻。但在UI上依然显示进度条。

### **阶段一：热身 (Warm Up)**
*   **0% - 15% 进度**
*   **出怪**: 仅普通僵尸。
*   **传送带**: 100% 普通坚果。
*   **目的**: 让玩家熟悉“瞄准-射击”和“弹射”的手感。

### **阶段二：路障引入 (Conehead Phase)**
*   **15% - 40% 进度**
*   **出怪**: 引入路障僵尸，开始出现 2-3 只的小队。
*   **传送带**: 开始以低概率（约 10%）生成爆炸坚果。
*   **PM Note**: 这里的压力点在于路障僵尸需要撞两次（或一次弹射+一次直击）才能死。

### **阶段三：高压与铁桶 (Heavy Phase)**
*   **40% - 90% 进度**
*   **出怪**: 引入铁桶僵尸和撑杆僵尸。怪群密度增大。
*   **传送带**: 爆炸坚果概率提升至 15%-20%。
*   **PM Note**: 玩家需要学会“屯牌”。不要有怪就发，要等怪聚成一条线或者聚成一堆时，用爆炸坚果清场。

### **阶段四：最终波 (Final Wave)**
*   **100% 进度**
*   **UI**: 最后一波动画
*   **出怪**:
    *   大量的普通和路障僵尸。
*   **传送带逻辑修正**: 在最终波触发时，**强制**在传送带上生成 2-3 个爆炸坚果，确保玩家有清场能力。

---

## **6. 视觉与音频需求 (Assets)**

### **6.1. 场景元素**
*   **红线 (The Red Line)**:
    *   在网格横坐标约 300px 处（第3列和第4列之间）绘制一条红色的粗线。
    *   作用：视觉提示，告诉玩家坚果只能种在线左边。

### **6.2. 动画**
*   **坚果滚动**: 需要一个 `Roll` 的循环动画（坚果要在地上滚，不能平移）。
*   **坚果撞击**: 撞击瞬间有一个轻微的 `Hit` 帧和粒子特效。

### **6.3. 音效**
*   `bowling_roll.ogg`: 坚果在地板上滚动的循环音。
*   `bowling_strike.ogg`: 击中僵尸的撞击声。
*   `explosion.ogg`: 爆炸坚果的爆炸声。

---

## **7. 异常与兜底 (Edge Cases)**

1.  **如果僵尸走过了红线怎么办？**
    *   **设计**: 红线只是“发射区限制”，不是“失败判定线”。僵尸走过红线后，依然可以被坚果打中。
    *   *判定*: 只要僵尸没进屋子触发割草机，游戏继续。

2.  **坚果可以打中还没完全走进屏幕的僵尸吗？**
    *   **设计**: 可以。只要僵尸的 Hitbox 进入了屏幕右边缘，就可以被击中。

---

## **8. 验收标准 (Acceptance Criteria)**

1.  [ ] 玩家无法点击阳光，也没有阳光掉落。
2.  [ ] 玩家无法将坚果放置在红线右侧。
3.  [ ] 普通坚果击中僵尸后能正确地向邻行弹射。
4.  [ ] 爆炸坚果能秒杀范围内的所有僵尸。
6.  [ ] 关卡结束时，正确掉落“土豆地雷”卡片。

