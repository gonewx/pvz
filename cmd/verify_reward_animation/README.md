# å®Œæ•´å¥–åŠ±åŠ¨ç”»æµç¨‹éªŒè¯ç¨‹åº

## æ¦‚è¿°

æœ¬éªŒè¯ç¨‹åºç”¨äºæµ‹è¯•**å®Œæ•´çš„å¥–åŠ±åŠ¨ç”»æµç¨‹**ï¼ˆStory 8.3 + 8.4ï¼‰ï¼ŒåŒ…æ‹¬ï¼š

1. **Phase 1 (appearing)**: å¡ç‰‡åŒ…å¼¹å‡ºåŠ¨ç”» (0.3ç§’)
2. **Phase 2 (waiting)**: ç­‰å¾…ç©å®¶ç‚¹å‡»
3. **Phase 3 (expanding)**: å¡ç‰‡åŒ…å±•å¼€åŠ¨ç”» (2ç§’)
4. **Phase 4 (showing)**: æ˜¾ç¤ºå¥–åŠ±æ¤ç‰©ä»‹ç»é¢æ¿ï¼ˆå«æ¤ç‰©å¡ç‰‡ï¼‰
5. **Phase 5 (closing)**: æ·¡å‡ºå…³é—­åŠ¨ç”» (0.5ç§’)

## ä¸å…¶ä»–éªŒè¯ç¨‹åºçš„åŒºåˆ«

| éªŒè¯ç¨‹åº | åŠŸèƒ½èŒƒå›´ | è¯´æ˜ |
|---------|---------|------|
| `verify_reward_card` | Phase 1-3 | ä»…éªŒè¯å¡ç‰‡åŒ…åŠ¨ç”»ï¼Œ**ä¸æ˜¾ç¤ºé¢æ¿** |
| `verify_reward_panel` | Phase 4 | ä»…éªŒè¯é¢æ¿æ¸²æŸ“ï¼Œ**æ‰‹åŠ¨åˆ›å»ºé¢æ¿å®ä½“** |
| **`verify_reward_animation`** | **Phase 1-5** | **å®Œæ•´æµç¨‹éªŒè¯ï¼Œè‡ªåŠ¨åˆ›å»ºé¢æ¿** |

## ç¼–è¯‘

```bash
go build -o bin/verify_reward_animation ./cmd/verify_reward_animation
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æµ‹è¯•å‘æ—¥è‘µå¥–åŠ±åŠ¨ç”»ï¼ˆé»˜è®¤ï¼‰
./bin/verify_reward_animation

# æµ‹è¯•è±Œè±†å°„æ‰‹å¥–åŠ±åŠ¨ç”»
./bin/verify_reward_animation --plant=peashooter

# æµ‹è¯•æ¨±æ¡ƒç‚¸å¼¹å¥–åŠ±åŠ¨ç”»
./bin/verify_reward_animation --plant=cherrybomb

# æµ‹è¯•åšæœå¢™å¥–åŠ±åŠ¨ç”»
./bin/verify_reward_animation --plant=wallnut

# æ˜¾ç¤ºè¯¦ç»†è°ƒè¯•ä¿¡æ¯
./bin/verify_reward_animation --plant=sunflower --verbose
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--plant` | string | `sunflower` | æ¤ç‰©ID (`sunflower`, `peashooter`, `cherrybomb`, `wallnut`) |
| `--verbose` | bool | `false` | æ˜¾ç¤ºè¯¦ç»†è°ƒè¯•æ—¥å¿— |

## å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `Space` / `Left Click` | å±•å¼€å¡ç‰‡åŒ… | åœ¨ Phase 2 (waiting) æ—¶æ‰‹åŠ¨è§¦å‘å±•å¼€åŠ¨ç”» |
| `R` | é‡å¯éªŒè¯ | é‡æ–°å¼€å§‹æ•´ä¸ªå¥–åŠ±åŠ¨ç”»æµç¨‹ |
| `Q` | é€€å‡ºç¨‹åº | å…³é—­éªŒè¯ç¨‹åº |

## éªŒè¯æµç¨‹

```
å¯åŠ¨ç¨‹åº
    â†“
è‡ªåŠ¨è§¦å‘å¥–åŠ±åŠ¨ç”»
    â†“
Phase 1: appearing (0.3s)
  - å¡ç‰‡åŒ…ä»ä¸‹æ–¹å¼¹å‡º
  - ç¼©æ”¾ä» 0.0 â†’ 1.0
    â†“
Phase 2: waiting (ç­‰å¾…)
  - æ˜¾ç¤ºå®Œæ•´çš„å¡ç‰‡åŒ…
  - ç­‰å¾…ç©å®¶æŒ‰ Space æˆ–ç‚¹å‡»
    â†“
ã€ç©å®¶æ‰‹åŠ¨è§¦å‘ã€‘â† Space / Left Click
    â†“
Phase 3: expanding (2.0s)
  - å¡ç‰‡åŒ…å±•å¼€åŠ¨ç”»
  - ç¼©æ”¾ä» 1.0 â†’ 2.0
  - åˆ›å»º Award ç²’å­å…‰æ™•æ•ˆæœ
    â†“
Phase 4: showing (æŒç»­)
  - è‡ªåŠ¨åˆ›å»ºå¥–åŠ±é¢æ¿å®ä½“ (RewardPanelComponent)
  - æ¸²æŸ“é¢æ¿èƒŒæ™¯ã€æ¤ç‰©å›¾æ ‡ã€æ¤ç‰©åç§°ã€æè¿°
  - è‡ªåŠ¨åˆ›å»ºæ¤ç‰©å¡ç‰‡å®ä½“ (PlantCardComponent)
  - å¡ç‰‡ç¼©æ”¾åŠ¨ç”»: 0.5 â†’ 1.5
    â†“
ã€ç©å®¶æ‰‹åŠ¨å…³é—­ã€‘â† Space / Left Click
    â†“
Phase 5: closing (0.5s)
  - æ·¡å‡ºåŠ¨ç”»
  - æ¸…ç†æ‰€æœ‰å®ä½“
    â†“
éªŒè¯å®Œæˆ
```

## é¢„æœŸæ•ˆæœ

### Phase 1-3: å¡ç‰‡åŒ…åŠ¨ç”»
- âœ… å¡ç‰‡åŒ…ä»ä¸‹æ–¹å¹³æ»‘å¼¹å‡º
- âœ… ç­‰å¾…ç©å®¶ç‚¹å‡»æ—¶é™æ­¢æ˜¾ç¤º
- âœ… ç‚¹å‡»åå±•å¼€åŠ¨ç”»æµç•…ï¼ˆ2ç§’ï¼‰
- âœ… å±•å¼€æ—¶åˆ›å»º Award ç²’å­å…‰æ™•æ•ˆæœï¼ˆ13ä¸ªå‘å°„å™¨ï¼‰

### Phase 4: å¥–åŠ±é¢æ¿æ˜¾ç¤º
- âœ… é¢æ¿èƒŒæ™¯å±…ä¸­æ˜¾ç¤ºï¼ˆ`SeedChooser_Background.png`ï¼‰
- âœ… æ¤ç‰©å›¾æ ‡ä½¿ç”¨ Reanim ç³»ç»Ÿæ¸²æŸ“ï¼ˆå¸¦åŠ¨ç”»ï¼‰
- âœ… æ˜¾ç¤ºæ¤ç‰©åç§°ã€æè¿°æ–‡æœ¬ï¼ˆä» LawnStrings åŠ è½½ï¼‰
- âœ… è‡ªåŠ¨åˆ›å»ºæ¤ç‰©å¡ç‰‡å®ä½“
- âœ… å¡ç‰‡æ°´å¹³å±…ä¸­ï¼Œå‚ç›´ä½ç½®æ­£ç¡®
- âœ… å¡ç‰‡ç¼©æ”¾åŠ¨ç”»ä» 0.5 â†’ 1.5

### Phase 5: å…³é—­åŠ¨ç”»
- âœ… ç‚¹å‡»åæ·¡å‡º (0.5ç§’)
- âœ… æ‰€æœ‰å®ä½“æ­£ç¡®æ¸…ç†

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šé¢æ¿ä¸æ˜¾ç¤º

**æ£€æŸ¥ï¼š**
1. ç¡®è®¤ Phase 3 (expanding) å·²å®Œæˆï¼ˆæŒç»­ 2 ç§’ï¼‰
2. æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰ `"åˆ›å»ºå¥–åŠ±é¢æ¿å®ä½“"` æ¶ˆæ¯
3. ä½¿ç”¨ `--verbose` æŸ¥çœ‹è¯¦ç»†æ¸²æŸ“çŠ¶æ€

### é—®é¢˜ï¼šæ¤ç‰©å¡ç‰‡ä½ç½®ä¸æ­£ç¡®

**æ£€æŸ¥ï¼š**
1. ç¡®è®¤ `RewardPanelRenderSystem` æ­£ç¡®åˆ›å»ºå¡ç‰‡å®ä½“
2. æŸ¥çœ‹æ—¥å¿—ä¸­çš„å¡ç‰‡ä½ç½®è®¡ç®—ï¼ˆåº”è¯¥æ°´å¹³å±…ä¸­ï¼‰
3. æ£€æŸ¥ `config.PlantCardRewardPanelOffsetY` é…ç½®å€¼

### é—®é¢˜ï¼šæ¤ç‰©å›¾æ ‡ä¸æ˜¾ç¤ºåŠ¨ç”»

**æ£€æŸ¥ï¼š**
1. ç¡®è®¤ `ReanimSystem.Update()` åœ¨ä¸»å¾ªç¯ä¸­è°ƒç”¨
2. ç¡®è®¤ Reanim èµ„æºå·²æ­£ç¡®åŠ è½½ï¼ˆæŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼‰
3. ä½¿ç”¨ `--verbose` æŸ¥çœ‹ Reanim ç³»ç»ŸçŠ¶æ€

## å®ç°ç»†èŠ‚

### æ ¸å¿ƒç³»ç»Ÿ

- **RewardAnimationSystem**: ç®¡ç†æ•´ä¸ªå¥–åŠ±åŠ¨ç”»æµç¨‹ï¼ˆ5ä¸ªé˜¶æ®µï¼‰
- **RewardPanelRenderSystem**: æ¸²æŸ“å¥–åŠ±é¢æ¿ï¼ˆè‡ªåŠ¨åˆ›å»ºæ¤ç‰©å¡ç‰‡å®ä½“ï¼‰
- **PlantCardRenderSystem**: æ¸²æŸ“æ¤ç‰©å¡ç‰‡å®ä½“ï¼ˆä½¿ç”¨ç»Ÿä¸€å·¥å‚ï¼‰
- **ParticleSystem**: æ›´æ–°ç²’å­æ•ˆæœï¼ˆAward å…‰æ™•ï¼‰
- **RenderSystem**: æ¸²æŸ“å¡ç‰‡åŒ…å’Œç²’å­

### è‡ªåŠ¨åŒ–æµç¨‹

1. **ç¨‹åºå¯åŠ¨**: è‡ªåŠ¨è§¦å‘ `TriggerReward(plantID)`
2. **Phase 1-3**: `RewardAnimationSystem.Update()` è‡ªåŠ¨æ¨è¿›é˜¶æ®µ
3. **Phase 3â†’4 è½¬æ¢**: è‡ªåŠ¨è°ƒç”¨ `createRewardPanel()`
4. **é¢æ¿æ¸²æŸ“**: `RewardPanelRenderSystem` è‡ªåŠ¨åˆ›å»ºå¡ç‰‡å®ä½“
5. **å¡ç‰‡æ¸²æŸ“**: `PlantCardRenderSystem` ä½¿ç”¨å·¥å‚ç»Ÿä¸€æ¸²æŸ“

### Story 8.4 é›†æˆ

æœ¬éªŒè¯ç¨‹åºå®Œæ•´é›†æˆäº† Story 8.4 çš„æ”¹è¿›ï¼š

- âœ… ä½¿ç”¨ `PlantCardFactory.NewPlantCardEntity()` åˆ›å»ºå¡ç‰‡
- âœ… å¡ç‰‡ä½ç½®ç”±æ¸²æŸ“ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼ˆæ°´å¹³å±…ä¸­ï¼‰
- âœ… æ‰€æœ‰é…ç½®ä» `config.plant_card_config.go` è¯»å–
- âœ… æ¤ç‰©å›¾æ ‡ä½¿ç”¨ Reanim ç³»ç»Ÿç¦»å±æ¸²æŸ“

## ç›¸å…³æ–‡ä»¶

### æºä»£ç 
- `cmd/verify_reward_animation/main.go` - éªŒè¯ç¨‹åºä¸»æ–‡ä»¶
- `pkg/systems/reward_animation_system.go` - å¥–åŠ±åŠ¨ç”»ç³»ç»Ÿ
- `pkg/systems/reward_panel_render_system.go` - é¢æ¿æ¸²æŸ“ç³»ç»Ÿ
- `pkg/entities/plant_card_factory.go` - æ¤ç‰©å¡ç‰‡å·¥å‚

### é…ç½®
- `pkg/config/plant_card_config.go` - å¡ç‰‡é…ç½®å¸¸é‡
- `pkg/config/reward_config.go` - å¥–åŠ±åŠ¨ç”»é…ç½®å¸¸é‡
- `assets/config/resources.yaml` - èµ„æºé…ç½®

### Story æ–‡æ¡£
- `docs/stories/8.3.story.md` - å¥–åŠ±å¡ç‰‡åŒ…åŠ¨ç”»ï¼ˆPhase 1-3ï¼‰
- `docs/stories/8.4.story.md` - æ¤ç‰©å¡ç‰‡å¤ç”¨ä¸é¢æ¿æ˜¾ç¤ºï¼ˆPhase 4ï¼‰

## å¼€å‘è€…è¯´æ˜

### å¦‚ä½•æ·»åŠ æ–°æ¤ç‰©

1. åœ¨ `PlantUnlockManager` ä¸­æ³¨å†Œæ¤ç‰©ä¿¡æ¯
2. åœ¨ `data/strings/lawnstrings.txt` æ·»åŠ æ¤ç‰©åç§°å’Œæè¿°
3. å‡†å¤‡æ¤ç‰© Reanim èµ„æºï¼ˆ`.reanim.compiled.json`ï¼‰
4. è¿è¡ŒéªŒè¯ï¼š`./bin/verify_reward_animation --plant=new_plant_id`

### å¦‚ä½•è°ƒè¯•é¢æ¿æ¸²æŸ“

```bash
# ä½¿ç”¨è¯¦ç»†æ—¥å¿—æ¨¡å¼
./bin/verify_reward_animation --plant=sunflower --verbose 2>&1 | tee debug.log

# æŸ¥çœ‹å…³é”®æ—¥å¿—
grep "RewardPanelRenderSystem\|PlantCardFactory" debug.log
```

### å¦‚ä½•éªŒè¯æ€§èƒ½

```bash
# ä½¿ç”¨ Go æ€§èƒ½åˆ†æå·¥å…·
go build -o bin/verify_reward_animation ./cmd/verify_reward_animation
GODEBUG=gctrace=1 ./bin/verify_reward_animation --plant=sunflower
```

## ç‰ˆæœ¬å†å²

- **v1.0** (Story 8.3): åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒ Phase 1-3 å¡ç‰‡åŒ…åŠ¨ç”»
- **v2.0** (Story 8.4): å®Œæ•´æµç¨‹éªŒè¯ï¼Œé›†æˆé¢æ¿å’Œå¡ç‰‡æ¸²æŸ“

---

**æœ€åæ›´æ–°**: 2025-10-21
**Story**: 8.3 + 8.4
**è´Ÿè´£äºº**: James ğŸ’» (Dev Agent)
