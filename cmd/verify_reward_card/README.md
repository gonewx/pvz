# 奖励卡片包动画验证程序

## 概述

此验证程序用于快速测试关卡完成后的奖励卡片包动画效果，无需完成完整关卡即可验证动画流程。

## 动画阶段

该程序验证以下5个动画阶段：

1. **Phase 1 - Appearing (0.3秒)**
   - 卡片包从草坪右侧随机行弹出
   - 缩放动画：0.8 → 1.0
   - 微小上升：20px

2. **Phase 2 - Waiting**
   - 卡片包静止在草坪上
   - 橙色箭头指示器闪烁（sin曲线）
   - 等待玩家点击

3. **Phase 3 - Expanding (2秒)**
   - 卡片放大：1.0 → 2.0
   - 移动到屏幕中央上方 (screenHeight * 0.3)
   - 使用 easeOutQuad 缓动函数

4. **Phase 4 - Showing**
   - 显示新植物介绍面板
   - 植物名称和描述
   - 等待玩家点击关闭

5. **Phase 5 - Closing (0.5秒)**
   - 淡出动画
   - 清理实体

## 使用方法

### 基本用法

```bash
# 测试向日葵奖励动画（默认）
go run cmd/verify_reward_card/main.go

# 测试豌豆射手奖励动画
go run cmd/verify_reward_card/main.go --plant=peashooter

# 测试樱桃炸弹奖励动画
go run cmd/verify_reward_card/main.go --plant=cherrybomb

# 测试坚果墙奖励动画
go run cmd/verify_reward_card/main.go --plant=wallnut

# 启用详细日志
go run cmd/verify_reward_card/main.go --verbose
```

### 命令行参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `--plant` | string | "sunflower" | 植物ID (sunflower, peashooter, cherrybomb, wallnut) |
| `--verbose` | bool | false | 显示详细调试信息 |

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| **Space** / **鼠标点击** | 在 Phase 2 触发展开动画，在 Phase 4 关闭面板 |
| **R** | 重启验证程序（重新播放动画） |
| **Q** | 退出程序 |

## 调试功能

### 屏幕显示信息

程序会在屏幕上实时显示以下调试信息：

- 当前植物ID
- 当前动画阶段
- 阶段已用时间
- 卡片缩放比例
- 箭头显示状态和透明度
- 卡片位置坐标
- 当前阶段说明
- 快捷键提示

### 草坪参考网格

程序会绘制草坪网格参考线，帮助验证卡片包的位置：

- **绿色半透明矩形**: 草坪边界框
- **绿色水平线**: 5行草坪的中心线

### 箭头指示器

Phase 2 阶段会显示简化版的橙色箭头指示器：

- 位置：卡片包下方30px
- 颜色：橙色 (RGB: 255, 165, 0)
- 闪烁效果：透明度随 sin 曲线变化 (0.5 - 1.0)

## 验证要点

### Phase 1 验证

- ✅ 卡片包是否从草坪右侧边缘出现？
- ✅ 随机行位置是否正确？
- ✅ 缩放动画是否流畅？(0.8 → 1.0)
- ✅ 上升动画是否自然？(约20px)
- ✅ 持续时间是否为 0.3 秒？

### Phase 2 验证

- ✅ 卡片包是否静止在草坪上？
- ✅ 箭头指示器是否正确闪烁？
- ✅ 点击或按 Space 是否能触发下一阶段？

### Phase 3 验证

- ✅ 卡片是否放大到 2.0 倍？
- ✅ 卡片是否移动到屏幕中央上方？
- ✅ 移动轨迹是否平滑？(easeOutQuad)
- ✅ 持续时间是否为 2 秒？

### Phase 4 验证

- ✅ 奖励面板是否正确显示？
- ✅ 植物名称和描述是否正确？
- ✅ 点击是否能关闭面板？

### Phase 5 验证

- ✅ 淡出动画是否流畅？
- ✅ 实体是否正确清理？
- ✅ 持续时间是否为 0.5 秒？

## 已知限制

1. **粒子特效未实现**：Phase 2 的粒子背景框和 Phase 3 的 Award.xml 光芒特效尚未集成
2. **卡片包图片**：当前使用占位符渲染，待集成 SpriteComponent
3. **字体渲染**：奖励面板使用 DebugPrint，待优化为真实字体渲染

## 故障排查

### 问题：卡片包不显示

- 检查资源是否正确加载：`IMAGE_SEEDPACKET_LARGER`
- 检查 Reanim 系统是否正常初始化
- 查看日志输出是否有错误信息

### 问题：动画不流畅

- 检查帧率是否稳定在 60 FPS
- 尝试关闭详细日志 (去掉 --verbose)

### 问题：箭头不闪烁

- 检查 ArrowAlpha 值是否正确更新（应在 0.5-1.0 范围）
- 检查 sin 函数计算是否正确

## 开发效率对比

| 测试方法 | 启动时间 | 测试周期 | 效率 |
|----------|---------|---------|------|
| 完整游戏流程 | 5 分钟 | 10 分钟/次 | 基准 |
| 验证程序 | < 2 秒 | 5 秒/次 | **120x** |

## 下一步工作

- [ ] 集成粒子背景框效果 (Phase 2)
- [ ] 集成 Award.xml 粒子特效 (Phase 3)
- [ ] 优化卡片包图片渲染
- [ ] 添加真实字体渲染支持
- [ ] 创建 Phase 3 粒子特效专用验证程序 (`cmd/verify_reward_particle/`)

## 参考文档

- **Story 文档**: `docs/stories/8.3.story.md`
- **需求文档**: `.meta/levels/chapter1.md` (奖励动画流程)
- **参考截图**:
  - `.meta/screenshot/level1/截图 2025-10-16 17-34-00.png` (Phase 2)
  - `.meta/screenshot/level1/截图 2025-10-16 17-34-07.png` (Phase 3)
