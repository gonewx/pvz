# Story 7.2: ç²’å­å‘å°„å™¨æ ¸å¿ƒå¼•æ“

## Status
Done

## Story
**As a** å¼€å‘è€…,
**I want** to implement particle emitter logic and lifecycle management,
**so that** particles can be spawned, updated, and destroyed correctly.

## Acceptance Criteria
1. **åˆ›å»º**: `pkg/components/particle_component.go`(ç²’å­ç»„ä»¶)
   - å­˜å‚¨å•ä¸ªç²’å­çš„çŠ¶æ€(ä½ç½®ã€é€Ÿåº¦ã€æ—‹è½¬ã€ç¼©æ”¾ã€é€æ˜åº¦ã€é¢œè‰²ã€ç”Ÿå‘½å‘¨æœŸç­‰)
   - çº¯æ•°æ®ç»„ä»¶,æ— æ–¹æ³•
2. **åˆ›å»º**: `pkg/components/emitter_component.go`(å‘å°„å™¨ç»„ä»¶)
   - å­˜å‚¨å‘å°„å™¨é…ç½®å¼•ç”¨å’ŒçŠ¶æ€
   - ç®¡ç†å‘å°„æ—¶æœºã€æ´»è·ƒç²’å­æ•°ç­‰
3. **åˆ›å»º**: `pkg/systems/particle_system.go`(ç²’å­ç³»ç»Ÿ)
   - å®ç°`Update(dt float64)`æ–¹æ³•:æ›´æ–°æ‰€æœ‰ç²’å­å’Œå‘å°„å™¨
   - ç²’å­ç”Ÿå‘½å‘¨æœŸç®¡ç†:ç”Ÿæˆã€æ›´æ–°ã€é”€æ¯
   - åŠ¨ç”»æ’å€¼ç³»ç»Ÿ:æ”¯æŒçº¿æ€§æ’å€¼å’Œå…³é”®å¸§åŠ¨ç”»(Alpha, Scale, Spinç­‰)
   - åŠ›åœºç³»ç»Ÿ:æ”¯æŒé‡åŠ›ã€æ‘©æ“¦ã€åŠ é€Ÿåº¦ç­‰
4. å®ç°å‘å°„å™¨é€»è¾‘:
   - æŒ‰é…ç½®ç”Ÿæˆç²’å­(SpawnMinActive, SpawnRateç­‰)
   - å‘å°„é€Ÿåº¦å’Œè§’åº¦(LaunchSpeed, LaunchAngle)
   - å‘å°„åŒºåŸŸ(EmitterBox, EmitterRadius, EmitterType)
5. å•å…ƒæµ‹è¯•:éªŒè¯ç²’å­ç”Ÿå‘½å‘¨æœŸã€åŠ¨ç”»æ’å€¼ã€åŠ›åœºè®¡ç®—æ­£ç¡®æ€§
6. å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

## Tasks / Subtasks

### Task 1: å®ç°å€¼è§£æå™¨ (AC: 3, 4)
- [x] åˆ›å»º `internal/particle/value_parser.go`
  - [x] å®ç° `ParseValue(s string) (min, max float64, keyframes []Keyframe, interpolation string)`
    - [x] è§£æå›ºå®šå€¼: `"1500"` â†’ min=1500, max=1500, keyframes=nil
    - [x] è§£æèŒƒå›´: `"[0.7 0.9]"` â†’ min=0.7, max=0.9, keyframes=nil
    - [x] è§£æå…³é”®å¸§: `"0,2 1,2 4,21"` â†’ keyframes=[{time:0, value:2}, {time:1, value:2}, {time:4, value:21}]
    - [x] è§£ææ’å€¼å…³é”®å­—: `".4 Linear 10,9.999999"` â†’ keyframes with interpolation="Linear"
  - [x] å®šä¹‰ `Keyframe` ç»“æ„ä½“: `{Time float64, Value float64}`
  - [x] å®ç° `EvaluateKeyframes(keyframes []Keyframe, t float64, interpolation string) float64`
    - [x] æ”¯æŒçº¿æ€§æ’å€¼ ("Linear")
    - [x] æ”¯æŒå¸¸é‡(æ— æ’å€¼)
  - [x] å®ç° `RandomInRange(min, max float64) float64` (ä½¿ç”¨math/rand)
- [x] åˆ›å»º `internal/particle/value_parser_test.go`
  - [x] æµ‹è¯•å›ºå®šå€¼è§£æ
  - [x] æµ‹è¯•èŒƒå›´è§£æ
  - [x] æµ‹è¯•å…³é”®å¸§è§£æ
  - [x] æµ‹è¯•æ’å€¼è®¡ç®—
  - [x] æµ‹è¯•è¾¹ç•Œæƒ…å†µ(ç©ºå­—ç¬¦ä¸²ã€æ— æ•ˆæ ¼å¼)

### Task 2: åˆ›å»ºç²’å­ç»„ä»¶ (AC: 1)
- [x] åˆ›å»º `pkg/components/particle_component.go`
  - [x] å®šä¹‰ `ParticleComponent` ç»“æ„ä½“:
    - [x] ä½ç½®: `X, Y float64` (ä¸–ç•Œåæ ‡)
    - [x] é€Ÿåº¦: `VelocityX, VelocityY float64` (åƒç´ /ç§’)
    - [x] æ—‹è½¬: `Rotation float64` (è§’åº¦), `RotationSpeed float64` (åº¦/ç§’)
    - [x] ç¼©æ”¾: `Scale float64` (ç¼©æ”¾å€æ•°)
    - [x] é€æ˜åº¦: `Alpha float64` (0-1)
    - [x] é¢œè‰²: `Red, Green, Blue float64` (0-1)
    - [x] äº®åº¦: `Brightness float64` (äº®åº¦ä¹˜æ•°)
    - [x] ç”Ÿå‘½å‘¨æœŸ: `Age float64` (å·²å­˜æ´»æ—¶é—´,ç§’), `Lifetime float64` (æ€»ç”Ÿå‘½æ—¶é—´,ç§’)
    - [x] å…³é”®å¸§æ’å€¼æ•°æ®: `AlphaKeyframes, ScaleKeyframes, SpinKeyframes` (æ¥è‡ªé…ç½®)
    - [x] å›¾ç‰‡å¼•ç”¨: `Image *ebiten.Image`
    - [x] åŠ æ³•æ··åˆæ ‡å¿—: `Additive bool`
  - [x] æ·»åŠ  GoDoc æ³¨é‡Šè¯´æ˜ç»„ä»¶ç”¨é€”
  - [x] ç¡®ä¿ç»“æ„ä½“çº¯æ•°æ®,æ— æ–¹æ³•

### Task 3: åˆ›å»ºå‘å°„å™¨ç»„ä»¶ (AC: 2)
- [x] åˆ›å»º `pkg/components/emitter_component.go`
  - [x] å®šä¹‰ `EmitterComponent` ç»“æ„ä½“:
    - [x] é…ç½®å¼•ç”¨: `Config *particle.EmitterConfig` (æ¥è‡ªStory 7.1)
    - [x] å‘å°„å™¨çŠ¶æ€:
      - [x] `Active bool` (æ˜¯å¦æ´»è·ƒ)
      - [x] `Age float64` (å·²è¿è¡Œæ—¶é—´,ç§’)
      - [x] `SystemDuration float64` (ç³»ç»Ÿæ€»æŒç»­æ—¶é—´,ä»é…ç½®è§£æ)
      - [x] `NextSpawnTime float64` (ä¸‹æ¬¡å‘å°„æ—¶é—´)
      - [x] `ActiveParticles []ecs.EntityID` (å½“å‰æ´»è·ƒç²’å­åˆ—è¡¨)
      - [x] `TotalLaunched int` (å·²å‘å°„ç²’å­æ€»æ•°)
    - [x] è§£æåçš„å‘å°„å‚æ•°:
      - [x] `SpawnRate float64` (æ¯ç§’å‘å°„ç²’å­æ•°)
      - [x] `SpawnMinActive, SpawnMaxActive int` (æ´»è·ƒç²’å­æ•°èŒƒå›´)
      - [x] `SpawnMaxLaunched int` (æœ€å¤§å‘å°„æ€»æ•°)
      - [x] `EmitterBoxX, EmitterBoxY float64` (å‘å°„åŒºåŸŸå°ºå¯¸)
      - [x] `EmitterRadius float64` (åœ†å½¢å‘å°„å™¨åŠå¾„)
  - [x] æ·»åŠ  GoDoc æ³¨é‡Š
  - [x] çº¯æ•°æ®ç»„ä»¶

### Task 4: åˆ›å»ºç²’å­ç³»ç»Ÿ (AC: 3, 4)
- [x] åˆ›å»º `pkg/systems/particle_system.go`
  - [x] å®šä¹‰ `ParticleSystem` ç»“æ„ä½“:
    - [x] å­—æ®µ: `EntityManager *ecs.EntityManager`
  - [x] å®ç°æ„é€ å‡½æ•° `NewParticleSystem(em *ecs.EntityManager) *ParticleSystem`
  - [x] å®ç° `Update(dt float64)` æ–¹æ³•:
    - [x] **å­ä»»åŠ¡ 4.1**: æ›´æ–°æ‰€æœ‰å‘å°„å™¨
      - [x] æŸ¥è¯¢æ‰€æœ‰æ‹¥æœ‰ `EmitterComponent` å’Œ `PositionComponent` çš„å®ä½“
      - [x] éå†æ¯ä¸ªå‘å°„å™¨:
        - [x] å¢åŠ å‘å°„å™¨å¹´é¾„: `emitter.Age += dt`
        - [x] æ£€æŸ¥ç³»ç»ŸæŒç»­æ—¶é—´,è¶…æ—¶åˆ™åœç”¨å‘å°„å™¨
        - [x] å¦‚æœ `emitter.Age >= emitter.NextSpawnTime` ä¸”æœªè¾¾åˆ°æœ€å¤§æ•°é‡:
          - [x] è°ƒç”¨ `spawnParticle(entityID, emitter, position)` ç”Ÿæˆç²’å­
          - [x] æ›´æ–° `emitter.NextSpawnTime += 1.0 / emitter.SpawnRate`
          - [x] å¢åŠ  `emitter.TotalLaunched`
        - [x] æ¸…ç†å·²æ­»äº¡çš„ç²’å­ID (ä» `emitter.ActiveParticles` ä¸­ç§»é™¤)
    - [x] **å­ä»»åŠ¡ 4.2**: æ›´æ–°æ‰€æœ‰ç²’å­
      - [x] æŸ¥è¯¢æ‰€æœ‰æ‹¥æœ‰ `ParticleComponent` å’Œ `PositionComponent` çš„å®ä½“
      - [x] éå†æ¯ä¸ªç²’å­:
        - [x] å¢åŠ ç²’å­å¹´é¾„: `particle.Age += dt`
        - [x] å¦‚æœ `particle.Age >= particle.Lifetime`:
          - [x] æ ‡è®°ç²’å­å®ä½“å¾…åˆ é™¤ (`em.DestroyEntity(entityID)`)
          - [x] ç»§ç»­ä¸‹ä¸€ä¸ªç²’å­
        - [x] **åº”ç”¨é€Ÿåº¦**: `pos.X += particle.VelocityX * dt`, `pos.Y += particle.VelocityY * dt`
        - [x] **åº”ç”¨æ—‹è½¬**: `particle.Rotation += particle.RotationSpeed * dt`
        - [x] **åº”ç”¨åŠ›åœºæ•ˆæœ**: è°ƒç”¨ `applyFields(particle, emitterConfig, dt)`
        - [x] **åº”ç”¨åŠ¨ç”»æ’å€¼**: è°ƒç”¨ `applyInterpolation(particle)`
  - [x] å®ç°ç§æœ‰æ–¹æ³• `spawnParticle(emitterEntityID ecs.EntityID, emitter *EmitterComponent, emitterPos *PositionComponent)`:
    - [x] åˆ›å»ºæ–°ç²’å­å®ä½“: `particleID := em.NewEntity()`
    - [x] æ·»åŠ  `ParticleComponent`:
      - [x] ä» `emitter.Config` è§£æåˆå§‹å±æ€§(ä½¿ç”¨ `value_parser`)
      - [x] åˆå§‹ä½ç½®: `emitterPos.X + randomOffset(EmitterBoxX)`
      - [x] åˆå§‹é€Ÿåº¦: ä» `LaunchSpeed` å’Œ `LaunchAngle` è®¡ç®—
      - [x] ç”Ÿå‘½å‘¨æœŸ: ä» `ParticleDuration` è§£æ
      - [x] é€æ˜åº¦ã€ç¼©æ”¾ç­‰: ä»é…ç½®åˆå§‹åŒ–
      - [x] åŠ è½½å›¾ç‰‡: ä» `ResourceManager` åŠ è½½ `emitter.Config.Image`
    - [x] æ·»åŠ  `PositionComponent`
    - [x] å°†ç²’å­IDæ·»åŠ åˆ° `emitter.ActiveParticles`
  - [x] å®ç°ç§æœ‰æ–¹æ³• `applyFields(particle *ParticleComponent, config *particle.EmitterConfig, dt float64)`:
    - [x] éå† `config.Fields`:
      - [x] æ ¹æ® `Field.FieldType` åº”ç”¨åŠ›åœºæ•ˆæœ:
        - [x] `"Acceleration"`: å¢åŠ é€Ÿåº¦ `particle.VelocityY += parseValue(field.Y) * dt`
        - [x] `"Friction"`: å‡å°‘é€Ÿåº¦ `particle.VelocityX *= (1 - friction * dt)`
        - [x] å…¶ä»–åŠ›åœºç±»å‹(æ ¹æ®XMLé…ç½®éœ€è¦)
  - [x] å®ç°ç§æœ‰æ–¹æ³• `applyInterpolation(particle *ParticleComponent)`:
    - [x] è®¡ç®—æ’å€¼æ—¶é—´ `t = particle.Age / particle.Lifetime`
    - [x] å¦‚æœæœ‰ `AlphaKeyframes`: `particle.Alpha = EvaluateKeyframes(particle.AlphaKeyframes, t, interpolation)`
    - [x] å¦‚æœæœ‰ `ScaleKeyframes`: `particle.Scale = EvaluateKeyframes(...)`
    - [x] å¦‚æœæœ‰ `SpinKeyframes`: æ›´æ–°æ—‹è½¬é€Ÿåº¦
  - [x] æ·»åŠ  GoDoc æ³¨é‡Šè¯´æ˜ç³»ç»Ÿç”¨é€”å’Œå·¥ä½œæµç¨‹

### Task 5: é›†æˆç²’å­ç³»ç»Ÿåˆ°æ¸¸æˆå¾ªç¯ (AC: 3)
- [x] ä¿®æ”¹ `pkg/scenes/game_scene.go`:
  - [x] åœ¨ `GameScene` ç»“æ„ä½“ä¸­æ·»åŠ  `ParticleSystem *systems.ParticleSystem`
  - [x] åœ¨åœºæ™¯åˆå§‹åŒ–æ—¶åˆ›å»ºç²’å­ç³»ç»Ÿ: `scene.ParticleSystem = systems.NewParticleSystem(scene.EntityManager)`
  - [x] åœ¨ `Update()` æ–¹æ³•ä¸­è°ƒç”¨ç²’å­ç³»ç»Ÿæ›´æ–°: `scene.ParticleSystem.Update(dt)`
  - [x] ç¡®ä¿ç²’å­ç³»ç»Ÿåœ¨å…¶ä»–ç³»ç»Ÿ(å¦‚BehaviorSystem)ä¹‹åæ›´æ–°

### Task 6: åˆ›å»ºç²’å­æ•ˆæœå·¥å‚å‡½æ•° (AC: 4)
- [x] åˆ›å»º `pkg/entities/particle_factory.go`
  - [x] å®ç° `CreateParticleEffect(em *ecs.EntityManager, rm *game.ResourceManager, effectName string, worldX, worldY float64) (ecs.EntityID, error)`:
    - [x] ä» ResourceManager åŠ è½½ç²’å­é…ç½®: `config := rm.LoadParticleConfig(effectName)`
    - [x] åˆ›å»ºå‘å°„å™¨å®ä½“: `emitterID := em.NewEntity()`
    - [x] æ·»åŠ  `PositionComponent`: `{X: worldX, Y: worldY}`
    - [x] è§£æç¬¬ä¸€ä¸ªå‘å°„å™¨é…ç½®(ç®€åŒ–ç‰ˆ,æš‚æ—¶åªæ”¯æŒå•å‘å°„å™¨æ•ˆæœ)
    - [x] æ·»åŠ  `EmitterComponent`: å¡«å……è§£æåçš„é…ç½®å‚æ•°
    - [x] è¿”å›å‘å°„å™¨å®ä½“ID
  - [x] æ·»åŠ  GoDoc æ³¨é‡Šå’Œä½¿ç”¨ç¤ºä¾‹

### Task 7: å•å…ƒæµ‹è¯• (AC: 5, 6)
- [x] åˆ›å»º `internal/particle/value_parser_test.go`(Task 1å·²åŒ…å«)
- [x] åˆ›å»º `pkg/systems/particle_system_test.go`:
  - [x] æµ‹è¯•ç²’å­ç”Ÿå‘½å‘¨æœŸ:
    - [x] åˆ›å»ºæµ‹è¯•ç”¨ç²’å­,éªŒè¯å¹´é¾„å¢é•¿
    - [x] éªŒè¯ç²’å­è¶…æ—¶è‡ªåŠ¨é”€æ¯
  - [x] æµ‹è¯•å‘å°„å™¨é€»è¾‘:
    - [x] åˆ›å»ºæµ‹è¯•ç”¨å‘å°„å™¨,éªŒè¯ç²’å­æŒ‰é€Ÿç‡ç”Ÿæˆ
    - [x] éªŒè¯æœ€å¤§æ´»è·ƒç²’å­æ•°é™åˆ¶
    - [x] éªŒè¯æœ€å¤§å‘å°„æ€»æ•°é™åˆ¶
  - [x] æµ‹è¯•åŠ¨ç”»æ’å€¼:
    - [x] åˆ›å»ºå¸¦å…³é”®å¸§çš„ç²’å­,éªŒè¯æ’å€¼è®¡ç®—
    - [x] æµ‹è¯•çº¿æ€§æ’å€¼æ­£ç¡®æ€§
  - [x] æµ‹è¯•åŠ›åœºç³»ç»Ÿ:
    - [x] åˆ›å»ºå¸¦é‡åŠ›åœºçš„ç²’å­,éªŒè¯é€Ÿåº¦å˜åŒ–
    - [x] æµ‹è¯•æ‘©æ“¦åŠ›æ•ˆæœ
  - [x] æµ‹è¯•è¾¹ç•Œæƒ…å†µ:
    - [x] ç©ºå‘å°„å™¨é…ç½®
    - [x] ç²’å­åˆå§‹ç”Ÿå‘½å‘¨æœŸä¸º0
    - [x] æ— æ•ˆçš„å…³é”®å¸§æ•°æ®
- [x] è¿è¡Œæµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥:
  - [x] `go test -cover ./internal/particle`
  - [x] `go test -cover ./pkg/systems` (ç²’å­ç³»ç»Ÿéƒ¨åˆ†)
  - [x] ç¡®ä¿è¦†ç›–ç‡ â‰¥ 80%

### Task 8: æ–‡æ¡£å’Œå˜æ›´æ—¥å¿—
- [x] æ›´æ–° `docs/stories/7.2.story.md`:
  - [x] å¡«å†™ Dev Agent Record éƒ¨åˆ†
  - [x] è®°å½•æ‰€æœ‰åˆ›å»ºå’Œä¿®æ”¹çš„æ–‡ä»¶
  - [x] å°† Status æ›´æ–°ä¸º "Ready for Review"
- [x] æ›´æ–° `CLAUDE.md`:
  - [x] åœ¨"ç»„ä»¶è¯´æ˜"éƒ¨åˆ†æ·»åŠ  `ParticleComponent` å’Œ `EmitterComponent`
  - [x] åœ¨"æ ¸å¿ƒç³»ç»Ÿ"éƒ¨åˆ†æ·»åŠ  `ParticleSystem`

## Dev Notes

### Previous Story Insights
[Source: docs/stories/7.1.story.md#Dev Agent Record]

**Story 7.1 æˆåŠŸæ¨¡å¼(å¤ç”¨åˆ° 7.2):**
1. âœ… **åˆ†é˜¶æ®µå®ç°**: å…ˆå»ºæ•°æ®ç»“æ„ â†’ è§£æå™¨ â†’ èµ„æºé›†æˆ â†’ ç³»ç»Ÿä½¿ç”¨
2. âœ… **internalåŒ…ç»„ç»‡**: å€¼è§£æå™¨æ”¾åœ¨ `internal/particle/value_parser.go`ï¼Œä¸æ¸¸æˆé€»è¾‘åˆ†ç¦»
3. âœ… **å•å…ƒæµ‹è¯•å…ˆè¡Œ**: æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ â‰¥ 80%
4. âœ… **Stringå»¶è¿Ÿè§£æç­–ç•¥**: Story 7.1ä½¿ç”¨stringå­˜å‚¨å¤æ‚å€¼ï¼ŒStory 7.2è´Ÿè´£è¿è¡Œæ—¶è§£æ

**Story 7.1 å…³é”®å†³ç­–:**
- EmitterConfig ä½¿ç”¨ `string` ç±»å‹å­˜å‚¨æ‰€æœ‰å±æ€§å€¼(SpawnRate, ParticleDurationç­‰)
- **Story 7.2 èŒè´£**: å®ç°å€¼è§£æå™¨ï¼Œå°†stringè½¬æ¢ä¸ºè¿è¡Œæ—¶å¯ç”¨çš„float64/keyframes
- æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 90%ï¼Œä¸ºæœ¬Storyæ ‘ç«‹äº†é«˜æ ‡å‡†

**åº”ç”¨åˆ° Story 7.2:**
- åˆ›å»º `internal/particle/value_parser.go` è§£æå¤æ‚å€¼æ ¼å¼
- ParticleComponent å’Œ EmitterComponent ä¸ºçº¯æ•°æ®ç»„ä»¶(ç¬¦åˆECSåŸåˆ™)
- ParticleSystem å®ç°æ‰€æœ‰ç²’å­å¼•æ“é€»è¾‘
- å•å…ƒæµ‹è¯•è¦†ç›–å€¼è§£æã€ç²’å­ç”Ÿå‘½å‘¨æœŸã€åŠ¨ç”»æ’å€¼ã€åŠ›åœºè®¡ç®—

### Project Structure Alignment
[Source: docs/architecture/unified-project-structure.md]

**æ–°æ–‡ä»¶ä½ç½®è§„åˆ’:**

```
pvz/
â”œâ”€â”€ internal/
â”‚   â””â”€â”€ particle/
â”‚       â”œâ”€â”€ types.go              # â† å·²å­˜åœ¨(Story 7.1)
â”‚       â”œâ”€â”€ parser.go             # â† å·²å­˜åœ¨(Story 7.1)
â”‚       â”œâ”€â”€ parser_test.go        # â† å·²å­˜åœ¨(Story 7.1)
â”‚       â”œâ”€â”€ value_parser.go       # â† æ–°å»º: å€¼è§£æå™¨
â”‚       â””â”€â”€ value_parser_test.go  # â† æ–°å»º: å€¼è§£æå™¨æµ‹è¯•
â”‚
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ particle_component.go    # â† æ–°å»º: ç²’å­ç»„ä»¶
â”‚   â”‚   â””â”€â”€ emitter_component.go     # â† æ–°å»º: å‘å°„å™¨ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ systems/
â”‚   â”‚   â””â”€â”€ particle_system.go       # â† æ–°å»º: ç²’å­ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ particle_system_test.go  # â† æ–°å»º: ç²’å­ç³»ç»Ÿæµ‹è¯•
â”‚   â”‚
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ particle_factory.go      # â† æ–°å»º: ç²’å­å®ä½“å·¥å‚
â”‚   â”‚
â”‚   â””â”€â”€ scenes/
â”‚       â””â”€â”€ game_scene.go            # â† ä¿®æ”¹: é›†æˆç²’å­ç³»ç»Ÿ
```

**å‘½åçº¦å®šéµå¾ª:**
[Source: docs/architecture/coding-standards.md#Naming Conventions]

- **åŒ…å**: `particle`, `components`, `systems`(snake_case)
- **ç»„ä»¶ç»“æ„ä½“**: `ParticleComponent`, `EmitterComponent`(PascalCase)
- **ç³»ç»Ÿç»“æ„ä½“**: `ParticleSystem`(PascalCase)
- **å…¬å¼€æ–¹æ³•**: `Update`, `CreateParticleEffect`(PascalCase)
- **ç§æœ‰æ–¹æ³•**: `spawnParticle`, `applyFields`, `applyInterpolation`(camelCase)

### ECS Architecture Integration
[Source: docs/architecture/high-level-architecture.md, docs/architecture/core-systems.md]

**ECSæ ¸å¿ƒåŸåˆ™:**
- **ç»„ä»¶(Component)**: çº¯æ•°æ®ç»“æ„ï¼Œæ— æ–¹æ³•
- **ç³»ç»Ÿ(System)**: å¤„ç†é€»è¾‘ï¼Œé€šè¿‡ EntityManager æŸ¥è¯¢å’Œæ“ä½œç»„ä»¶
- **å®ä½“(Entity)**: ç»„ä»¶çš„å®¹å™¨ï¼Œç”±å”¯ä¸€IDæ ‡è¯†

**ç²’å­ç³»ç»Ÿåœ¨ECSä¸­çš„ä½ç½®:**

```
GameScene
    â†“
EntityManager
    â†“ (manages)
Entities: [Emitter Entity, Particle Entity 1, Particle Entity 2, ...]
    â†“ (composed of)
Components: [PositionComponent, EmitterComponent, ParticleComponent]
    â†“ (processed by)
ParticleSystem.Update(dt)
    â†“ (updates)
Components (modifies Age, Position, Velocity, Alpha, Scale, etc.)
```

**ç³»ç»Ÿæ›´æ–°é¡ºåº:**
[Source: docs/architecture/core-systems.md]

```
GameScene.Update(dt):
  1. InputSystem.Update(dt)         # å¤„ç†ç”¨æˆ·è¾“å…¥
  2. BehaviorSystem.Update(dt)      # æ¸¸æˆé€»è¾‘(æ¤ç‰©ã€åƒµå°¸è¡Œä¸º)
  3. ParticleSystem.Update(dt)      # â† æ–°å¢: ç²’å­æ›´æ–°
  4. PhysicsSystem.Update(dt)       # ç§»åŠ¨å’Œç¢°æ’
  5. AnimationSystem.Update(dt)     # åŠ¨ç”»å¸§æ›´æ–°
  6. UISystem.Update(dt)            # UIé€»è¾‘
```

**ç»„ä»¶æŸ¥è¯¢æ¨¡å¼:**
```go
// æŸ¥è¯¢æ‰€æœ‰å‘å°„å™¨
emitters := em.QueryByComponents(&components.EmitterComponent{}, &components.PositionComponent{})

// æŸ¥è¯¢æ‰€æœ‰ç²’å­
particles := em.QueryByComponents(&components.ParticleComponent{}, &components.PositionComponent{})
```

### Value Format Parsing Strategy
[Source: Story 7.1 Dev Notes, data/particles/*.xml]

**XMLå€¼æ ¼å¼ç¤ºä¾‹(æ¥è‡ªStory 7.1åˆ†æ):**

1. **å›ºå®šå€¼**: `"1500"` â†’ `min=1500, max=1500`
2. **èŒƒå›´**: `"[0.7 0.9]"` â†’ `min=0.7, max=0.9` (åœ¨èŒƒå›´å†…éšæœº)
3. **å…³é”®å¸§**: `"0,2 1,2 4,21"` â†’ `keyframes=[{time:0, value:2}, {time:1, value:2}, {time:4, value:21}]`
4. **æ’å€¼å…³é”®å­—**: `".4 Linear 10,9.999999"` â†’ `keyframes=[{0, 0.4}, {10, 9.999999}]`, interpolation="Linear"

**è§£æå™¨å®ç°ç­–ç•¥:**

```go
// value_parser.go æ ¸å¿ƒå‡½æ•°ç­¾å
type Keyframe struct {
    Time  float64
    Value float64
}

// ParseValue è§£æä»»æ„æ ¼å¼çš„å€¼å­—ç¬¦ä¸²
func ParseValue(s string) (min, max float64, keyframes []Keyframe, interpolation string) {
    // 1. æ£€æµ‹æ˜¯å¦ä¸ºèŒƒå›´: "[" å¼€å¤´
    // 2. æ£€æµ‹æ˜¯å¦ä¸ºå…³é”®å¸§: åŒ…å« ","
    // 3. æ£€æµ‹æ’å€¼å…³é”®å­—: "Linear", "EaseIn"ç­‰
    // 4. å¦åˆ™ä¸ºå›ºå®šå€¼
}

// EvaluateKeyframes æ ¹æ®æ—¶é—´ t (0-1) è®¡ç®—æ’å€¼å€¼
func EvaluateKeyframes(keyframes []Keyframe, t float64, interpolation string) float64 {
    // çº¿æ€§æ’å€¼å®ç°
}

// RandomInRange åœ¨èŒƒå›´å†…ç”Ÿæˆéšæœºå€¼
func RandomInRange(min, max float64) float64 {
    return min + rand.Float64()*(max-min)
}
```

**ä½¿ç”¨åœºæ™¯:**
```go
// è§£æå‘å°„é€Ÿç‡
rateStr := emitterConfig.SpawnRate  // "10" æˆ– "[5 15]"
min, max, _, _ := value_parser.ParseValue(rateStr)
actualRate := value_parser.RandomInRange(min, max)

// è§£æç²’å­é€æ˜åº¦åŠ¨ç”»
alphaStr := emitterConfig.ParticleAlpha  // "0,1 1,0" (æ·¡å…¥æ·¡å‡º)
_, _, keyframes, interp := value_parser.ParseValue(alphaStr)
particle.AlphaKeyframes = keyframes
particle.AlphaInterpolation = interp
```

### Particle Lifecycle Management
[Source: docs/architecture/high-level-architecture.md#Architectural Patterns]

**ç²’å­ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœº:**

```
[å‘å°„å™¨åˆ›å»º] â†’ [å‘å°„å™¨æ´»è·ƒ] â†’ [å‘å°„å™¨åœç”¨]
       â†“             â†“
   [ç”Ÿæˆç²’å­]    [ç»§ç»­ç”Ÿæˆ]
       â†“             â†“
   [ç²’å­å­˜æ´»] â†’ [ç²’å­æ›´æ–°] â†’ [ç²’å­æ­»äº¡]
       â†‘             â†“
       â””â”€â”€â”€â”€â”€â”€â”€ (Age < Lifetime)
```

**å…³é”®æ—¶é—´å‚æ•°:**
- `ParticleComponent.Age`: ç²’å­å·²å­˜æ´»æ—¶é—´(ç§’)
- `ParticleComponent.Lifetime`: ç²’å­æ€»ç”Ÿå‘½æ—¶é—´(ç§’ï¼Œä» ParticleDuration è§£æ)
- `EmitterComponent.Age`: å‘å°„å™¨å·²è¿è¡Œæ—¶é—´(ç§’)
- `EmitterComponent.SystemDuration`: å‘å°„å™¨æ€»æŒç»­æ—¶é—´(ç§’ï¼Œä» SystemDuration è§£æ)
- `EmitterComponent.NextSpawnTime`: ä¸‹æ¬¡å‘å°„ç²’å­çš„æ—¶é—´ç‚¹(ç§’)

**å¯¹è±¡æ± æ¨¡å¼(å¯é€‰ä¼˜åŒ–):**
[Source: docs/architecture/high-level-architecture.md#Object Pooling]
- æœ¬Storyæš‚ä¸å®ç°å¯¹è±¡æ± (ç®€åŒ–å®ç°)
- ç²’å­æ­»äº¡æ—¶ç›´æ¥è°ƒç”¨ `em.DestroyEntity(entityID)`
- æœªæ¥ä¼˜åŒ–æ—¶å¯æ·»åŠ ç²’å­å¯¹è±¡æ± (Story 7.3æˆ–7.4)

### Animation Interpolation System
[Source: Epic 7 æŠ€æœ¯åˆ†æ, data/particles/Award.xml]

**æ”¯æŒçš„åŠ¨ç”»å±æ€§:**
- `ParticleAlpha`: é€æ˜åº¦åŠ¨ç”»(æ·¡å…¥æ·¡å‡º)
- `ParticleScale`: ç¼©æ”¾åŠ¨ç”»(æ”¾å¤§/ç¼©å°)
- `ParticleSpinSpeed`: æ—‹è½¬é€Ÿåº¦åŠ¨ç”»

**æ’å€¼ç±»å‹:**
- `"Linear"`: çº¿æ€§æ’å€¼(æœ¬Storyä¼˜å…ˆæ”¯æŒ)
- å…¶ä»–æ’å€¼ç±»å‹(å¦‚ "EaseIn", "FastInOutWeak")åœ¨æœªæ¥Storyæ·»åŠ 

**æ’å€¼è®¡ç®—ç¤ºä¾‹:**
```go
// å‡è®¾ç²’å­ç”Ÿå‘½å‘¨æœŸä¸º 2 ç§’ï¼Œå½“å‰ Age = 0.5 ç§’
t := particle.Age / particle.Lifetime  // t = 0.25 (å½’ä¸€åŒ–æ—¶é—´ 0-1)

// å¦‚æœ AlphaKeyframes = [{time:0, value:0}, {time:1, value:1}] (æ·¡å…¥)
alpha := EvaluateKeyframes(particle.AlphaKeyframes, t, "Linear")  // alpha = 0.25

// åº”ç”¨åˆ°ç²’å­
particle.Alpha = alpha
```

**å…³é”®å¸§æ’å€¼é€»è¾‘:**
```go
func EvaluateKeyframes(keyframes []Keyframe, t float64, interpolation string) float64 {
    if len(keyframes) == 0 {
        return 0
    }
    if len(keyframes) == 1 {
        return keyframes[0].Value
    }

    // æ‰¾åˆ° t æ‰€åœ¨çš„å…³é”®å¸§åŒºé—´ [keyframes[i], keyframes[i+1]]
    for i := 0; i < len(keyframes)-1; i++ {
        if t >= keyframes[i].Time && t <= keyframes[i+1].Time {
            // çº¿æ€§æ’å€¼
            t0, v0 := keyframes[i].Time, keyframes[i].Value
            t1, v1 := keyframes[i+1].Time, keyframes[i+1].Value
            ratio := (t - t0) / (t1 - t0)
            return v0 + ratio*(v1-v0)
        }
    }

    // è¶…å‡ºèŒƒå›´ï¼Œè¿”å›æœ€åä¸€ä¸ªå€¼
    return keyframes[len(keyframes)-1].Value
}
```

### Field System (åŠ›åœºç³»ç»Ÿ)
[Source: Epic 7 æŠ€æœ¯åˆ†æ, internal/particle/types.go#Field]

**æ”¯æŒçš„åŠ›åœºç±»å‹:**
- `"Acceleration"`: åŠ é€Ÿåº¦åœº(å¦‚é‡åŠ›)
- `"Friction"`: æ‘©æ“¦åŠ›åœº(å‡é€Ÿ)
- `"Attractor"`: å¸å¼•åŠ›åœº(æœæŸç‚¹ç§»åŠ¨ï¼Œæœªæ¥Storyæ·»åŠ )

**åŠ›åœºåº”ç”¨é€»è¾‘:**
```go
func applyFields(particle *ParticleComponent, config *particle.EmitterConfig, dt float64) {
    for _, field := range config.Fields {
        switch field.FieldType {
        case "Acceleration":
            // è§£æåŠ›åœºå‚æ•°
            _, _, xKeyframes, _ := value_parser.ParseValue(field.X)
            _, _, yKeyframes, _ := value_parser.ParseValue(field.Y)

            // è®¡ç®—åŠ é€Ÿåº¦ (å¦‚æœæœ‰å…³é”®å¸§ï¼Œä½¿ç”¨æ’å€¼)
            ax := 0.0
            ay := 0.0
            if len(yKeyframes) > 0 {
                ay = value_parser.EvaluateKeyframes(yKeyframes, particle.Age/particle.Lifetime, "Linear")
            } else if field.Y != "" {
                ay, _, _, _ = value_parser.ParseValue(field.Y)
            }

            // åº”ç”¨åŠ é€Ÿåº¦åˆ°é€Ÿåº¦
            particle.VelocityY += ay * dt

        case "Friction":
            // æ‘©æ“¦åŠ› = é€Ÿåº¦è¡°å‡
            frictionX, _, _, _ := value_parser.ParseValue(field.X)
            frictionY, _, _, _ := value_parser.ParseValue(field.Y)

            particle.VelocityX *= (1 - frictionX*dt)
            particle.VelocityY *= (1 - frictionY*dt)
        }
    }
}
```

**ç¤ºä¾‹XMLé…ç½®:**
```xml
<Field>
  <FieldType>Acceleration</FieldType>
  <Y>13</Y>  <!-- å‘ä¸‹åŠ é€Ÿåº¦ 13 åƒç´ /ç§’Â² -->
</Field>
```

### Emitter Spawn Logic
[Source: Epic 7 AC, internal/particle/types.go#EmitterConfig]

**å‘å°„å™¨å‚æ•°è¯´æ˜:**
- `SpawnRate`: æ¯ç§’å‘å°„ç²’å­æ•°(ä¾‹å¦‚ "10" = æ¯ç§’10ä¸ªç²’å­)
- `SpawnMinActive`: æœ€å°æ´»è·ƒç²’å­æ•°(ä¾‹å¦‚ "2")
- `SpawnMaxActive`: æœ€å¤§æ´»è·ƒç²’å­æ•°(ä¾‹å¦‚ "50")
- `SpawnMaxLaunched`: æœ€å¤§å‘å°„æ€»æ•°(ä¾‹å¦‚ "100"ï¼Œå‘å°„100ä¸ªååœæ­¢)

**å‘å°„é€»è¾‘ä¼ªä»£ç :**
```go
// åœ¨ ParticleSystem.Update(dt) ä¸­
emitter.Age += dt

// æ£€æŸ¥æ˜¯å¦åˆ°è¾¾å‘å°„æ—¶é—´
if emitter.Age >= emitter.NextSpawnTime {
    activeCount := len(emitter.ActiveParticles)

    // æ£€æŸ¥çº¦æŸ
    if activeCount < emitter.SpawnMaxActive && emitter.TotalLaunched < emitter.SpawnMaxLaunched {
        spawnParticle(emitterEntityID, emitter, position)
        emitter.TotalLaunched++
    }

    // æ›´æ–°ä¸‹æ¬¡å‘å°„æ—¶é—´
    emitter.NextSpawnTime += 1.0 / emitter.SpawnRate
}

// æ£€æŸ¥ç³»ç»ŸæŒç»­æ—¶é—´
if emitter.SystemDuration > 0 && emitter.Age >= emitter.SystemDuration {
    emitter.Active = false  // åœç”¨å‘å°„å™¨
}
```

**å‘å°„ä½ç½®è®¡ç®—:**
```go
// æ ¹æ® EmitterBox æˆ– EmitterRadius è®¡ç®—ç²’å­ç”Ÿæˆä½ç½®
func calculateSpawnPosition(emitterPos *PositionComponent, config *EmitterConfig) (x, y float64) {
    x = emitterPos.X
    y = emitterPos.Y

    // EmitterBox: åœ¨çŸ©å½¢åŒºåŸŸå†…éšæœº
    if config.EmitterBoxX > 0 {
        x += rand.Float64()*config.EmitterBoxX - config.EmitterBoxX/2
    }
    if config.EmitterBoxY > 0 {
        y += rand.Float64()*config.EmitterBoxY - config.EmitterBoxY/2
    }

    // EmitterRadius: åœ¨åœ†å½¢åŒºåŸŸå†…éšæœº (æœªæ¥æ·»åŠ )

    return x, y
}
```

### Launch Velocity Calculation
[Source: Epic 7 æŠ€æœ¯åˆ†æ]

**ä»é…ç½®è®¡ç®—åˆå§‹é€Ÿåº¦:**
```go
// LaunchSpeed: "100" æˆ– "[50 150]" (åƒç´ /ç§’)
// LaunchAngle: "45" æˆ– "[-30 30]" (åº¦)

speedMin, speedMax, _, _ := value_parser.ParseValue(config.LaunchSpeed)
angleMin, angleMax, _, _ := value_parser.ParseValue(config.LaunchAngle)

speed := value_parser.RandomInRange(speedMin, speedMax)
angle := value_parser.RandomInRange(angleMin, angleMax)

// è½¬æ¢ä¸ºé€Ÿåº¦åˆ†é‡ (è§’åº¦è½¬å¼§åº¦)
angleRad := angle * math.Pi / 180.0
particle.VelocityX = speed * math.Cos(angleRad)
particle.VelocityY = speed * math.Sin(angleRad)
```

### Resource Loading Integration
[Source: pkg/game/resource_manager.go, Story 7.1]

**ä»ResourceManageråŠ è½½èµ„æº:**
```go
// åœ¨ spawnParticle æˆ– CreateParticleEffect ä¸­
config, err := rm.LoadParticleConfig("Award")  // åŠ è½½XMLé…ç½®
if err != nil {
    return err
}

// åŠ è½½ç²’å­è´´å›¾
imageID := config.Emitters[0].Image  // "IMAGE_AWARDRAYS2"
image, err := rm.LoadImageByID(imageID)
if err != nil {
    // å°è¯•ç›´æ¥è·¯å¾„åŠ è½½ (å‘åå…¼å®¹)
    image, err = rm.LoadImage("assets/particles/AwardRays2.png")
}

particle.Image = image
```

### Technical Constraints
[Source: docs/architecture/coding-standards.md#Critical Rules]

**å¿…é¡»éµå¾ªçš„ç¼–ç è§„åˆ™:**
1. âœ… **é›¶è€¦åˆåŸåˆ™**: ParticleSystem ä¸ç›´æ¥è°ƒç”¨å…¶ä»–Systemï¼Œåªé€šè¿‡ EntityManager æŸ¥è¯¢å’Œæ“ä½œç»„ä»¶
2. âœ… **æ•°æ®-è¡Œä¸ºåˆ†ç¦»**: ParticleComponent å’Œ EmitterComponent ä¸¥ç¦åŒ…å«æ–¹æ³•
3. âœ… **é”™è¯¯å¤„ç†**: æ‰€æœ‰å¯èƒ½è¿”å›errorçš„å‡½æ•°å¿…é¡»æ£€æŸ¥å¹¶åŒ…è£…é”™è¯¯
4. âœ… **GoDocæ³¨é‡Š**: æ‰€æœ‰å…¬å¼€çš„ç±»å‹ã€å‡½æ•°ã€æ–¹æ³•å¿…é¡»æœ‰æ–‡æ¡£æ³¨é‡Š
5. âœ… **ç¦æ­¢å…¨å±€å˜é‡**: ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œé€šè¿‡æ„é€ å‡½æ•°ä¼ é€’ EntityManager, ResourceManager

**æ€§èƒ½çº¦æŸ:**
[Source: Epic 7 æŠ€æœ¯çº¦æŸ]
- ç²’å­æ›´æ–°æ—¶é—´ç›®æ ‡: < 1ms/frame (å¯¹äº100ä¸ªç²’å­)
- é¿å…åœ¨Updateå¾ªç¯ä¸­é¢‘ç¹åˆ†é…å†…å­˜
- å¤ç”¨åˆ‡ç‰‡(å¦‚ emitter.ActiveParticles)

### File Path Reference

**æœ¬Storyå°†åˆ›å»ºçš„æ–‡ä»¶:**
- `internal/particle/value_parser.go` - å€¼è§£æå™¨
- `internal/particle/value_parser_test.go` - å€¼è§£æå™¨æµ‹è¯•
- `pkg/components/particle_component.go` - ç²’å­ç»„ä»¶
- `pkg/components/emitter_component.go` - å‘å°„å™¨ç»„ä»¶
- `pkg/systems/particle_system.go` - ç²’å­ç³»ç»Ÿ
- `pkg/systems/particle_system_test.go` - ç²’å­ç³»ç»Ÿæµ‹è¯•
- `pkg/entities/particle_factory.go` - ç²’å­å®ä½“å·¥å‚

**æœ¬Storyå°†ä¿®æ”¹çš„æ–‡ä»¶:**
- `pkg/scenes/game_scene.go` - é›†æˆç²’å­ç³»ç»Ÿåˆ°æ¸¸æˆå¾ªç¯

**ä¾èµ–çš„ç°æœ‰æ–‡ä»¶:**
- `internal/particle/types.go` - ç²’å­é…ç½®æ•°æ®ç»“æ„(Story 7.1)
- `internal/particle/parser.go` - XMLè§£æå™¨(Story 7.1)
- `pkg/game/resource_manager.go` - èµ„æºç®¡ç†å™¨(Story 7.1æ‰©å±•)
- `pkg/ecs/entity_manager.go` - ECSå®ä½“ç®¡ç†å™¨

## Testing

[Source: docs/architecture/testing-strategy.md]

**æµ‹è¯•æ¡†æ¶:**
- Goæ ‡å‡†åº“ `testing` åŒ…
- ä½¿ç”¨ `testify/assert` æ–­è¨€åº“(å¦‚æœéœ€è¦ï¼Œå¯é€‰)

**æµ‹è¯•æ–‡ä»¶ä½ç½®:**
- `internal/particle/value_parser_test.go` (ä¸value_parser.goåŒç›®å½•)
- `pkg/systems/particle_system_test.go` (ä¸particle_system.goåŒç›®å½•)

**æµ‹è¯•è¦æ±‚:**
1. **å•å…ƒæµ‹è¯•è¦†ç›–ç‡ç›®æ ‡**: â‰¥ 80%
   - é‡ç‚¹æµ‹è¯•: `internal/particle` åŒ…(å€¼è§£æå™¨)
   - é‡ç‚¹æµ‹è¯•: `pkg/systems` åŒ…(ç²’å­ç³»ç»Ÿé€»è¾‘)

2. **å¿…é¡»æµ‹è¯•çš„åœºæ™¯**:
   - âœ… å€¼è§£æå™¨: å›ºå®šå€¼ã€èŒƒå›´ã€å…³é”®å¸§ã€æ’å€¼å…³é”®å­—
   - âœ… å…³é”®å¸§æ’å€¼: çº¿æ€§æ’å€¼æ­£ç¡®æ€§ã€è¾¹ç•Œæƒ…å†µ
   - âœ… ç²’å­ç”Ÿå‘½å‘¨æœŸ: ç”Ÿæˆã€å¹´é¾„å¢é•¿ã€è¶…æ—¶é”€æ¯
   - âœ… å‘å°„å™¨é€»è¾‘: æŒ‰é€Ÿç‡ç”Ÿæˆã€æœ€å¤§æ•°é‡é™åˆ¶ã€æŒç»­æ—¶é—´é™åˆ¶
   - âœ… åŠ›åœºç³»ç»Ÿ: åŠ é€Ÿåº¦åœºã€æ‘©æ“¦åœº
   - âœ… åŠ¨ç”»æ’å€¼: Alphaã€Scaleã€Spinå…³é”®å¸§åº”ç”¨
   - âœ… é”™è¯¯å¤„ç†: æ— æ•ˆå€¼æ ¼å¼ã€ç©ºé…ç½®ã€è¾¹ç•Œæƒ…å†µ

3. **è¿è¡Œæµ‹è¯•å‘½ä»¤**:
   ```bash
   # è¿è¡Œæ‰€æœ‰ç›¸å…³æµ‹è¯•
   go test -v ./internal/particle ./pkg/systems ./pkg/components

   # æŸ¥çœ‹è¦†ç›–ç‡
   go test -cover ./internal/particle
   go test -cover ./pkg/systems

   # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
   go test -coverprofile=coverage.out ./internal/particle ./pkg/systems
   go tool cover -html=coverage.out
   ```

4. **æµ‹è¯•æ•°æ®**:
   - ä½¿ç”¨å†…è”æµ‹è¯•å­—ç¬¦ä¸²æ¨¡æ‹ŸXMLå€¼æ ¼å¼
   - åˆ›å»ºæœ€å°åŒ–çš„æµ‹è¯•ç”¨ç²’å­é…ç½®
   - ä¸ä¾èµ–å¤–éƒ¨XMLæ–‡ä»¶(å•å…ƒæµ‹è¯•ç‹¬ç«‹æ€§)

5. **æµ‹è¯•ç»„ç»‡æ¨¡å¼**:
   ```go
   // value_parser_test.go ç¤ºä¾‹
   func TestParseValue_FixedValue(t *testing.T) {
       min, max, keyframes, _ := ParseValue("1500")
       assert.Equal(t, 1500.0, min)
       assert.Equal(t, 1500.0, max)
       assert.Nil(t, keyframes)
   }

   func TestParseValue_Range(t *testing.T) {
       min, max, _, _ := ParseValue("[0.7 0.9]")
       assert.Equal(t, 0.7, min)
       assert.Equal(t, 0.9, max)
   }

   func TestEvaluateKeyframes_Linear(t *testing.T) {
       keyframes := []Keyframe{{Time: 0, Value: 0}, {Time: 1, Value: 100}}
       result := EvaluateKeyframes(keyframes, 0.5, "Linear")
       assert.Equal(t, 50.0, result)  // çº¿æ€§æ’å€¼
   }
   ```

6. **é›†æˆæµ‹è¯•ç­–ç•¥**:
   - åœ¨ `particle_system_test.go` ä¸­åˆ›å»ºå®Œæ•´çš„æµ‹è¯•åœºæ™¯
   - ä½¿ç”¨çœŸå®çš„ EntityManager å’Œç»„ä»¶
   - æ¨¡æ‹Ÿå¤šå¸§Updateå¾ªç¯ï¼ŒéªŒè¯çŠ¶æ€å˜åŒ–
   - ç¤ºä¾‹:
     ```go
     func TestParticleSystem_FullLifecycle(t *testing.T) {
         // Setup
         em := ecs.NewEntityManager()
         ps := NewParticleSystem(em)

         // åˆ›å»ºæµ‹è¯•ç”¨å‘å°„å™¨å’Œç²’å­
         // ...

         // æ¨¡æ‹Ÿ10å¸§æ›´æ–°
         for i := 0; i < 10; i++ {
             ps.Update(0.016)  // 60 FPS
         }

         // éªŒè¯ç²’å­çŠ¶æ€
         // ...
     }
     ```

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-15 | 1.0 | Story 7.2 initial draft created | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
æ— éœ€è°ƒè¯•æ—¥å¿—ï¼ˆå¼€å‘è¿‡ç¨‹é¡ºåˆ©ï¼‰

### Completion Notes

**å®ç°æ€»ç»“:**
- âœ… æˆåŠŸå®ç°ç²’å­å‘å°„å™¨æ ¸å¿ƒå¼•æ“ï¼ŒåŒ…æ‹¬å€¼è§£æå™¨ã€ç²’å­ç»„ä»¶ã€å‘å°„å™¨ç»„ä»¶å’Œç²’å­ç³»ç»Ÿ
- âœ… å®ç°å®Œæ•´çš„ç²’å­ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆç”Ÿæˆã€æ›´æ–°ã€é”€æ¯ï¼‰
- âœ… æ”¯æŒå¤æ‚çš„å€¼æ ¼å¼è§£æï¼ˆå›ºå®šå€¼ã€èŒƒå›´ã€å…³é”®å¸§ã€æ’å€¼ï¼‰
- âœ… å®ç°åŠ¨ç”»æ’å€¼ç³»ç»Ÿï¼ˆAlphaã€Scaleã€Spinï¼‰
- âœ… å®ç°åŠ›åœºç³»ç»Ÿï¼ˆAccelerationã€Frictionï¼‰
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 91.1% (internal/particle) å’Œ ~92% (particle_system.go)ï¼Œè¶…è¿‡80%ç›®æ ‡
- âœ… æˆåŠŸé›†æˆåˆ°GameSceneï¼Œä½œä¸ºæ¸¸æˆå¾ªç¯çš„ç¬¬9ä¸ªç³»ç»Ÿ

**æµ‹è¯•ç»“æœ:**
- internal/particleåŒ…: 91.1%è¦†ç›–ç‡ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡
- particle_system.go: ~92%è¦†ç›–ç‡ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡
  - NewParticleSystem: 100%
  - Update: 100%
  - updateEmitters: 90.9%
  - updateParticles: 90.5%
  - spawnParticle: 92.2%
  - applyInterpolation: 88.9%
  - applyFields: 86.4%
- ç¼–å†™äº†13ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–ç²’å­ç”Ÿå‘½å‘¨æœŸã€å‘å°„å™¨é€»è¾‘ã€åŠ¨ç”»æ’å€¼ã€åŠ›åœºç³»ç»Ÿã€è¾¹ç•Œæƒ…å†µ

**å…³é”®æŠ€æœ¯å†³ç­–:**
1. **å€¼è§£æå™¨è®¾è®¡**: æ”¯æŒæ··åˆæ ¼å¼ï¼ˆå•å€¼+å…³é”®å¸§ï¼‰ï¼Œå¦‚".4 Linear 10,9.999999"
2. **åŠ›åœºå­˜å‚¨ç­–ç•¥**: åœ¨ç²’å­ç”Ÿæˆæ—¶å°†Fieldså¤åˆ¶åˆ°ParticleComponentï¼Œé¿å…æ¯å¸§æŸ¥æ‰¾å‘å°„å™¨
3. **å‘å°„å™¨é€»è¾‘**: ä½¿ç”¨å¾ªç¯åœ¨å•æ¬¡Updateä¸­ç”Ÿæˆå¤šä¸ªç²’å­ï¼Œç¡®ä¿åœ¨å¤§dtæƒ…å†µä¸‹ä¸ä¸¢å¤±ç²’å­
4. **æ’å€¼ç³»ç»Ÿ**: æ”¯æŒå¤šç§æ’å€¼æ¨¡å¼ï¼ˆLinearã€EaseInã€EaseOutã€FastInOutWeakï¼‰
5. **ECSåŸåˆ™éµå¾ª**: ç»„ä»¶çº¯æ•°æ®ï¼Œç³»ç»ŸåŒ…å«æ‰€æœ‰é€»è¾‘ï¼Œé›¶è€¦åˆé€šè¿‡EntityManageré€šä¿¡

**æœªæ¥Storyå»ºè®®:**
- Story 7.3: ç²’å­æ¸²æŸ“ç³»ç»Ÿï¼ˆRenderSystemæ‰©å±•ï¼Œæ”¯æŒAdditiveæ··åˆï¼‰
- Story 7.4: é«˜çº§åŠ›åœºç±»å‹ï¼ˆAttractorã€PathFollowç­‰ï¼‰
- Story 7.5: ç²’å­å¯¹è±¡æ± ä¼˜åŒ–ï¼ˆå‡å°‘å†…å­˜åˆ†é…ï¼‰

### File List

**æ–°å»ºæ–‡ä»¶:**
- `internal/particle/value_parser.go` - å€¼è§£æå™¨æ ¸å¿ƒé€»è¾‘
- `internal/particle/value_parser_test.go` - å€¼è§£æå™¨å•å…ƒæµ‹è¯•
- `pkg/components/particle_component.go` - ç²’å­ç»„ä»¶å®šä¹‰
- `pkg/components/emitter_component.go` - å‘å°„å™¨ç»„ä»¶å®šä¹‰
- `pkg/systems/particle_system.go` - ç²’å­ç³»ç»Ÿå®ç°
- `pkg/systems/particle_system_test.go` - ç²’å­ç³»ç»Ÿå•å…ƒæµ‹è¯•
- `pkg/entities/particle_factory.go` - ç²’å­æ•ˆæœå·¥å‚å‡½æ•°

**ä¿®æ”¹æ–‡ä»¶:**
- `pkg/scenes/game_scene.go` - é›†æˆParticleSystemåˆ°æ¸¸æˆå¾ªç¯ï¼ˆæ–°å¢å­—æ®µå’Œåˆå§‹åŒ–ï¼‰

**ä¾èµ–æ–‡ä»¶ï¼ˆStory 7.1ï¼‰:**
- `internal/particle/types.go` - EmitterConfigã€Fieldç»“æ„ä½“
- `internal/particle/parser.go` - XMLè§£æå™¨
- `pkg/game/resource_manager.go` - LoadParticleConfigæ–¹æ³•

## QA Results

### Review Date: 2025-10-15

### Reviewed By: Quinn (Test Architect)

### Executive Summary

**æ€»ä½“è¯„ä»·**: âœ… ä¼˜ç§€å®ç°ï¼Œè¶…é¢å®Œæˆç›®æ ‡

Story 7.2çš„å®ç°å±•ç°äº†é«˜è´¨é‡çš„å·¥ç¨‹å®è·µï¼š
- âœ… æµ‹è¯•è¦†ç›–ç‡91-92%ï¼Œè¶…è¿‡80%ç›®æ ‡
- âœ… å®Œæ•´çš„ECSæ¶æ„éµå¾ªï¼Œé›¶è€¦åˆåŸåˆ™
- âœ… ä¼˜ç§€çš„ä»£ç ç»„ç»‡å’Œæ–‡æ¡£æ³¨é‡Š
- âš ï¸ å‘ç°2å¤„æ€§èƒ½ä¼˜åŒ–æœºä¼šï¼ˆéé˜»å¡ï¼‰

**Gateå†³ç­–**: CONCERNS â†’ `docs/qa/gates/7.2-particle-emitter-core-engine.yml`

---

### Requirements Traceability (éœ€æ±‚å¯è¿½æº¯æ€§)

**æ˜ å°„æ–¹æ³•**: Given-When-Then + æµ‹è¯•ç”¨ä¾‹éªŒè¯

#### AC 1: åˆ›å»º ParticleComponent (ç²’å­ç»„ä»¶)
**Given**: ECSç³»ç»Ÿéœ€è¦è¡¨ç¤ºå•ä¸ªç²’å­çŠ¶æ€
**When**: åˆ›å»ºParticleComponentçº¯æ•°æ®ç»“æ„
**Then**:
- âœ… åŒ…å«ä½ç½®ã€é€Ÿåº¦ã€æ—‹è½¬ã€ç¼©æ”¾ã€é€æ˜åº¦ã€é¢œè‰²ã€ç”Ÿå‘½å‘¨æœŸç­‰å­—æ®µ
- âœ… æ”¯æŒå…³é”®å¸§åŠ¨ç”»æ•°æ®ï¼ˆAlphaKeyframes, ScaleKeyframes, SpinKeyframesï¼‰
- âœ… çº¯æ•°æ®ç»„ä»¶ï¼Œæ— æ–¹æ³•
- âœ… å®Œæ•´çš„GoDocæ³¨é‡Š

**éªŒè¯**:
- ä»£ç æ£€æŸ¥: `pkg/components/particle_component.go:16-64`
- ç»“æ„ä½“åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µï¼Œç¬¦åˆECSåŸåˆ™

#### AC 2: åˆ›å»º EmitterComponent (å‘å°„å™¨ç»„ä»¶)
**Given**: éœ€è¦ç®¡ç†ç²’å­å‘å°„å™¨çŠ¶æ€
**When**: åˆ›å»ºEmitterComponentç®¡ç†å‘å°„é…ç½®å’Œæ´»è·ƒç²’å­
**Then**:
- âœ… å­˜å‚¨é…ç½®å¼•ç”¨å’Œå‘å°„å™¨çŠ¶æ€
- âœ… ç®¡ç†å‘å°„æ—¶æœºï¼ˆNextSpawnTime, Ageï¼‰
- âœ… è¿½è¸ªæ´»è·ƒç²’å­åˆ—è¡¨ï¼ˆActiveParticlesï¼‰
- âœ… çº¯æ•°æ®ç»„ä»¶

**éªŒè¯**:
- ä»£ç æ£€æŸ¥: `pkg/components/emitter_component.go:17-54`
- æµ‹è¯•: `TestParticleSystem_EmitterSpawnsParticles`, `TestParticleSystem_EmitterMaxActive`

#### AC 3: åˆ›å»º ParticleSystem (ç²’å­ç³»ç»Ÿ)
**Given**: éœ€è¦æ›´æ–°æ‰€æœ‰ç²’å­å’Œå‘å°„å™¨
**When**: å®ç°ParticleSystem.Update(dt)æ–¹æ³•
**Then**:
- âœ… ç²’å­ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆç”Ÿæˆã€æ›´æ–°ã€é”€æ¯ï¼‰
- âœ… åŠ¨ç”»æ’å€¼ç³»ç»Ÿï¼ˆAlpha, Scale, Spinï¼‰
- âœ… åŠ›åœºç³»ç»Ÿï¼ˆAcceleration, Frictionï¼‰

**éªŒè¯**:
- æµ‹è¯•: `TestParticleSystem_ParticleLifecycle` - éªŒè¯å¹´é¾„å¢é•¿å’Œè¶…æ—¶é”€æ¯
- æµ‹è¯•: `TestParticleSystem_AlphaInterpolation` - éªŒè¯çº¿æ€§æ’å€¼æ­£ç¡®æ€§
- æµ‹è¯•: `TestParticleSystem_AccelerationField` - éªŒè¯é‡åŠ›æ•ˆæœ
- æµ‹è¯•: `TestParticleSystem_FrictionField` - éªŒè¯æ‘©æ“¦åŠ›æ•ˆæœ
- è¦†ç›–ç‡: particle_system.go ~92%

#### AC 4: å®ç°å‘å°„å™¨é€»è¾‘
**Given**: å‘å°„å™¨éœ€è¦æŒ‰é…ç½®ç”Ÿæˆç²’å­
**When**: æ ¹æ®SpawnRateã€LaunchSpeedã€EmitterBoxç­‰å‚æ•°
**Then**:
- âœ… æŒ‰é€Ÿç‡ç”Ÿæˆç²’å­ï¼ˆSpawnRateæ§åˆ¶ï¼‰
- âœ… å‘å°„é€Ÿåº¦å’Œè§’åº¦è®¡ç®—ï¼ˆLaunchSpeed + LaunchAngleï¼‰
- âœ… å‘å°„åŒºåŸŸéšæœºï¼ˆEmitterBoxæ”¯æŒï¼‰

**éªŒè¯**:
- æµ‹è¯•: `TestParticleSystem_EmitterSpawnsParticles` - éªŒè¯æ¯ç§’ç”Ÿæˆ10ä¸ªç²’å­
- æµ‹è¯•: `TestParticleSystem_EmitterMaxActive` - éªŒè¯æœ€å¤§æ´»è·ƒæ•°é™åˆ¶
- æµ‹è¯•: `TestParticleSystem_EmitterMaxLaunched` - éªŒè¯æœ€å¤§å‘å°„æ€»æ•°é™åˆ¶
- ä»£ç æ£€æŸ¥: `spawnParticle()` å‡½æ•°å®ç°å®Œæ•´çš„å‚æ•°è§£æå’ŒéšæœºåŒ–

#### AC 5: å•å…ƒæµ‹è¯•éªŒè¯
**Given**: éœ€è¦éªŒè¯ç²’å­å¼•æ“æ­£ç¡®æ€§
**When**: ç¼–å†™å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘
**Then**:
- âœ… ç²’å­ç”Ÿå‘½å‘¨æœŸæµ‹è¯•ï¼ˆ3ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… åŠ¨ç”»æ’å€¼æµ‹è¯•ï¼ˆ3ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… åŠ›åœºè®¡ç®—æµ‹è¯•ï¼ˆ2ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… å‘å°„å™¨é€»è¾‘æµ‹è¯•ï¼ˆ4ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼ˆ3ä¸ªå­æµ‹è¯•ï¼‰

**éªŒè¯**:
- `value_parser_test.go`: 10ä¸ªæµ‹è¯•å‡½æ•°ï¼Œ43ä¸ªå­æµ‹è¯•
- `particle_system_test.go`: 13ä¸ªæµ‹è¯•å‡½æ•°
- æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

#### AC 6: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
**Given**: æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡80%
**When**: è¿è¡Œè¦†ç›–ç‡æ£€æŸ¥
**Then**:
- âœ… internal/particle: **91.1%** è¦†ç›–ç‡ï¼ˆè¶…æ ‡11.1%ï¼‰
- âœ… particle_system.go: **~92%** è¦†ç›–ç‡ï¼ˆè¶…æ ‡12%ï¼‰

**è¯¦ç»†è¦†ç›–ç‡**:
```
NewParticleSystem:          100.0%
Update:                     100.0%
updateEmitters:              90.9%
cleanupDestroyedParticles:  100.0%
updateParticles:             90.5%
spawnParticle:               92.2%
applyInterpolation:          88.9%
applyFields:                 86.4%
```

**éªŒè¯**:
- å‘½ä»¤è¾“å‡º: `go test -cover ./internal/particle ./pkg/systems`
- âœ… è¶…è¿‡80%ç›®æ ‡ï¼Œè¾¾åˆ°ä¼˜ç§€æ°´å¹³

**æ€»ç»“**: æ‰€æœ‰6ä¸ªACå®Œå…¨æ»¡è¶³ï¼Œæ— è¦†ç›–ç¼ºå£ âœ…

---

### Code Quality Assessment (ä»£ç è´¨é‡è¯„ä¼°)

#### æ¶æ„è®¾è®¡ â­â­â­â­â­ (5/5)
**ä¼˜ç‚¹**:
1. **å®Œç¾çš„ECSå®ç°**: ç»„ä»¶çº¯æ•°æ®ï¼Œç³»ç»ŸåŒ…å«é€»è¾‘ï¼Œé›¶è€¦åˆé€šä¿¡
2. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**:
   - `value_parser.go`: å€¼è§£æé€»è¾‘ç‹¬ç«‹
   - `particle_system.go`: ç³»ç»Ÿé€»è¾‘åˆ†ä¸º5ä¸ªç§æœ‰æ–¹æ³•ï¼Œå•ä¸€èŒè´£
3. **æ€§èƒ½ä¼˜åŒ–è®¾è®¡**:
   - åœ¨å‘å°„å™¨ç»„ä»¶ä¸­é¢„è§£æé…ç½®å‚æ•°ï¼ˆé¿å…æ¯å¸§è§£æï¼‰
   - ä½¿ç”¨å¾ªç¯åœ¨å•æ¬¡Updateä¸­ç”Ÿæˆå¤šä¸ªç²’å­ï¼ˆå¤§dtå®¹é”™ï¼‰
4. **æ‰©å±•æ€§è®¾è®¡**:
   - æ’å€¼æ¨¡å¼æ”¯æŒLinear/EaseIn/EaseOut/FastInOutWeak
   - åŠ›åœºç±»å‹æ”¯æŒAcceleration/Frictionï¼ˆæ˜“äºæ‰©å±•Attractorç­‰ï¼‰

**ç¤ºä¾‹**:
```go
// pkg/systems/particle_system.go:172-291
// spawnParticleå‡½æ•°å±•ç¤ºäº†ä¼˜ç§€çš„å‚æ•°è§£æå’Œåˆå§‹åŒ–é€»è¾‘
// - ä»é…ç½®è§£æéšæœºå€¼èŒƒå›´
// - è®¡ç®—åˆå§‹é€Ÿåº¦çŸ¢é‡ï¼ˆä¸‰è§’å‡½æ•°ï¼‰
// - å¤„ç†é»˜è®¤å€¼ï¼ˆå¦‚Alpha=0æ—¶è®¾ä¸º1.0ï¼‰
// - å¤åˆ¶Fieldsåˆ°ç²’å­ï¼ˆé¿å…æ¯å¸§æŸ¥æ‰¾å‘å°„å™¨ï¼‰
```

#### ä»£ç å¯è¯»æ€§ â­â­â­â­â­ (5/5)
**ä¼˜ç‚¹**:
1. **å®Œæ•´çš„GoDocæ³¨é‡Š**: æ‰€æœ‰å…¬å¼€ç±»å‹å’Œå‡½æ•°éƒ½æœ‰æ–‡æ¡£
2. **ä¸­è‹±æ–‡åŒè¯­æ³¨é‡Š**: å…³é”®æ¦‚å¿µä½¿ç”¨ä¸­æ–‡è¡¥å……è¯´æ˜ï¼ˆç¬¦åˆé¡¹ç›®æƒ¯ä¾‹ï¼‰
3. **æ¸…æ™°çš„å˜é‡å‘½å**: `NextSpawnTime`, `AlphaKeyframes`, `applyInterpolation`
4. **é€»è¾‘åˆ†ç»„**: ä½¿ç”¨æ³¨é‡Šåˆ†éš”ä¸åŒåŠŸèƒ½åŒºå—

**ç¤ºä¾‹**:
```go
// pkg/components/particle_component.go:8-15
// ParticleComponent represents a single particle instance...
// Particles are typically created and managed by the ParticleSystem...
// This is a pure data component following ECS principles...
```

#### é”™è¯¯å¤„ç† â­â­â­â­ (4/5)
**ä¼˜ç‚¹**:
1. âœ… Nilæ£€æŸ¥å®Œæ•´ï¼ˆemitter.Config, particle.Lifetimeï¼‰
2. âœ… è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼ˆç²’å­è¶…æ—¶ã€å‘å°„å™¨è¶…æ—¶ï¼‰
3. âœ… å®‰å…¨çš„æ•°ç»„è®¿é—®ï¼ˆkeyframesé•¿åº¦æ£€æŸ¥ï¼‰
4. âœ… é»˜è®¤å€¼å¤„ç†ï¼ˆScale=0æ—¶è®¾ä¸º1.0ï¼‰

**æ”¹è¿›å»ºè®®**:
- âš ï¸ `particle_factory.go:34`: å¯ä»¥å¯¹ç©ºé…ç½®è¿”å›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

#### æ€§èƒ½è€ƒè™‘ â­â­â­â­ (4/5)
**ä¼˜ç‚¹**:
1. âœ… é¢„è§£æé…ç½®å‚æ•°åˆ°EmitterComponentï¼ˆé¿å…é‡å¤å­—ç¬¦ä¸²è§£æï¼‰
2. âœ… å¤ç”¨ActiveParticlesåˆ‡ç‰‡ï¼ˆä¸é¢‘ç¹åˆ†é…ï¼‰
3. âœ… æ‰¹é‡æ›´æ–°ç²’å­ï¼ˆå•æ¬¡Updateå¤„ç†æ‰€æœ‰ç²’å­ï¼‰

**å‘ç°çš„ä¼˜åŒ–æœºä¼š** (éé˜»å¡):
1. âš ï¸ **PERF-001**: `applyFields`ä¸­å¯¹é™æ€åŠ›åœºå€¼é‡å¤è°ƒç”¨ParseValueå’ŒRandomInRange
   - **å½“å‰**: æ¯å¸§æ¯ä¸ªç²’å­è§£æ `field.X`, `field.Y`
   - **å»ºè®®**: åœ¨ç²’å­ç”Ÿæˆæ—¶è§£æé™æ€å€¼ï¼Œå­˜å‚¨åˆ°ç²’å­ç»„ä»¶
   - **å½±å“**: 100ä¸ªç²’å­ Ã— 1ä¸ªåŠ›åœº Ã— 60fps = æ¯ç§’6000æ¬¡ä¸å¿…è¦è§£æ
   - **ä¼˜å…ˆçº§**: ä¸­ç­‰ï¼ˆå»ºè®®åœ¨æ€§èƒ½æµ‹è¯•åå†³å®šæ˜¯å¦ä¼˜åŒ–ï¼‰

2. â„¹ï¸ **å¯¹è±¡æ± **: æœªæ¥å¯è€ƒè™‘å®ç°ç²’å­å¯¹è±¡æ± ï¼ˆStory 7.5å»ºè®®ï¼‰
   - å½“å‰: æ¯ä¸ªç²’å­æ­»äº¡è°ƒç”¨DestroyEntityï¼ˆGCå‹åŠ›ï¼‰
   - å»ºè®®: å¤ç”¨ç²’å­å®ä½“å’Œç»„ä»¶
   - ä¼˜å…ˆçº§: ä½ï¼ˆå½“å‰å®ç°å¯¹100-200ä¸ªç²’å­è¶³å¤Ÿï¼‰

#### æµ‹è¯•è´¨é‡ â­â­â­â­â­ (5/5)
**ä¼˜ç‚¹**:
1. **å…¨é¢çš„æµ‹è¯•è¦†ç›–**: 23ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
2. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**: é›¶ç”Ÿå‘½å‘¨æœŸã€nilé…ç½®ã€ç©ºå…³é”®å¸§
3. **æ¸…æ™°çš„æµ‹è¯•ç»“æ„**: ä½¿ç”¨è¡¨é©±åŠ¨æµ‹è¯•ï¼ˆtable-driven testsï¼‰
4. **ç‹¬ç«‹çš„æµ‹è¯•**: ä¸ä¾èµ–å¤–éƒ¨èµ„æºï¼Œä½¿ç”¨å†…å­˜EntityManager

**ç¤ºä¾‹**:
```go
// pkg/systems/particle_system_test.go:219-243
// TestEvaluateKeyframes_MultipleSegments æµ‹è¯•å¤šæ®µæ’å€¼
// ä½¿ç”¨3ä¸ªå…³é”®å¸§éªŒè¯æ’å€¼åœ¨ä¸åŒæ—¶é—´ç‚¹çš„æ­£ç¡®æ€§
```

---

### Compliance Check (åˆè§„æ€§æ£€æŸ¥)

#### âœ… Coding Standards (ç¼–ç è§„èŒƒ)
- **å‘½åçº¦å®š**: âœ… å®Œå…¨ç¬¦åˆ
  - åŒ…å: `particle`, `components`, `systems` (snake_case)
  - ç»“æ„ä½“: `ParticleComponent`, `EmitterComponent` (PascalCase)
  - å…¬å¼€æ–¹æ³•: `Update`, `ParseValue` (PascalCase)
  - ç§æœ‰æ–¹æ³•: `spawnParticle`, `applyFields` (camelCase)
- **é›¶è€¦åˆåŸåˆ™**: âœ… ParticleSystemä»…é€šè¿‡EntityManageré€šä¿¡
- **æ•°æ®-è¡Œä¸ºåˆ†ç¦»**: âœ… ç»„ä»¶æ— æ–¹æ³•ï¼Œæ‰€æœ‰é€»è¾‘åœ¨Systemä¸­
- **é”™è¯¯å¤„ç†**: âœ… æ‰€æœ‰å¯èƒ½å¤±è´¥çš„æ“ä½œéƒ½æœ‰æ£€æŸ¥
- **GoDocæ³¨é‡Š**: âœ… æ‰€æœ‰å…¬å¼€ç±»å‹/å‡½æ•°éƒ½æœ‰æ–‡æ¡£

**å°é—®é¢˜**:
- âš ï¸ **CODE-001**: `particle_system.go:99` é­”æ³•æ•°å­—10ï¼ˆå®‰å…¨æ£€æŸ¥é˜ˆå€¼ï¼‰
  - å»ºè®®: `const MaxSpawnTimeAhead = 10.0 // Prevent infinite spawn loops`
  - ä¼˜å…ˆçº§: ä½

#### âœ… Project Structure (é¡¹ç›®ç»“æ„)
- **æ–‡ä»¶ä½ç½®**: âœ… å®Œå…¨ç¬¦åˆ `unified-project-structure.md`
  - `internal/particle/`: å€¼è§£æå™¨ï¼ˆå†…éƒ¨é€»è¾‘ï¼‰
  - `pkg/components/`: ç»„ä»¶å®šä¹‰
  - `pkg/systems/`: ç³»ç»Ÿå®ç°
  - `pkg/entities/`: å·¥å‚å‡½æ•°
- **æµ‹è¯•æ–‡ä»¶**: âœ… ä¸æºæ–‡ä»¶åŒç›®å½•ï¼Œ`_test.go`åç¼€

#### âœ… Testing Strategy (æµ‹è¯•ç­–ç•¥)
- **æµ‹è¯•é‡‘å­—å¡”**: âœ… é‡ç‚¹å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç‡91-92%
- **æµ‹è¯•ç‹¬ç«‹æ€§**: âœ… ä¸ä¾èµ–å¤–éƒ¨æ–‡ä»¶æˆ–èµ„æº
- **æµ‹è¯•å¯è¯»æ€§**: âœ… æ¸…æ™°çš„æµ‹è¯•åç§°å’Œå­æµ‹è¯•

#### âœ… All ACs Met (æ‰€æœ‰ACæ»¡è¶³)
- AC 1-6: å…¨éƒ¨å®Œæˆ âœ…
- æµ‹è¯•è¦†ç›–ç‡: è¶…æ ‡è¾¾åˆ°91-92% âœ…
- æ–‡æ¡£æ›´æ–°: CLAUDE.mdå·²æ›´æ–° âœ…

---

### Refactoring Performed (é‡æ„å·¥ä½œ)

**æ— éœ€é‡æ„** - ä»£ç è´¨é‡å·²ç»å¾ˆé«˜ï¼Œç°æœ‰å®ç°ç¬¦åˆæœ€ä½³å®è·µã€‚

å‘ç°çš„ä¼˜åŒ–æœºä¼šå·²è®°å½•ä¸ºå»ºè®®ï¼ˆè§"Improvements Checklist"ï¼‰ï¼Œç”±å¼€å‘å›¢é˜Ÿå†³å®šæ˜¯å¦åœ¨æœªæ¥Sprintå®æ–½ã€‚

---

### Improvements Checklist (æ”¹è¿›æ¸…å•)

**ç«‹å³æ”¹è¿›ï¼ˆå¯é€‰ï¼‰**:
- [ ] ä¼˜åŒ–`applyFields`æ€§èƒ½ï¼šåœ¨ç²’å­ç”Ÿæˆæ—¶é¢„è§£æé™æ€åŠ›åœºå€¼ (PERF-001)
  - æ–‡ä»¶: `pkg/systems/particle_system.go:320-369`
  - é¢„æœŸæ”¶ç›Š: å‡å°‘60-80%çš„é‡å¤å­—ç¬¦ä¸²è§£æ
  - é£é™©: ä½ï¼Œä»…éœ€åœ¨spawnParticleä¸­æ·»åŠ è§£æé€»è¾‘
- [ ] æå–é­”æ³•æ•°å­—ä¸ºå¸¸é‡ (CODE-001)
  - æ–‡ä»¶: `pkg/systems/particle_system.go:99`
  - æ”¹åŠ¨: `const MaxSpawnTimeAhead = 10.0`

**æœªæ¥ä¼˜åŒ–ï¼ˆStory 7.5+ï¼‰**:
- [ ] å®ç°ç²’å­å¯¹è±¡æ± ä»¥å‡å°‘GCå‹åŠ›
  - åœºæ™¯: å½“ç²’å­æ•°é‡ > 500æˆ–å‡ºç°å¸§ç‡ä¸‹é™æ—¶
  - æ”¶ç›Š: å‡å°‘å†…å­˜åˆ†é…ï¼Œæå‡æ€§èƒ½
- [ ] æ”¯æŒæ›´å¤šåŠ›åœºç±»å‹ï¼ˆAttractor, PathFollowï¼‰
  - ä¾èµ–: Story 7.3/7.4è§„åˆ’
- [ ] æ”¯æŒå¤šå‘å°„å™¨æ•ˆæœï¼ˆparticle_factory.goå½“å‰ä»…æ”¯æŒå•å‘å°„å™¨ï¼‰
  - åœºæ™¯: å¤æ‚ç²’å­æ•ˆæœï¼ˆå¦‚Award.xmlæœ‰2ä¸ªå‘å°„å™¨ï¼‰

---

### Security Review (å®‰å…¨å®¡æŸ¥)

**è¯„çº§**: âœ… PASS

**åˆ†æ**:
- æ— ç”¨æˆ·è¾“å…¥å¤„ç†
- æ— ç½‘ç»œé€šä¿¡
- æ— æ–‡ä»¶ç³»ç»Ÿå†™å…¥
- çº¯æ¸¸æˆå¼•æ“é€»è¾‘ï¼Œæ— å®‰å…¨æ•æ„Ÿæ“ä½œ

**ç»“è®º**: æ¸¸æˆå®¢æˆ·ç«¯ä»£ç ï¼Œä¸æ¶‰åŠå®‰å…¨é£é™©ã€‚

---

### Performance Considerations (æ€§èƒ½è€ƒé‡)

**è¯„çº§**: âš ï¸ CONCERNS (éé˜»å¡)

**æµ‹é‡ç›®æ ‡** (æ¥è‡ªEpic 7æŠ€æœ¯çº¦æŸ):
- ç²’å­æ›´æ–°æ—¶é—´ < 1ms/frame (å¯¹äº100ä¸ªç²’å­)

**å½“å‰å®ç°åˆ†æ**:
1. **ä¼˜ç§€çš„è®¾è®¡**:
   - âœ… é¢„è§£æå‘å°„å™¨å‚æ•°ï¼ˆSpawnRate, EmitterBoxç­‰ï¼‰
   - âœ… æ‰¹é‡å¤„ç†ï¼Œå•æ¬¡éå†
   - âœ… é¿å…é¢‘ç¹å†…å­˜åˆ†é…ï¼ˆå¤ç”¨ActiveParticlesåˆ‡ç‰‡ï¼‰

2. **ä¼˜åŒ–æœºä¼š**:
   - âš ï¸ **applyFieldsçƒ­è·¯å¾„ä¼˜åŒ–** (PERF-001):
     - å½“å‰: æ¯å¸§æ¯ç²’å­è°ƒç”¨`ParseValue` + `RandomInRange`ï¼ˆå¯¹äºé™æ€å€¼ï¼‰
     - ç¤ºä¾‹: 100ç²’å­ Ã— 1åŠ›åœº Ã— 60fps = 6000æ¬¡/ç§’é‡å¤è§£æ
     - å»ºè®®: é¢„è§£æå¹¶ç¼“å­˜é™æ€å€¼
     - ä¼˜å…ˆçº§: ä¸­ç­‰ï¼ˆå»ºè®®æ€§èƒ½æµ‹è¯•åç¡®è®¤ï¼‰

3. **æœªæ¥ä¼˜åŒ–** (Story 7.5å»ºè®®):
   - å¯¹è±¡æ± : å½“ç²’å­æ•° > 500æ—¶è€ƒè™‘
   - ç©ºé—´åˆ†åŒº: å½“ç²’å­æ•° > 1000æ—¶è€ƒè™‘

**å»ºè®®**:
- âœ… å½“å‰å®ç°å¯¹ä¸­ç­‰è§„æ¨¡æ•ˆæœï¼ˆ100-200ç²’å­ï¼‰æ€§èƒ½è¶³å¤Ÿ
- â„¹ï¸ å»ºè®®åœ¨é›†æˆæµ‹è¯•ä¸­ç›‘æ§å¸§ç‡ï¼Œå¦‚å‡ºç°æ€§èƒ½é—®é¢˜å†ä¼˜åŒ–
- â„¹ï¸ å¯åœ¨Story 7.3ï¼ˆæ¸²æŸ“ï¼‰åè¿›è¡Œå®Œæ•´æ€§èƒ½æµ‹è¯•

---

### Technical Debt Identification (æŠ€æœ¯å€ºåŠ¡)

**å½“å‰æŠ€æœ¯å€ºåŠ¡**: æä½

**è¯†åˆ«é¡¹ç›®**:
1. **æ€§èƒ½ä¼˜åŒ–å»¶è¿Ÿ** (ä¼˜å…ˆçº§: ä½)
   - æè¿°: applyFieldså¯ä¼˜åŒ–ä½†æœªä¼˜åŒ–
   - åŸå› : å½“å‰è§„æ¨¡ä¸éœ€è¦ï¼Œè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº
   - å¿è¿˜è®¡åˆ’: Story 7.5æˆ–æ€§èƒ½æµ‹è¯•å
   - æˆæœ¬: 2-4å°æ—¶å¼€å‘ + 1å°æ—¶æµ‹è¯•

2. **å¤šå‘å°„å™¨æ”¯æŒæœªå®ç°** (ä¼˜å…ˆçº§: ä½)
   - æè¿°: particle_factory.goä»…ä½¿ç”¨ç¬¬ä¸€ä¸ªå‘å°„å™¨
   - åŸå› : ç®€åŒ–å®ç°ï¼Œå¤§éƒ¨åˆ†æ•ˆæœåªæœ‰1ä¸ªå‘å°„å™¨
   - å¿è¿˜è®¡åˆ’: Story 7.4æˆ–éœ€è¦æ—¶
   - æˆæœ¬: 4-6å°æ—¶å¼€å‘ + æµ‹è¯•

**æ€»ä½“è¯„ä»·**: æŠ€æœ¯å€ºåŠ¡ç®¡ç†è‰¯å¥½ï¼Œæ— ç´¯ç§¯å€ºåŠ¡é£é™© âœ…

---

### Files Modified During Review (è¯„å®¡æœŸé—´ä¿®æ”¹çš„æ–‡ä»¶)

**æ— æ–‡ä»¶ä¿®æ”¹** - ä»£ç è´¨é‡å·²æ»¡è¶³ç”Ÿäº§æ ‡å‡†ï¼Œæ— éœ€é‡æ„ã€‚

å¦‚æœå¼€å‘å›¢é˜Ÿå†³å®šå®æ–½"Improvements Checklist"ä¸­çš„ä¼˜åŒ–ï¼Œè¯·æ›´æ–°File Listéƒ¨åˆ†ã€‚

---

### Gate Status (è´¨é‡é—¨çŠ¶æ€)

**Gate**: CONCERNS
**Location**: `docs/qa/gates/7.2-particle-emitter-core-engine.yml`

**å†³ç­–ç†ç”±**:
- âœ… æ‰€æœ‰ACå®Œæˆï¼Œæµ‹è¯•è¦†ç›–ç‡è¶…æ ‡
- âœ… ä»£ç è´¨é‡ä¼˜ç§€ï¼Œæ¶æ„è®¾è®¡å®Œç¾
- âš ï¸ å‘ç°2å¤„æ€§èƒ½ä¼˜åŒ–æœºä¼šï¼ˆä¸­ç­‰+ä½ä¼˜å…ˆçº§ï¼‰
- âš ï¸ å»ºè®®åœ¨Story 7.3åè¿›è¡Œæ€§èƒ½æµ‹è¯•éªŒè¯

**CONCERNSå«ä¹‰**:
- å®ç°è´¨é‡ä¼˜ç§€ï¼Œå¯ä»¥ç»§ç»­å¼€å‘
- å­˜åœ¨éé˜»å¡æ€§æ”¹è¿›å»ºè®®ï¼Œå›¢é˜Ÿå¯è‡ªè¡Œå†³å®šæ˜¯å¦å®æ–½
- å»ºè®®åœ¨ä¸‹ä¸€é˜¶æ®µè¿›è¡Œæ€§èƒ½éªŒè¯

**Quality Score**: 80/100
- æ‰£åˆ†é¡¹: æ€§èƒ½ä¼˜åŒ–æœºä¼šï¼ˆ-10ï¼‰ + é­”æ³•æ•°å­—ï¼ˆ-10ï¼‰
- ä»å¤„äºè‰¯å¥½èŒƒå›´ï¼ˆ>= 70ä¸ºåˆæ ¼ï¼‰

---

### Recommended Status (æ¨èçŠ¶æ€)

âœ… **Ready for Done**

**ç†ç”±**:
1. æ‰€æœ‰ACå®Œæˆ âœ…
2. æµ‹è¯•è¦†ç›–ç‡91-92%ï¼Œè¶…æ ‡ âœ…
3. ä»£ç è´¨é‡ä¼˜ç§€ï¼Œç¬¦åˆæ‰€æœ‰ç¼–ç è§„èŒƒ âœ…
4. è¯†åˆ«çš„é—®é¢˜ä¸ºéé˜»å¡æ€§ä¼˜åŒ–å»ºè®® âœ…
5. Story Ownerå¯è‡ªè¡Œå†³å®šæ˜¯å¦å®æ–½ä¼˜åŒ– âœ…

**ä¸‹ä¸€æ­¥å»ºè®®**:
1. Story Ownerå°†çŠ¶æ€æ›´æ–°ä¸º"Done"
2. ç»§ç»­Story 7.3ï¼ˆç²’å­æ¸²æŸ“ç³»ç»Ÿï¼‰
3. åœ¨Story 7.3å®Œæˆåè¿›è¡Œç«¯åˆ°ç«¯æ€§èƒ½æµ‹è¯•
4. æ ¹æ®æ€§èƒ½æµ‹è¯•ç»“æœå†³å®šæ˜¯å¦å®æ–½PERF-001ä¼˜åŒ–

---

### Reviewer Notes (è¯„å®¡å‘˜å¤‡æ³¨)

**å†™ç»™å¼€å‘å›¢é˜Ÿ**:

è¿™æ˜¯ä¸€ä¸ªæ•™ç§‘ä¹¦çº§åˆ«çš„ECSå®ç°æ¡ˆä¾‹ ğŸ‰ï¼

**ç‰¹åˆ«äº®ç‚¹**:
1. **æµ‹è¯•é©±åŠ¨å¼€å‘å…¸èŒƒ**: 91-92%çš„è¦†ç›–ç‡ä¸æ˜¯ä¸ºäº†è¾¾æ ‡ï¼Œè€Œæ˜¯çœŸæ­£è¦†ç›–äº†æ ¸å¿ƒé€»è¾‘
2. **æ¶æ„è®¾è®¡å‰ç»æ€§**: å€¼è§£æå™¨ã€æ’å€¼ç³»ç»Ÿã€åŠ›åœºç³»ç»Ÿéƒ½è®¾è®¡ä¸ºæ˜“æ‰©å±•
3. **æ€§èƒ½æ„è¯†**: åœ¨ç²’å­ç”Ÿæˆæ—¶é¢„è§£æé…ç½®ï¼Œé¿å…è¿è¡Œæ—¶å¼€é”€
4. **æ–‡æ¡£è´¨é‡**: GoDoc + ä¸­æ–‡æ³¨é‡Š + Dev Notesï¼Œæœªæ¥ç»´æŠ¤è€…ä¼šæ„Ÿè°¢ä½ 

**å…³äºCONCERNSå†³ç­–**:
- è¿™ä¸æ˜¯å¤±è´¥çš„æ ‡å¿—ï¼Œè€Œæ˜¯å¯¹å“è¶Šçš„è¿½æ±‚
- è¯†åˆ«çš„ä¼˜åŒ–æœºä¼šæ˜¯"é”¦ä¸Šæ·»èŠ±"ï¼Œä¸æ˜¯"é›ªä¸­é€ç‚­"
- æ€§èƒ½ä¼˜åŒ–åº”è¯¥åŸºäºæ•°æ®é©±åŠ¨ï¼Œè€Œä¸æ˜¯çŒœæµ‹

**å»ºè®®å®æ–½é¡ºåº**:
1. âœ… ç«‹å³: å°†Statusæ›´æ–°ä¸ºDoneï¼Œç»§ç»­Story 7.3
2. ğŸ”œ Story 7.3å: è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼ˆ100-500ç²’å­ï¼‰
3. ğŸ“Š æ ¹æ®æ•°æ®: å¦‚æœå¸§ç‡ < 60fpsï¼Œå®æ–½PERF-001ä¼˜åŒ–
4. ğŸš€ Story 7.5: è€ƒè™‘å¯¹è±¡æ± ï¼ˆå¦‚æœç²’å­æ•° > 500ï¼‰

**æœ€åçš„è¯**:
ä¿æŒè¿™ç§å·¥ç¨‹è´¨é‡ï¼ŒPVZé¡¹ç›®å°†æˆä¸ºGoæ¸¸æˆå¼€å‘çš„æœ€ä½³å®è·µèŒƒä¾‹ ğŸ’ª

---

Quinn (Test Architect)
2025-10-15
