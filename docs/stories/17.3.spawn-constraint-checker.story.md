# Story 17.3: åƒµå°¸ç”Ÿæˆé™åˆ¶æ£€æŸ¥ç³»ç»Ÿ

## Status

Done

## Story

**As a** å¼€å‘è€…,
**I want** to implement constraint checking before spawning zombies,
**so that** only valid zombies are spawned according to game rules.

## Acceptance Criteria

1. **å‡ºæ€ªç±»å‹æ£€æŸ¥**:
   - éªŒè¯åƒµå°¸ç±»å‹æ˜¯å¦åœ¨å½“å‰å…³å¡å…è®¸åˆ—è¡¨ä¸­
   - æ”¯æŒåœºåœ°ç±»å‹é™åˆ¶ï¼ˆæ°´è·¯åƒµå°¸ã€èˆç‹é™åˆ¶ç­‰ï¼‰

2. **é˜¶æ•°é™åˆ¶**:
   - ä¸€é˜¶åƒµå°¸: ç¬¬ 1 æ³¢èµ·å¯å‡ºç°
   - äºŒé˜¶åƒµå°¸: ç¬¬ 3 æ³¢èµ·
   - ä¸‰é˜¶åƒµå°¸: ç¬¬ 8 æ³¢èµ·
   - å››é˜¶åƒµå°¸: ç¬¬ 15 æ³¢èµ·ï¼ˆæ ¹æ®è½®æ•°è°ƒæ•´ï¼‰

3. **çº¢çœ¼æ•°é‡ä¸Šé™**:
   - åˆå§‹ä¸Šé™: 0
   - è½®æ•° â‰¥ 5 èµ·ï¼Œæ¯è½® +1
   - ç”Ÿæˆå‰æ£€æŸ¥å·²ç”Ÿæˆçº¢çœ¼æ•°é‡

4. **é…ç½®é©±åŠ¨**:
   - é™åˆ¶è§„åˆ™å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­
   - æ”¯æŒæŒ‰å…³å¡è¦†ç›–é»˜è®¤è§„åˆ™

5. **å•å…ƒæµ‹è¯•**: è¦†ç›–ç‡ â‰¥ 80%

## Tasks / Subtasks

- [x] **Task 1: åˆ›å»ºåƒµå°¸ç”Ÿæˆè§„åˆ™é…ç½®æ–‡ä»¶** (AC: 4)
  - [x] åˆ›å»º `data/spawn_rules.yaml` é…ç½®æ–‡ä»¶
  - [x] å®šä¹‰åƒµå°¸é˜¶æ•°æ˜ å°„è¡¨ï¼ˆæ™®åƒµ=1é˜¶ï¼Œè·¯éšœ=1é˜¶ï¼Œé“æ¡¶=2é˜¶ç­‰ï¼‰
  - [x] å®šä¹‰é˜¶æ•°æ³¢æ¬¡é™åˆ¶è¡¨ï¼ˆä¸€é˜¶ç¬¬1æ³¢èµ·ï¼ŒäºŒé˜¶ç¬¬3æ³¢èµ·ç­‰ï¼‰
  - [x] å®šä¹‰çº¢çœ¼æ•°é‡ä¸Šé™è®¡ç®—å‚æ•°ï¼ˆèµ·å§‹è½®æ•°ã€æ¯è½®å¢é‡ï¼‰
  - [x] æ·»åŠ åœºåœ°ç±»å‹é™åˆ¶è§„åˆ™ï¼ˆæ°´è·¯åƒµå°¸ã€èˆç‹é™åˆ¶ï¼‰

- [x] **Task 2: å®ç°ç”Ÿæˆè§„åˆ™é…ç½®åŠ è½½å™¨** (AC: 4)
  - [x] åœ¨ `pkg/config/spawn_rules.go` ä¸­åˆ›å»º `SpawnRulesConfig` ç»“æ„ä½“
  - [x] å®ç° `LoadSpawnRules()` å‡½æ•°ä» YAML åŠ è½½é…ç½®
  - [x] å®ç°é…ç½®éªŒè¯é€»è¾‘ `validateSpawnRules()`
  - [x] æ·»åŠ å•å…ƒæµ‹è¯• `pkg/config/spawn_rules_test.go`

- [x] **Task 3: åˆ›å»ºç”Ÿæˆé™åˆ¶æ£€æŸ¥ç»„ä»¶** (AC: 1, 2, 3)
  - [x] åœ¨ `pkg/components/spawn_constraint.go` åˆ›å»º `SpawnConstraintComponent`
  - [x] å­—æ®µï¼š`RedEyeCount int` - å·²ç”Ÿæˆçš„çº¢çœ¼å·¨äººæ•°é‡
  - [x] å­—æ®µï¼š`CurrentWaveNum int` - å½“å‰æ³¢æ¬¡ç¼–å·
  - [x] å­—æ®µï¼š`AllowedZombieTypes []string` - å½“å‰å…³å¡å…è®¸çš„åƒµå°¸ç±»å‹åˆ—è¡¨
  - [x] å­—æ®µï¼š`SceneType string` - åœºæ™¯ç±»å‹ï¼ˆday/night/poolç­‰ï¼‰

- [x] **Task 4: å®ç°ç”Ÿæˆé™åˆ¶æ£€æŸ¥ç³»ç»Ÿæ ¸å¿ƒé€»è¾‘** (AC: 1, 2, 3)
  - [x] åœ¨ `pkg/systems/spawn_constraint_system.go` åˆ›å»º `SpawnConstraintSystem`
  - [x] å®ç° `CheckZombieTypeAllowed()` - æ£€æŸ¥åƒµå°¸ç±»å‹æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
  - [x] å®ç° `CheckTierRestriction()` - æ£€æŸ¥åƒµå°¸é˜¶æ•°æ˜¯å¦ç¬¦åˆæ³¢æ¬¡é™åˆ¶
  - [x] å®ç° `CheckRedEyeLimit()` - æ£€æŸ¥çº¢çœ¼æ•°é‡æ˜¯å¦è¶…é™
  - [x] å®ç° `CalculateRedEyeCapacity()` - æ ¹æ®è½®æ•°è®¡ç®—çº¢çœ¼ä¸Šé™
  - [x] å®ç° `ValidateZombieSpawn()` - ç»¼åˆéªŒè¯å‡½æ•°

- [x] **Task 5: å®ç°åœºåœ°ç±»å‹é™åˆ¶æ£€æŸ¥** (AC: 1)
  - [x] åœ¨ `SpawnConstraintSystem` ä¸­å®ç° `CheckSceneTypeRestriction()`
  - [x] æ£€æŸ¥æ°´è·¯åƒµå°¸é™åˆ¶ï¼ˆæ½œæ°´ã€æµ·è±šã€é¸­å­æ•‘ç”Ÿåœˆï¼‰
  - [x] æ£€æŸ¥èˆç‹åƒµå°¸åœºæ™¯é™åˆ¶ï¼ˆå±‹é¡¶ç¦æ­¢ï¼‰
  - [x] æ£€æŸ¥ç‰¹æ®Šåœºæ™¯åƒµå°¸é™åˆ¶ï¼ˆåé™¢ç¬¬ 3ã€4 è¡Œæ°´è·¯ï¼‰

- [x] **Task 6: é›†æˆåˆ° WaveSpawnSystem** (AC: 1, 2, 3)
  - [x] åœ¨ `WaveSpawnSystem` ä¸­æ·»åŠ  `SpawnConstraintSystem` ä¾èµ–
  - [x] åœ¨ç”Ÿæˆåƒµå°¸å‰è°ƒç”¨ `ValidateZombieSpawn()` éªŒè¯
  - [x] è®°å½•è¢«é™åˆ¶çš„åƒµå°¸ç”Ÿæˆæ—¥å¿—ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
  - [x] å¤„ç†éªŒè¯å¤±è´¥æƒ…å†µï¼ˆè·³è¿‡æˆ–è­¦å‘Šï¼‰

- [x] **Task 7: æ·»åŠ å•å…ƒæµ‹è¯•** (AC: 5)
  - [x] åˆ›å»º `pkg/systems/spawn_constraint_system_test.go`
  - [x] æµ‹è¯•é˜¶æ•°é™åˆ¶éªŒè¯ï¼ˆä¸€/äºŒ/ä¸‰/å››é˜¶åƒµå°¸æ³¢æ¬¡æ£€æŸ¥ï¼‰
  - [x] æµ‹è¯•çº¢çœ¼æ•°é‡ä¸Šé™è®¡ç®—å’Œæ£€æŸ¥
  - [x] æµ‹è¯•åœºåœ°ç±»å‹é™åˆ¶ï¼ˆæ°´è·¯ã€èˆç‹ç­‰ï¼‰
  - [x] æµ‹è¯•é…ç½®åŠ è½½å’ŒéªŒè¯
  - [x] æµ‹è¯•è¾¹ç•Œæ¡ä»¶ï¼ˆè´Ÿæ•°è½®æ•°ã€æ— æ•ˆåƒµå°¸ç±»å‹ç­‰ï¼‰
  - [x] ç›®æ ‡è¦†ç›–ç‡ â‰¥ 80%

- [x] **Task 8: æ›´æ–°æ–‡æ¡£** (AC: 1, 2, 3, 4)
  - [x] åœ¨ CLAUDE.md æˆ–ç›¸å…³æ–‡æ¡£ä¸­è®°å½•ç”Ÿæˆé™åˆ¶è§„åˆ™
  - [x] æä¾›é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜å’Œç¤ºä¾‹
  - [x] è®°å½•å¦‚ä½•ä¸ºæ–°å…³å¡è¦†ç›–é»˜è®¤è§„åˆ™

## Dev Notes

### æ¶æ„ä¸Šä¸‹æ–‡

æœ¬æ•…äº‹æ˜¯ Epic 17ï¼ˆåƒµå°¸ç”Ÿæˆå¼•æ“ï¼‰çš„ç¬¬ä¸‰ä¸ªæ•…äº‹ï¼Œå®ç°åƒµå°¸ç”Ÿæˆå‰çš„é™åˆ¶æ£€æŸ¥ç³»ç»Ÿï¼Œç¡®ä¿åªæœ‰ç¬¦åˆæ¸¸æˆè§„åˆ™çš„åƒµå°¸ä¼šè¢«ç”Ÿæˆã€‚

**ä¾èµ–å…³ç³»**:
- ä¾èµ– Story 17.1 (éš¾åº¦å¼•æ“) - å·²å®Œæˆï¼Œæä¾›è½®æ•°è®¡ç®—
- ä¾èµ– Story 17.2 (å…³å¡è„šæœ¬æ ¼å¼) - å·²å®Œæˆï¼Œæä¾›å…³å¡é…ç½®
- è¢« Story 17.4-17.10 ä¾èµ–ï¼ˆè¡Œåˆ†é…å’Œæ³¢æ¬¡ç”Ÿæˆä¾èµ–é™åˆ¶æ£€æŸ¥ï¼‰

### å‰ä¸€ä¸ªæ•…äº‹çš„å…³é”®ç»éªŒ [Source: Story 17.2 Dev Agent Record]

1. **é…ç½®æ–‡ä»¶è®¾è®¡**ï¼šæ‰€æœ‰æ–°å­—æ®µéƒ½åº”æ˜¯å¯é€‰çš„ï¼Œæœ‰åˆç†çš„é»˜è®¤å€¼ï¼Œç¡®ä¿å‘åå…¼å®¹
2. **éªŒè¯é€»è¾‘å‹å¥½**ï¼šé”™è¯¯æç¤ºè¦æ¸…æ™°å…·ä½“ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜
3. **æµ‹è¯•å…¨é¢æ€§**ï¼šéœ€è¦è¦†ç›–æ–°æ ¼å¼ã€æ—§æ ¼å¼å…¼å®¹æ€§ã€éªŒè¯é€»è¾‘ã€é»˜è®¤å€¼æ¨æ–­ç­‰å¤šä¸ªç»´åº¦
4. **æ ¸å¿ƒå‡½æ•°è¦†ç›–ç‡ç›®æ ‡**ï¼š88-100%

### åƒµå°¸é˜¶æ•°å®šä¹‰ [Source: .meta/levels/ZombieGenerationModuleDesignDocument.md#2-åƒµå°¸ç”Ÿæˆé™åˆ¶æ£€æŸ¥]

æ ¹æ®åŸç‰ˆ PvZ é€†å‘å·¥ç¨‹æ•°æ®ï¼Œåƒµå°¸æŒ‰é˜¶æ•°åˆ†ç±»ï¼š

| é˜¶æ•° | åƒµå°¸ç±»å‹ | æœ€æ—©å‡ºç°æ³¢æ¬¡ | è½®æ•°è°ƒæ•´ |
|------|---------|-------------|---------|
| **ä¸€é˜¶** | æ™®åƒµã€è·¯éšœã€æ——å¸œ | ç¬¬ 1 æ³¢ | æ—  |
| **äºŒé˜¶** | é“æ¡¶ã€è¯»æŠ¥ã€é“æ …é—¨ | ç¬¬ 3 æ³¢ | æ—  |
| **ä¸‰é˜¶** | æ’‘æ†ã€æ©„æ¦„çƒã€èˆç‹ã€æ½œæ°´ã€æµ·è±šã€å°ä¸‘ã€æ°”çƒã€çŸ¿å·¥ã€è¹¦è¹¦ã€é›ªæ©‡è½¦ | ç¬¬ 8 æ³¢ | æ—  |
| **å››é˜¶** | ç™½çœ¼å·¨äººã€çº¢çœ¼å·¨äºº | ç¬¬ 15 æ³¢ | æ ¹æ®è½®æ•°æå‰ |

**é˜¶æ•°é™åˆ¶å…¬å¼** [Source: .meta/levels/ZombieGenerationModuleDesignDocument.md]:
- å››é˜¶åƒµå°¸ï¼š`MinWave = max(15 - RoundNumber, 1)`
- å…¶ä»–é˜¶æ•°ï¼šå›ºå®šæ³¢æ¬¡é™åˆ¶

### çº¢çœ¼æ•°é‡ä¸Šé™è®¡ç®— [Source: .meta/levels/ZombieGenerationModuleDesignDocument.md#2-çº¢çœ¼ä¸Šé™]

**çº¢çœ¼æ•°é‡ä¸Šé™å…¬å¼**:
```
RedEyeCapacity = 0  (if RoundNumber < 5)
RedEyeCapacity = RoundNumber - 4  (if RoundNumber >= 5)
```

**å®ç°è¦ç‚¹**:
- åˆå§‹è½®æ•°ï¼ˆRoundNumber < 5ï¼‰æ—¶ï¼Œçº¢çœ¼æ•°é‡ä¸Šé™ä¸º 0
- ä»è½®æ•° 5 å¼€å§‹ï¼Œæ¯è½®å¢åŠ  1 ä¸ªçº¢çœ¼ä¸Šé™
- ç”Ÿæˆçº¢çœ¼å‰ï¼Œæ£€æŸ¥ `RedEyeCount < RedEyeCapacity`

### åœºåœ°ç±»å‹é™åˆ¶è§„åˆ™ [Source: .meta/levels/ZombieGenerationModuleDesignDocument.md#2-åˆæ³•è¡Œåˆ¤å®š]

| åœºæ™¯ç±»å‹ | ç‰¹æ®Šé™åˆ¶ | å—é™åƒµå°¸ |
|---------|---------|---------|
| **æ³³æ± /é›¾å¤œ** | ç¬¬ 3ã€4 è¡Œä¸ºæ°´è·¯ | åªå…è®¸æ½œæ°´ã€æµ·è±šã€é¸­å­æ•‘ç”Ÿåœˆï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰|
| **æ³³æ± /é›¾å¤œ** | éæ°´è·¯è¡Œ | ç¦æ­¢æ½œæ°´ã€æµ·è±š |
| **å±‹é¡¶** | å…¨åœºæ™¯ | ç¦æ­¢èˆç‹ |
| **å‰é™¢/é»‘å¤œ** | èˆç‹å‡ºç°æ—¶ | ä¸Šä¸‹ç›¸é‚»è¡Œå¿…é¡»æ˜¯è‰åœ° |

### ç°æœ‰ç³»ç»Ÿé›†æˆç‚¹ [Source: pkg/systems/difficulty_engine.go, pkg/systems/wave_spawn_system.go]

**DifficultyEngine å·²å®ç°**:
- `CalculateRoundNumber(totalCompletedFlags)` - è½®æ•°è®¡ç®—
- `GetZombieLevel(zombieType)` - è·å–åƒµå°¸çº§åˆ«

**WaveSpawnSystem é›†æˆä½ç½®**:
- `PreSpawnAllWaves()` - é¢„ç”Ÿæˆæ‰€æœ‰æ³¢æ¬¡åƒµå°¸æ—¶è°ƒç”¨é™åˆ¶æ£€æŸ¥
- `ActivateWave()` - æ¿€æ´»æ³¢æ¬¡å‰å†æ¬¡éªŒè¯

**é›†æˆæ–¹å¼** [Source: docs/architecture/coding-standards.md#é›¶è€¦åˆåŸåˆ™]:
- âš ï¸ **ç¦æ­¢ç³»ç»Ÿç›´æ¥è°ƒç”¨**ï¼šç³»ç»Ÿé—´ä¸¥ç¦ç›´æ¥è°ƒç”¨
- âœ… **æ¨èæ–¹å¼**ï¼šé€šè¿‡ EntityManager æŸ¥è¯¢ç»„ä»¶ï¼Œæˆ–ä½¿ç”¨å‘½ä»¤ç»„ä»¶æ¨¡å¼

### é…ç½®æ–‡ä»¶ç»“æ„è®¾è®¡

**`data/spawn_rules.yaml`**:
```yaml
# åƒµå°¸ç”Ÿæˆè§„åˆ™é…ç½®

# åƒµå°¸é˜¶æ•°æ˜ å°„è¡¨
zombieTiers:
  basic: 1        # æ™®åƒµ - ä¸€é˜¶
  conehead: 1     # è·¯éšœ - ä¸€é˜¶
  buckethead: 2   # é“æ¡¶ - äºŒé˜¶
  newspaper: 2    # è¯»æŠ¥ - äºŒé˜¶
  screendoor: 2   # é“æ …é—¨ - äºŒé˜¶
  polevaulter: 3  # æ’‘æ† - ä¸‰é˜¶
  football: 3     # æ©„æ¦„çƒ - ä¸‰é˜¶
  dancing: 3      # èˆç‹ - ä¸‰é˜¶
  dolphinrider: 3 # æµ·è±š - ä¸‰é˜¶
  snorkel: 3      # æ½œæ°´ - ä¸‰é˜¶
  gargantuar: 4   # ç™½çœ¼å·¨äºº - å››é˜¶
  gargantuar_redeye: 4 # çº¢çœ¼å·¨äºº - å››é˜¶

# é˜¶æ•°æ³¢æ¬¡é™åˆ¶
tierWaveRestrictions:
  1: 1   # ä¸€é˜¶ï¼šç¬¬ 1 æ³¢èµ·
  2: 3   # äºŒé˜¶ï¼šç¬¬ 3 æ³¢èµ·
  3: 8   # ä¸‰é˜¶ï¼šç¬¬ 8 æ³¢èµ·
  4: 15  # å››é˜¶ï¼šç¬¬ 15 æ³¢èµ·ï¼ˆä¼šæ ¹æ®è½®æ•°è°ƒæ•´ï¼‰

# çº¢çœ¼æ•°é‡ä¸Šé™é…ç½®
redEyeRules:
  startRound: 5        # ä»ç¬¬ 5 è½®å¼€å§‹å…è®¸çº¢çœ¼
  capacityPerRound: 1  # æ¯è½®å¢åŠ  1 ä¸ªçº¢çœ¼ä¸Šé™

# åœºæ™¯ç±»å‹é™åˆ¶
sceneTypeRestrictions:
  waterZombies:        # æ°´è·¯ä¸“å±åƒµå°¸
    - snorkel          # æ½œæ°´
    - dolphinrider     # æµ·è±š
    - ducky            # é¸­å­æ•‘ç”Ÿåœˆï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰

  dancingRestrictions: # èˆç‹é™åˆ¶
    prohibitedScenes:
      - roof           # å±‹é¡¶ç¦æ­¢èˆç‹
```

### æ•°æ®æ¨¡å‹è®¾è®¡

**SpawnRulesConfig** (`pkg/config/spawn_rules.go`):
```go
type SpawnRulesConfig struct {
    ZombieTiers           map[string]int      // åƒµå°¸ç±»å‹ -> é˜¶æ•°
    TierWaveRestrictions  map[int]int         // é˜¶æ•° -> æœ€æ—©æ³¢æ¬¡
    RedEyeRules           RedEyeRulesConfig   // çº¢çœ¼è§„åˆ™
    SceneTypeRestrictions SceneRestrictions   // åœºæ™¯é™åˆ¶
}

type RedEyeRulesConfig struct {
    StartRound        int  // å¼€å§‹å…è®¸çº¢çœ¼çš„è½®æ•°
    CapacityPerRound  int  // æ¯è½®å¢åŠ çš„çº¢çœ¼ä¸Šé™
}

type SceneRestrictions struct {
    WaterZombies           []string  // æ°´è·¯ä¸“å±åƒµå°¸åˆ—è¡¨
    DancingProhibitedScenes []string // èˆç‹ç¦æ­¢çš„åœºæ™¯åˆ—è¡¨
}
```

**SpawnConstraintComponent** (`pkg/components/spawn_constraint.go`):
```go
type SpawnConstraintComponent struct {
    RedEyeCount         int      // å·²ç”Ÿæˆçš„çº¢çœ¼æ•°é‡
    CurrentWaveNum      int      // å½“å‰æ³¢æ¬¡ç¼–å·ï¼ˆä» 1 å¼€å§‹ï¼‰
    AllowedZombieTypes  []string // å½“å‰å…³å¡å…è®¸çš„åƒµå°¸ç±»å‹åˆ—è¡¨
    SceneType           string   // åœºæ™¯ç±»å‹ï¼ˆday/night/pool/fog/roofï¼‰
}
```

### SpawnConstraintSystem æ ¸å¿ƒæ–¹æ³•

**ç³»ç»Ÿæ¥å£è®¾è®¡** (`pkg/systems/spawn_constraint_system.go`):
```go
type SpawnConstraintSystem struct {
    entityManager *ecs.EntityManager
    spawnRules    *config.SpawnRulesConfig
    difficultyEngine *DifficultyEngine  // ç”¨äºè·å–è½®æ•°
}

// CheckZombieTypeAllowed æ£€æŸ¥åƒµå°¸ç±»å‹æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
func (s *SpawnConstraintSystem) CheckZombieTypeAllowed(
    zombieType string,
    allowedTypes []string,
) bool

// CheckTierRestriction æ£€æŸ¥åƒµå°¸é˜¶æ•°æ˜¯å¦ç¬¦åˆæ³¢æ¬¡é™åˆ¶
func (s *SpawnConstraintSystem) CheckTierRestriction(
    zombieType string,
    currentWave int,
    roundNumber int,
) bool

// CheckRedEyeLimit æ£€æŸ¥çº¢çœ¼æ•°é‡æ˜¯å¦è¶…é™
func (s *SpawnConstraintSystem) CheckRedEyeLimit(
    zombieType string,
    redEyeCount int,
    roundNumber int,
) bool

// CheckSceneTypeRestriction æ£€æŸ¥åœºæ™¯ç±»å‹é™åˆ¶
func (s *SpawnConstraintSystem) CheckSceneTypeRestriction(
    zombieType string,
    sceneType string,
    lane int,
) bool

// ValidateZombieSpawn ç»¼åˆéªŒè¯åƒµå°¸æ˜¯å¦å¯ç”Ÿæˆ
func (s *SpawnConstraintSystem) ValidateZombieSpawn(
    zombieType string,
    constraintEntity ecs.EntityID,
) (bool, string)  // è¿”å›æ˜¯å¦é€šè¿‡å’Œå¤±è´¥åŸå› 
```

### æ–‡ä»¶ä½ç½®å‚è€ƒ [Source: docs/architecture/unified-project-structure.md]

```
pkg/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ spawn_rules.go          # æ–°å¢ï¼šç”Ÿæˆè§„åˆ™é…ç½®åŠ è½½
â”‚   â””â”€â”€ spawn_rules_test.go     # æ–°å¢ï¼šé…ç½®åŠ è½½æµ‹è¯•
â”œâ”€â”€ components/
â”‚   â””â”€â”€ spawn_constraint.go     # æ–°å¢ï¼šç”Ÿæˆé™åˆ¶ç»„ä»¶
â”œâ”€â”€ systems/
â”‚   â”œâ”€â”€ spawn_constraint_system.go      # æ–°å¢ï¼šé™åˆ¶æ£€æŸ¥ç³»ç»Ÿ
â”‚   â”œâ”€â”€ spawn_constraint_system_test.go # æ–°å¢ï¼šç³»ç»Ÿæµ‹è¯•
â”‚   â””â”€â”€ wave_spawn_system.go            # ä¿®æ”¹ï¼šé›†æˆé™åˆ¶æ£€æŸ¥

data/
â””â”€â”€ spawn_rules.yaml            # æ–°å¢ï¼šç”Ÿæˆè§„åˆ™é…ç½®æ–‡ä»¶
```

### ECS æ¶æ„çº¦æŸ [Source: docs/architecture/coding-standards.md]

**é›¶è€¦åˆåŸåˆ™**ï¼š
- âœ… **ç»„ä»¶**: ä»…å­˜å‚¨æ•°æ®ï¼Œä¸åŒ…å«ä»»ä½•æ–¹æ³•
- âœ… **ç³»ç»Ÿ**: ä»…åŒ…å«é€»è¾‘ï¼Œé€šè¿‡ EntityManager æŸ¥è¯¢ç»„ä»¶
- âŒ **ç¦æ­¢**: ç³»ç»Ÿä¹‹é—´ç›´æ¥è°ƒç”¨ï¼ˆå‚è€ƒ Epic 14 è§£è€¦ç»éªŒï¼‰

**é›†æˆæ–¹æ¡ˆ**ï¼š
```go
// âŒ é”™è¯¯æ–¹å¼ï¼šç›´æ¥è°ƒç”¨ç³»ç»Ÿ
valid := spawnConstraintSystem.ValidateZombieSpawn(...)

// âœ… æ­£ç¡®æ–¹å¼ï¼šé€šè¿‡ç»„ä»¶é€šä¿¡
// 1. WaveSpawnSystem æŸ¥è¯¢ SpawnConstraintComponent
constraint, ok := ecs.GetComponent[*components.SpawnConstraintComponent](em, entity)

// 2. è°ƒç”¨ç‹¬ç«‹éªŒè¯å‡½æ•°ï¼ˆéç³»ç»Ÿæ–¹æ³•ï¼‰
valid := ValidateZombieSpawn(zombieType, constraint, spawnRules, roundNumber)
```

**å»ºè®®å®ç°**ï¼š
- å°†éªŒè¯é€»è¾‘å®ç°ä¸º **ç‹¬ç«‹çº¯å‡½æ•°**ï¼ˆä¸ä¾èµ–ç³»ç»Ÿå®ä¾‹ï¼‰
- æˆ–è€…ä½¿ç”¨ **éªŒè¯ç»„ä»¶ + éªŒè¯ç³»ç»Ÿ** çš„æ¨¡å¼

### é”™è¯¯å¤„ç†è§„èŒƒ [Source: docs/architecture/coding-standards.md]

- æ‰€æœ‰å¯èƒ½è¿”å› `error` çš„å‡½æ•°éƒ½å¿…é¡»æ£€æŸ¥é”™è¯¯
- ä½¿ç”¨ `fmt.Errorf` æˆ– `%w` åŒ…è£…é”™è¯¯æä¾›ä¸Šä¸‹æ–‡
- éªŒè¯å¤±è´¥æ—¶è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯

**ç¤ºä¾‹**:
```go
if zombieType == "" {
    return false, fmt.Errorf("zombie type cannot be empty")
}

tier, ok := s.spawnRules.ZombieTiers[zombieType]
if !ok {
    return false, fmt.Errorf("unknown zombie type: %s", zombieType)
}

minWave, ok := s.spawnRules.TierWaveRestrictions[tier]
if !ok {
    return false, fmt.Errorf("no wave restriction defined for tier %d", tier)
}

if currentWave < minWave {
    return false, fmt.Errorf(
        "zombie %s (tier %d) cannot spawn before wave %d (current: %d)",
        zombieType, tier, minWave, currentWave,
    )
}
```

## Testing

### æµ‹è¯•æ–‡ä»¶ä½ç½®
- `pkg/config/spawn_rules_test.go` - é…ç½®åŠ è½½æµ‹è¯•
- `pkg/systems/spawn_constraint_system_test.go` - é™åˆ¶æ£€æŸ¥ç³»ç»Ÿæµ‹è¯•

### æµ‹è¯•ç­–ç•¥ [Source: docs/architecture/testing-strategy.md]
- ä½¿ç”¨ Go æ ‡å‡†åº“ `testing` åŒ…
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ â‰¥ 80%
- æµ‹è¯•æ–‡ä»¶ä¸æºæ–‡ä»¶åŒåŒ…ï¼Œä»¥ `_test.go` ç»“å°¾

### å…³é”®æµ‹è¯•åœºæ™¯

**1. é˜¶æ•°é™åˆ¶æµ‹è¯•**:
```go
func TestCheckTierRestriction(t *testing.T) {
    // æµ‹è¯•ä¸€é˜¶åƒµå°¸ç¬¬1æ³¢å¯ç”Ÿæˆ
    // æµ‹è¯•äºŒé˜¶åƒµå°¸ç¬¬3æ³¢å‰ä¸å¯ç”Ÿæˆ
    // æµ‹è¯•å››é˜¶åƒµå°¸æ ¹æ®è½®æ•°è°ƒæ•´æœ€æ—©æ³¢æ¬¡
}
```

**2. çº¢çœ¼æ•°é‡ä¸Šé™æµ‹è¯•**:
```go
func TestCheckRedEyeLimit(t *testing.T) {
    // æµ‹è¯•è½®æ•° < 5 æ—¶çº¢çœ¼ä¸Šé™ä¸º 0
    // æµ‹è¯•è½®æ•° 5 æ—¶çº¢çœ¼ä¸Šé™ä¸º 1
    // æµ‹è¯•çº¢çœ¼æ•°é‡è¾¾åˆ°ä¸Šé™åæ‹’ç»ç”Ÿæˆ
}
```

**3. åœºæ™¯ç±»å‹é™åˆ¶æµ‹è¯•**:
```go
func TestCheckSceneTypeRestriction(t *testing.T) {
    // æµ‹è¯•æ°´è·¯åƒµå°¸åªèƒ½åœ¨æ°´è·¯è¡Œç”Ÿæˆ
    // æµ‹è¯•éæ°´è·¯è¡Œæ‹’ç»æ½œæ°´/æµ·è±š
    // æµ‹è¯•å±‹é¡¶åœºæ™¯æ‹’ç»èˆç‹
}
```

**4. é…ç½®åŠ è½½æµ‹è¯•**:
```go
func TestLoadSpawnRules(t *testing.T) {
    // æµ‹è¯•ä» YAML æ­£ç¡®åŠ è½½é…ç½®
    // æµ‹è¯•æ— æ•ˆé…ç½®æŠ¥é”™
    // æµ‹è¯•é»˜è®¤å€¼å¤„ç†
}
```

**5. ç»¼åˆéªŒè¯æµ‹è¯•**:
```go
func TestValidateZombieSpawn(t *testing.T) {
    // æµ‹è¯•å¤šä¸ªé™åˆ¶æ¡ä»¶åŒæ—¶æ£€æŸ¥
    // æµ‹è¯•éªŒè¯å¤±è´¥è¿”å›æ­£ç¡®çš„é”™è¯¯åŸå› 
}
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-27 | 0.1 | Initial draft creation | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

æ— éœ€è°ƒè¯•æ—¥å¿—

### Completion Notes

**å®ç°å®Œæˆæ—¥æœŸ**: 2025-11-27

**å®ç°äº®ç‚¹**:
1. âœ… **ECS é›¶è€¦åˆè®¾è®¡**: æ‰€æœ‰éªŒè¯é€»è¾‘å®ç°ä¸ºç‹¬ç«‹çº¯å‡½æ•°ï¼Œå®Œå…¨ç¬¦åˆ ECS æ¶æ„åŸåˆ™
2. âœ… **é…ç½®é©±åŠ¨**: æ‰€æœ‰é™åˆ¶è§„åˆ™å­˜å‚¨åœ¨ `data/spawn_rules.yaml`ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
3. âœ… **é«˜æµ‹è¯•è¦†ç›–ç‡**: æ ¸å¿ƒå‡½æ•°è¦†ç›–ç‡è¾¾åˆ° 92.9%-100%ï¼Œè¿œè¶… AC è¦æ±‚çš„ 80%
4. âœ… **å‘åå…¼å®¹**: spawn_rules ä¸ºå¯é€‰å‚æ•°ï¼ˆnil = ç¦ç”¨é™åˆ¶æ£€æŸ¥ï¼‰ï¼Œä¸å½±å“ç°æœ‰ä»£ç 
5. âœ… **å®Œæ•´æ–‡æ¡£**: åœ¨ CLAUDE.md ä¸­æ·»åŠ è¯¦ç»†çš„è§„åˆ™è¯´æ˜å’Œä»£ç é›†æˆç¤ºä¾‹

**æŠ€æœ¯å†³ç­–**:
- ä½¿ç”¨çº¯å‡½æ•°è€Œéç³»ç»Ÿæ–¹æ³•å®ç°éªŒè¯é€»è¾‘ï¼Œé¿å…ç³»ç»Ÿé—´è€¦åˆï¼ˆå‚è€ƒ Epic 14 ç»éªŒï¼‰
- è½®æ•°è®¡ç®—ç›´æ¥ä½¿ç”¨ `GameState.TotalCompletedFlags` è€Œéä¾èµ– DifficultyEngine ç³»ç»Ÿ
- é™åˆ¶æ£€æŸ¥é›†æˆåœ¨ `spawnZombieForWave()` æ–¹æ³•ä¸­ï¼Œé¢„ç”Ÿæˆé˜¶æ®µå³å¯æ‹’ç»ä¸åˆè§„åƒµå°¸
- ä½¿ç”¨ç»„ä»¶æ¨¡å¼å­˜å‚¨å…³å¡çº§åˆ«çš„é™åˆ¶çŠ¶æ€ï¼ˆSpawnConstraintComponentï¼‰

**æµ‹è¯•éªŒè¯**:
```bash
# é…ç½®åŠ è½½æµ‹è¯•
go test ./pkg/config -run TestLoadSpawnRules -v
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ7ä¸ªç”¨ä¾‹ï¼‰

# é™åˆ¶æ£€æŸ¥æµ‹è¯•
go test ./pkg/systems -run "TestCheck|TestValidate" -v
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ37ä¸ªç”¨ä¾‹ï¼‰

# è¦†ç›–ç‡æ£€æŸ¥
go test ./pkg/systems -run "TestCheck|TestValidate" -coverprofile=/tmp/spawn.out
âœ… CheckZombieTypeAllowed: 100.0%
âœ… CheckTierRestriction: 92.9%
âœ… CheckRedEyeLimit: 100.0%
âœ… CalculateRedEyeCapacity: 100.0%
âœ… CheckSceneTypeRestriction: 100.0%
âœ… ValidateZombieSpawn: 100.0%
```

**é›†æˆç‚¹**:
- `WaveSpawnSystem.NewWaveSpawnSystem()`: æ¥å—å¯é€‰çš„ SpawnRulesConfig å‚æ•°
- `WaveSpawnSystem.spawnZombieForWave()`: åœ¨ç”Ÿæˆåƒµå°¸å‰è¿›è¡Œé™åˆ¶æ£€æŸ¥
- `GameScene.Init()`: åŠ è½½ spawn_rules.yaml å¹¶ä¼ é€’ç»™ WaveSpawnSystem

### File List

**æ–°å¢æ–‡ä»¶**:
- `data/spawn_rules.yaml` - åƒµå°¸ç”Ÿæˆè§„åˆ™é…ç½®æ–‡ä»¶
- `pkg/config/spawn_rules.go` - ç”Ÿæˆè§„åˆ™é…ç½®åŠ è½½å™¨
- `pkg/config/spawn_rules_test.go` - é…ç½®åŠ è½½å™¨å•å…ƒæµ‹è¯•
- `pkg/components/spawn_constraint.go` - ç”Ÿæˆé™åˆ¶æ£€æŸ¥ç»„ä»¶
- `pkg/systems/spawn_constraint_system.go` - ç”Ÿæˆé™åˆ¶æ£€æŸ¥ç³»ç»Ÿï¼ˆçº¯å‡½æ•°ï¼‰
- `pkg/systems/spawn_constraint_system_test.go` - é™åˆ¶æ£€æŸ¥ç³»ç»Ÿå•å…ƒæµ‹è¯•

**ä¿®æ”¹æ–‡ä»¶**:
- `pkg/systems/wave_spawn_system.go` - é›†æˆé™åˆ¶æ£€æŸ¥åˆ°åƒµå°¸ç”Ÿæˆæµç¨‹
- `pkg/scenes/game_scene.go` - åŠ è½½ spawn_rules å¹¶ä¼ é€’ç»™ WaveSpawnSystem
- `CLAUDE.md` - æ·»åŠ "åƒµå°¸ç”Ÿæˆè§„åˆ™"ç« èŠ‚

### Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-27 | 0.1 | Initial draft creation | Bob (Scrum Master) |
| 2025-11-27 | 1.0 | Implementation completed | James (Developer) |

---

## QA Results

### Review Date: 2025-11-27

### Reviewed By: Quinn (Test Architect)

### è´¨é‡è¯„å®¡æ€»ç»“

æœ¬æ•…äº‹å®ç°äº†ä¸€ä¸ªå¥å£®çš„åƒµå°¸ç”Ÿæˆé™åˆ¶æ£€æŸ¥ç³»ç»Ÿï¼Œä»£ç è´¨é‡ä¼˜ç§€ï¼Œå®Œç¾éµå¾ªECSæ¶æ„åŸåˆ™ã€‚æ‰€æœ‰5ä¸ªéªŒæ”¶æ ‡å‡†å‡å·²æ»¡è¶³ï¼Œæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°92.9%-100%ï¼Œè¿œè¶…è¦æ±‚çš„80%ã€‚

**è´¨é‡è¯„åˆ†**: 95/100 (PASS)

### Code Quality Assessment

**æ¶æ„è®¾è®¡** âœ… ä¼˜ç§€
- å®Œç¾éµå¾ªECSé›¶è€¦åˆåŸåˆ™ï¼Œæ‰€æœ‰éªŒè¯é€»è¾‘å®ç°ä¸ºç‹¬ç«‹çº¯å‡½æ•°
- å€Ÿé‰´äº†Epic 14çš„è§£è€¦ç»éªŒï¼Œé¿å…ç³»ç»Ÿé—´ç›´æ¥è°ƒç”¨
- çº¯å‡½æ•°è®¾è®¡(æ— å‰¯ä½œç”¨)ä½¿ä»£ç æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

**ä»£ç å®ç°** âœ… ä¼˜ç§€
- é”™è¯¯å¤„ç†å®Œå–„ï¼Œæ‰€æœ‰é”™è¯¯éƒ½ç”¨fmt.ErrorfåŒ…è£…å¹¶æä¾›ä¸Šä¸‹æ–‡
- é…ç½®éªŒè¯ä¸¥æ ¼ï¼Œè¦†ç›–æ‰€æœ‰è¾¹ç•Œæ¡ä»¶
- å‘½åè§„èŒƒä¸€è‡´ï¼Œæ³¨é‡Šæ¸…æ™°å®Œæ•´
- å‘åå…¼å®¹æ€§è‰¯å¥½(spawnRuleså¯é€‰ï¼Œnil=ç¦ç”¨æ£€æŸ¥)

**æµ‹è¯•è´¨é‡** âœ… ä¼˜ç§€
- æµ‹è¯•è¦†ç›–ç‡: CheckZombieTypeAllowed(100%), CheckTierRestriction(92.9%), CheckRedEyeLimit(100%), CalculateRedEyeCapacity(100%), CheckSceneTypeRestriction(100%), ValidateZombieSpawn(100%)
- æµ‹è¯•ç”¨ä¾‹å…¨é¢: 46ä¸ªæµ‹è¯•è¦†ç›–æ­£å¸¸æµç¨‹ã€è¾¹ç•Œæ¡ä»¶ã€é”™è¯¯åœºæ™¯
- æµ‹è¯•ä»£ç ä¸ç”Ÿäº§ä»£ç æ¯”ä¾‹: 2.13:1

**é›†æˆå®ç°** âœ… è‰¯å¥½
- å·²æˆåŠŸé›†æˆåˆ°WaveSpawnSystem.spawnZombieForWave()
- GameScene.Init()ä¸­åŠ è½½é…ç½®ï¼Œå¤±è´¥æ—¶ä¼˜é›…é™çº§
- é€šè¿‡ç»„ä»¶æ¨¡å¼(SpawnConstraintComponent)ç»´æŠ¤çŠ¶æ€

### Refactoring Performed

**æ— éœ€é‡æ„** - ä»£ç è´¨é‡å·²ç»å¾ˆé«˜ï¼Œæœªå‘ç°éœ€è¦ç«‹å³æ”¹è¿›çš„æ¶æ„æˆ–è®¾è®¡é—®é¢˜ã€‚

### Compliance Check

- âœ… **Coding Standards**: å®Œå…¨éµå¾ªGoå‘½åçº¦å®šå’ŒECSç¼–ç è§„èŒƒ
- âœ… **Project Structure**: æ–‡ä»¶ç»„ç»‡ç¬¦åˆunified-project-structure.md
- âœ… **Testing Strategy**: æµ‹è¯•ç­–ç•¥ç¬¦åˆtesting-strategy.mdè¦æ±‚
- âœ… **All ACs Met**: æ‰€æœ‰5ä¸ªéªŒæ”¶æ ‡å‡†éƒ½å·²å®ç°å¹¶æµ‹è¯•

### Requirements Traceability (éœ€æ±‚è¿½æº¯)

**AC1: å‡ºæ€ªç±»å‹æ£€æŸ¥** âœ… PASS
- Given: åƒµå°¸ç±»å‹å’Œå…³å¡å…è®¸åˆ—è¡¨
- When: è°ƒç”¨CheckZombieTypeAllowed()æ£€æŸ¥
- Then: è¿”å›åƒµå°¸æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
- å®ç°: spawn_constraint_system.go:26-38, CheckSceneTypeRestriction:137-212
- æµ‹è¯•: TestCheckZombieTypeAllowed(4ç”¨ä¾‹), TestCheckSceneTypeRestriction(7ç”¨ä¾‹)
- è¦†ç›–ç‡: 100%

**AC2: é˜¶æ•°é™åˆ¶** âœ… PASS
- Given: åƒµå°¸é˜¶æ•°ã€å½“å‰æ³¢æ¬¡ã€è½®æ•°
- When: è°ƒç”¨CheckTierRestriction()æ£€æŸ¥
- Then: æ ¹æ®é˜¶æ•°å’Œè½®æ•°åˆ¤æ–­æ˜¯å¦å…è®¸ç”Ÿæˆ(å››é˜¶è°ƒæ•´å…¬å¼: MinWave = max(15-RoundNumber, 1))
- å®ç°: spawn_constraint_system.go:47-84
- æµ‹è¯•: TestCheckTierRestriction(9ç”¨ä¾‹ï¼ŒåŒ…å«å››é˜¶è½®æ•°è°ƒæ•´æµ‹è¯•)
- è¦†ç›–ç‡: 92.9%

**AC3: çº¢çœ¼æ•°é‡ä¸Šé™** âœ… PASS
- Given: å½“å‰è½®æ•°ã€å·²ç”Ÿæˆçº¢çœ¼æ•°é‡
- When: è°ƒç”¨CheckRedEyeLimit()æ£€æŸ¥çº¢çœ¼ç”Ÿæˆ
- Then: æ ¹æ®å…¬å¼(RoundNumber < 5 ? 0 : RoundNumber - 4)åˆ¤æ–­æ˜¯å¦è¶…é™
- å®ç°: spawn_constraint_system.go:93-128
- æµ‹è¯•: TestCalculateRedEyeCapacity(5ç”¨ä¾‹), TestCheckRedEyeLimit(5ç”¨ä¾‹)
- è¦†ç›–ç‡: 100%

**AC4: é…ç½®é©±åŠ¨** âœ… PASS
- Given: spawn_rules.yamlé…ç½®æ–‡ä»¶
- When: è°ƒç”¨LoadSpawnRules()åŠ è½½
- Then: è§£æå¹¶éªŒè¯é…ç½®ï¼Œè¿”å›SpawnRulesConfigç»“æ„
- å®ç°: config/spawn_rules.go:38-97, data/spawn_rules.yaml
- æµ‹è¯•: TestLoadSpawnRules(7ç”¨ä¾‹), TestLoadSpawnRules_FileNotFound, TestLoadSpawnRules_InvalidYAML
- è¦†ç›–ç‡: 100%

**AC5: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%** âœ… PASS
- å®é™…è¦†ç›–ç‡: 92.9%-100% (è¿œè¶…è¦æ±‚)
- æµ‹è¯•æ–‡ä»¶: spawn_constraint_system_test.go(514è¡Œ), spawn_rules_test.go(281è¡Œ)
- æ€»æµ‹è¯•ç”¨ä¾‹: 46ä¸ª

### Improvements Checklist

ä¼˜åŒ–å»ºè®®(éé˜»å¡ï¼Œå¯åœ¨æœªæ¥ç‰ˆæœ¬ä¸­è€ƒè™‘):

- [ ] è€ƒè™‘ä½¿ç”¨strings.Contains()æ›¿æ¢æµ‹è¯•è¾…åŠ©å‡½æ•°contains()å’ŒfindSubstring() (pkg/config/spawn_rules_test.go:268-280)
- [ ] è€ƒè™‘ä¸ºSpawnConstraintSystemæ·»åŠ Update()æ–¹æ³•ä»¥ç¬¦åˆç³»ç»Ÿæ¥å£è§„èŒƒ(å½“å‰çº¯å‡½æ•°æ¨¡å¼ä¹Ÿå®Œå…¨å¯æ¥å—)

æ‰€æœ‰å…³é”®åŠŸèƒ½éƒ½å·²å®ç°ä¸”æµ‹è¯•é€šè¿‡ï¼Œä¸Šè¿°æ”¹è¿›ç‚¹ä»…ä¸ºä»£ç ä¼˜åŒ–å»ºè®®ã€‚

### Security Review

âœ… **PASS** - æ— å®‰å…¨é£é™©
- é…ç½®åŠ è½½æ—¶è¿›è¡Œäº†ä¸¥æ ¼éªŒè¯(é˜¶æ•°èŒƒå›´1-4ã€æ³¢æ¬¡â‰¥1ã€çº¢çœ¼è§„åˆ™â‰¥0ç­‰)
- æ‰€æœ‰é”™è¯¯éƒ½æœ‰é€‚å½“çš„å¤„ç†å’Œæ—¥å¿—è®°å½•
- æ²¡æœ‰ä½¿ç”¨ä¸å®‰å…¨çš„åå°„æˆ–ç±»å‹æ–­è¨€
- é…ç½®æ–‡ä»¶è·¯å¾„å›ºå®š("data/spawn_rules.yaml")ï¼Œä¸æ¥å—ç”¨æˆ·è¾“å…¥

### Performance Considerations

âœ… **PASS** - æ€§èƒ½ä¼˜ç§€
- æ‰€æœ‰éªŒè¯å‡½æ•°æ—¶é—´å¤æ‚åº¦ä¸ºO(1)æˆ–O(n)ï¼Œnä¸ºå°å¸¸é‡(å¦‚æ°´è·¯åƒµå°¸åˆ—è¡¨é•¿åº¦<10)
- çº¯å‡½æ•°è®¾è®¡ï¼Œæ— çŠ¶æ€å…±äº«ï¼Œæ— é”ç«äº‰
- é…ç½®åŠ è½½ä»…åœ¨æ¸¸æˆå¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡
- é™åˆ¶æ£€æŸ¥åœ¨åƒµå°¸é¢„ç”Ÿæˆé˜¶æ®µæ‰§è¡Œï¼Œä¸å½±å“å®æ—¶æ¸¸æˆæ€§èƒ½

### Non-Functional Requirements (NFRs)

**å¯ç»´æŠ¤æ€§** âœ… PASS
- ä»£ç ç»“æ„æ¸…æ™°ï¼Œå‡½æ•°èŒè´£å•ä¸€
- æ³¨é‡Šå®Œå–„ï¼Œæ‰€æœ‰å…¬å…±å‡½æ•°éƒ½æœ‰GoDocæ³¨é‡Š
- é…ç½®å¤–éƒ¨åŒ–ï¼Œä¿®æ”¹è§„åˆ™æ— éœ€é‡æ–°ç¼–è¯‘
- çº¯å‡½æ•°è®¾è®¡ä½¿å•å…ƒæµ‹è¯•éå¸¸å®¹æ˜“

**å¯é æ€§** âœ… PASS
- é”™è¯¯å¤„ç†å®Œå–„ï¼Œæ‰€æœ‰è¾¹ç•Œæ¡ä»¶éƒ½æœ‰æµ‹è¯•è¦†ç›–
- é…ç½®åŠ è½½å¤±è´¥æ—¶ä¼˜é›…é™çº§(ç¦ç”¨é™åˆ¶æ£€æŸ¥ï¼Œä¸å½±å“æ¸¸æˆè¿è¡Œ)
- æ— panicé£é™©ï¼Œæ‰€æœ‰å¯èƒ½çš„é”™è¯¯éƒ½é€šè¿‡è¿”å›å€¼å¤„ç†

**å¯æ‰©å±•æ€§** âœ… PASS
- æ–°å¢åƒµå°¸ç±»å‹åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶
- æ–°å¢åœºæ™¯é™åˆ¶è§„åˆ™åªéœ€æ‰©å±•SceneRestrictionsç»“æ„
- æ”¯æŒå…³å¡çº§åˆ«è§„åˆ™è¦†ç›–(é€šè¿‡å¯é€‰å‚æ•°è®¾è®¡)

### Files Modified During Review

**æ— ä¿®æ”¹** - ä»£ç è´¨é‡å·²ç»å¾ˆé«˜ï¼Œè¯„å®¡æœŸé—´æœªå¯¹ç”Ÿäº§ä»£ç è¿›è¡Œä¿®æ”¹ã€‚

### Gate Status

âœ… **Gate: PASS** â†’ docs/qa/gates/17.3-spawn-constraint-checker.yml

**å†³ç­–ä¾æ®**:
- æ‰€æœ‰5ä¸ªéªŒæ”¶æ ‡å‡†å·²æ»¡è¶³
- æµ‹è¯•è¦†ç›–ç‡92.9%-100%ï¼Œè¿œè¶…80%è¦æ±‚
- ECSæ¶æ„è®¾è®¡å®Œç¾ï¼Œå®Œå…¨éµå¾ªé›¶è€¦åˆåŸåˆ™
- ä»£ç è´¨é‡é«˜ï¼Œæ³¨é‡Šå®Œå–„ï¼Œé”™è¯¯å¤„ç†å¥å£®
- NFRså…¨éƒ¨é€šè¿‡(å®‰å…¨ã€æ€§èƒ½ã€å¯é æ€§ã€å¯ç»´æŠ¤æ€§)
- ä»…å‘ç°1ä¸ªä½ä¼˜å…ˆçº§çš„ä»£ç ä¼˜åŒ–å»ºè®®ï¼Œä¸å½±å“åŠŸèƒ½

**è´¨é‡è¯„åˆ†**: 95/100

**é£é™©è¯„ä¼°**: æ— é£é™©

### Recommended Status

âœ… **Ready for Done**

æœ¬æ•…äº‹å·²å®Œå…¨æ»¡è¶³æ‰€æœ‰éªŒæ”¶æ ‡å‡†ï¼Œä»£ç è´¨é‡ä¼˜ç§€ï¼Œæµ‹è¯•è¦†ç›–å…¨é¢ï¼Œå¯ä»¥å®‰å…¨åœ°æ ‡è®°ä¸ºDoneã€‚

**ä¸‹ä¸€æ­¥å»ºè®®**:
- Story 17.4-17.10å¯ä»¥ä¾èµ–æœ¬æ•…äº‹çš„é™åˆ¶æ£€æŸ¥åŠŸèƒ½
- æœªæ¥ç‰ˆæœ¬å¯è€ƒè™‘å®ç°"Improvements Checklist"ä¸­çš„ä¼˜åŒ–å»ºè®®(éå¿…é¡»)

**è¯„å®¡äº®ç‚¹**:
1. **æ¶æ„å…¸èŒƒ**: ECSé›¶è€¦åˆè®¾è®¡å ªç§°æ•™ç§‘ä¹¦çº§åˆ«ï¼Œå®Œç¾å€Ÿé‰´Epic 14ç»éªŒ
2. **æµ‹è¯•é©±åŠ¨**: æµ‹è¯•ä»£ç é‡æ˜¯ç”Ÿäº§ä»£ç çš„2.13å€ï¼Œè¦†ç›–ç‡è¿œè¶…é¢„æœŸ
3. **é…ç½®é©±åŠ¨**: æ‰€æœ‰è§„åˆ™å¤–éƒ¨åŒ–ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
4. **å‘åå…¼å®¹**: å¯é€‰å‚æ•°è®¾è®¡ä¸å½±å“ç°æœ‰ä»£ç 
5. **å®Œæ•´æ–‡æ¡£**: CLAUDE.mdä¸­æœ‰è¯¦ç»†çš„è§„åˆ™è¯´æ˜å’Œé›†æˆç¤ºä¾‹

æ„Ÿè°¢å¼€å‘å›¢é˜Ÿçš„ä¼˜ç§€å·¥ä½œ! ğŸ‰
